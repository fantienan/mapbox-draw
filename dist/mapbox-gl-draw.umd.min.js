!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("mapbox-gl"),require("@turf/turf")):"function"==typeof define&&define.amd?define(["mapbox-gl","@turf/turf"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).MapboxDraw=e(t.mapboxgl,t.turf)}(this,(function(t,e){"use strict";function n(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var o=n(e),i=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(t,e,o){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:o})},render:function(t){e.store.featureChanged(t)}},i=function(t,i){for(var r=n[t],a=r.length;a--;){var s=r[a];if(s.selector(i)){s.fn.call(o,i)||e.store.render(i),e.ui.updateMapClasses();break}}};return t.start.call(o),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){i("drag",t)},click:function(t){i("click",t)},mousemove:function(t){i("mousemove",t)},mousedown:function(t){i("mousedown",t)},mouseup:function(t){i("mouseup",t)},mouseout:function(t){i("mouseout",t)},keydown:function(t){i("keydown",t)},keyup:function(t){i("keyup",t)},touchstart:function(t){i("touchstart",t)},touchmove:function(t){i("touchmove",t)},touchend:function(t){i("touchend",t)},tap:function(t){i("tap",t)},undo:function(){t.undo()},redo:function(){t.redo()},finish:function(){t.finish()},cancel:function(){t.cancel()},drawByCoordinate:function(e){t.drawByCoordinate(e)},getModeInstance:function(){return t.getModeInstance()},setMeasureOptions:function(e){t.setMeasureOptions(e)}}};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function a(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})})),n}var s={},c={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142},u=c;function l(t){var e=0;if(t&&t.length>0){e+=Math.abs(d(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(d(t[n]))}return e}function d(t){var e,n,o,i,r,a,s=0,c=t.length;if(c>2){for(a=0;a<c;a++)a===c-2?(o=c-2,i=c-1,r=0):a===c-1?(o=c-1,i=0,r=1):(o=a,i=a+1,r=a+2),e=t[o],n=t[i],s+=(p(t[r][0])-p(e[0]))*Math.sin(p(n[1]));s=s*u.RADIUS*u.RADIUS/2}return s}function p(t){return t*Math.PI/180}s.geometry=function t(e){var n,o=0;switch(e.type){case"Polygon":return l(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=l(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},s.ring=d;var f={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect",CONTROL_BUTTON_UNDO:"mapbox-gl-draw_undo",CONTROL_BUTTON_REDO:"mapbox-gl-draw_redo",CONTROL_BUTTON_FINISH:"mapbox-gl-draw_finish",CONTROL_BUTTON_CANCEL:"mapbox-gl-draw_cancel",CONTROL_BUTTON_DRAW_CENTER:"mapbox-gl-draw_draw-center",MEASURE_MARKER:"mapbox-gl-draw-measure",CONTROL_BUTTON_CUT_LINE:"mapbox-gl-draw_cut-line",CONTROL_BUTTON_CUT_POLYGON:"mapbox-gl-draw_cut-polygon"},h={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},g={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},y={POLYGON:"polygon",LINE:"line_string",POINT:"point"},v={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},m={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static",CUT_POLYGON:"cut_polygon",CUT_LINE:"cut_line",CUT_SELECT:"cut_select"},_={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine",REDO_UNDO:"draw.redoUndo",CLICK_ON_VERTEX:"draw.clickOnVertex",ON_MIDPOINT:"draw.onMidpoint",DRAG_VERTEX:"draw.dragVertex",CLICK_OR_TAB:"draw.clickOrTab",DRAG:"draw.drag",CLEAR_SELECTED_COORDINATES:"draw.clearSelectedCoordinates",ADD_POINT:"draw.addPoint",ADD:"draw.onAdd",POLYTON_CUT_CREATE:"draw.polygonCutCreate"},b={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},E={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex",LAST_POINT:"last_point",SECOND_TO_LAST_POINT:"second_to_last_point"},O={ACTIVE:"true",INACTIVE:"false"},C=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],T=-85,S=85,I=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"],A=Object.freeze({__proto__:null,classes:f,sources:h,cursors:g,types:y,geojsonTypes:v,modes:m,events:_,updateActions:b,meta:E,activeStates:O,interactions:C,LAT_MIN:-90,LAT_RENDERED_MIN:T,LAT_MAX:90,LAT_RENDERED_MAX:S,LNG_MIN:-270,LNG_MAX:270,GEOMETRYS:I}),x={Point:0,LineString:1,MultiLineString:1,Polygon:2};function M(t,e){var n=x[t.geometry.type]-x[e.geometry.type];return 0===n&&t.geometry.type===v.POLYGON?t.area-e.area:n}function N(t){return t.map((function(t){return t.geometry.type===v.POLYGON&&(t.area=s.geometry({type:v.FEATURE,property:{},geometry:t.geometry})),t})).sort(M).map((function(t){return delete t.area,t}))}function L(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function w(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}w.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},w.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},w.prototype.has=function(t){return("string"==typeof t||"number"==typeof t)&&(void 0!==this._items[t]||void 0!==this._nums[t])},w.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},w.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var P=[E.FEATURE,E.MIDPOINT,E.VERTEX],R={click:function(t,e,n){return k(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return k(t,e,n,n.options.touchBuffer)}};function k(t,e,n,o){if(null===n.map)return[];var i=t?L(t,o):e,r={};n.options.styles&&(r.layers=n.options.styles.map((function(t){return t.id})));var a=n.map.queryRenderedFeatures(i,r).filter((function(t){return-1!==P.indexOf(t.properties.meta)})),s=new w,c=[];return a.forEach((function(t){var e=t.properties.id;s.has(e)||(s.add(e),c.push(t))})),N(c)}var F="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAApCAYAAAAmukmKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkQ4MDgwMUNENTg0ODExRUVBNjUwODMyMzhEQjFEMDY2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkQ4MDgwMUNFNTg0ODExRUVBNjUwODMyMzhEQjFEMDY2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RDgwODAxQ0I1ODQ4MTFFRUE2NTA4MzIzOERCMUQwNjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RDgwODAxQ0M1ODQ4MTFFRUE2NTA4MzIzOERCMUQwNjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5YUW5BAAAD0UlEQVR42uyXWUwTURRA70xbptQCATW2QllEFlkEoxGi4o+iBkQNJiSIcfnwR+VLY2IixESMS2L8MfEPl2iMGCNLJO5GiUZMRDbZoyCr7KVQW7qM97ZIgtCZAYv+cJOX6bx355zO65t5t4w9LgOEgq0qYPGQhC1VI1duDue8wrxlCm8aG7FZRprMhuYeq+ktnj7GVoY8uxCPcSVEkRwPh1cpvXMO+Abrdvv4QyTnNWNug9kARfpOuD3U2l5vGsnDrnzkWiULURatU6jundVEx6IMZAwDUsLG83BnqA1ye2pr2y3GTGTXigpRtmuHl+b+rcAE5VI5B3OJPqsZDn4vNz8x9GQgv3gK/09Zlm/Qo+KQpDnLKOhaZHD7kUXMGYU4EJPirS24qVvPyiVOoVAQ4wayUpFJ7ClCWiD4m91HGSdzg+x3EOumLoEL9FAVTCzCyTs8cl4bG7XkL6bRVSyWe0CeJnYVORyLhqQxSp+OyohtWhYYmI+wAw/xjc+6a036ALrNLQf8gqXJgrTAZKUAxIY5z2uagb9bCtDWLfzyQDY5TnVVbZXhefY1/7WJdOuCkZwIzPUzAHHhuAx9nS06FJj0LSjsAvjaIbJylXCtv3mADVB4bgrj1MKygGXA5B0D4BTTx7CPOXfUkSMU5PBXeG5kQzzUK8VmksnYhmCBGVByzhyRCPVQh7E+MoVaNDMiGNyRgy99NcsDbxfNtFrBHTnkYges48OiiRX14I4ccrGNZkM9PSeCUfAc4MeA63EaoxyRZ5Fc7JBt/E2FcUhYaBgDPvsSQGfv9DHs47MvOnKEghzkoge/8KG+I3edyk9Y2tQGfPoJgO0bgIle4ZzGL18Bnr4HMI+LTic66FDk2A91dSWVjZEpcSpWNi+vNqPdBhENpVXtUWnxjpd3p+VnztW+JpivIDY5JncLvMuSy731j+tMI26XYY0DyC4lx5QN2GC3Ht7X9uFHP5YH7gpiZSIT2Yem7fj4DfqqTcPJO7+V6fvcICUGsYhJ7BlrGhyo+WgcTExqedVabhyYswwZQAxiEdNlETUhbcDiNm5zy+v8450VPP7YkkWUS9egLJ8YxJJcCE/UOms8WdnpFC/tnjSf5YqNi5ZAsGLRZJ1KdWirZQzejfVDib7LgmVh4ZjdegGZn2ddef8hprcC7rSQoGRkWcbVezXUr6p+2GPibXfxYzm2l8gaFK3mJNUkTtADaiiPpP8Z1I+yTzh2clblIwKkF0Ou/4dIZrDwj2NBuCBcEP5/oXwO14xiUTnqqGudx3kXXklsfrH89+fZXvxLgAEAlgiiMDyIpU8AAAAASUVORK5CYII=",U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAiCAYAAABIiGl0AAAFVklEQVRYhZ1XfWxTVRT/vdfRbiN10cCqMAdqZzL52CKICH84YehIRf/QFcYWh/9IggIKfiQmwkIiCUJQIJCIkpHAlkj0rzHCx5QZI9OB+7CWOcYmllUZlhIt3dqtfdec9t55+/r6gTc5eR/3nN/v3XvOPec8hTGGdENRFEWaViSRB5NEjLTAOakmJEKVk6mSiA+ARKhJIp6R6gOSiCVCQWbievLVpCOOconorpoEnfgBtNVCpJUQsBlAPoACANPLy8tnd3d3v+n3+0+Hw+FhTdPGo9FoMBQKDdI7miMd0uU2+RzDZOSeSR9LKxUrmsIN8wYGBjbYZ81+H1//CJy/BPT9BvhuA1NygML7gIeLgGcWAsufxNXfr+0sKSk5BGAMwDiACWlHJleuJ1b5dhKhpampaUFFRcWrM9ye1Th0Arg+kiok4uNBG7DBiT/mFH/R3t7eWFtb+xOAMP+ACP7zf5yYkyoSae7evXvnvLV5czvbdRT4qi09oX68VAnlvXX4eN++ii1btrgBhCTyWDDKxMKvuQCsHo/no6Ivv3Wy4613Ryp8WOfA8MtPnyguLn4XQEAipy1nqrTFwq95/f39W4v6hp3s2EmKvv8lZFt0+bqTsAiTY5vE8ZSj2EKRWFZWVtjTefGX6PMbgb9uJy+l+AGom9ZCWTwv9sh+cEHb3wx4/kzWnX4vTCcPoHzRE3N7e3tvAhjlPo+qXEWs2Hzw4MEX2NkOsBE/mMYShEhNxz+EsnwRMDUvJnRP72hOrx/DONsBwpSOlgpdVooFlt1uX6F905lwvoUoG2sA69TklVmnxuaMbAiLMDlxjuDM0WWoKVar1a5d8cAoh6uL56cMJnVJGSIGNpp7EAUFBaV6H4uUKfxsslgs0yI3fQDTkkAy5H0wAxt28xbMZvM0XapVVF3FUXkWTfaXxhDt+DklafT7HkObWGzER0LqVPUAoVDoFkWjkb8mPjkOFggmryoQjM8Z2BBWOBz26W1UfVnz+/2DyqOzwDQtSbSrHoSr30aUoj44FhO6p3c0Z2SjzLXD5/P9KhKH8Jfwsailka6urvOOZ5+qiJz6znhLh4YRfWNnGk8nDtOKxeju7m6XCkU8ZfJVixJ4j81mu//G8HDHaOV6aN4MRSHDUGfakH/uUxQ9NHuJ1+ulDPMPTyLjqrTNlMAnRkZG7lzo7Dxs/uC1uJ8Mti8rYQyEceFi52Gv1xvg5XGyQong0vg2UDobW7p06ZG+wvxT5o1rDQMmGyFbwiAsXpvDclcitzCKnMmGhoaurTuwaw0LhRG55L6rLbasr0bu1ldQX1//zuDg4A0Ad3TVCSqLpyjRN01wheCZM2eu1dbV1fU99/g5y+trUp5RvZAu2ZAtYRAWx5yQg0tu9oSfx3kAmJqbm/sCgUBjQ0ODUgpUhqgKpRm5m9bi8rL5bQ3btze2tLT08zo8qutAYiNGTKvmLZdY9WQ2a2lpuaJp2pEdO3aglKFybH+TIXPe5jr0LZvXtm3btiOtra0DAP6WtnhCf46NOswcXputAGwA7AAWOhyONV1dXWdHdzeyWzOXJ8jonqOM5lauXLmadLmNjWNYOGZip5mivTUiX+BwOKp7enpOB3c3Mt+MZTGhe3pXVVVVTTpZkeqJM5A/AqB81apVL7rd7pNEGNxzlNE9vaM5rpOZ1Ig4DXkhAGrYH6upqVnhcrk+d7lcnzmdzkoApXyuMCtSua9Omkhu8M0c0Cy1MSIgx7mEpbOa0MBnTWxArvIuIkfunaSsF+HRq2UizUisI9f/LcrE+r/FtKRZEevIY48pflOz/jfOmjjNR8gjeyAA/wLyQavmRr/R2AAAAABJRU5ErkJggg==",D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAABRCAYAAAB/nZ57AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkVEMzUxQkYyNUNDQzExRUVBNEM2QTgxMTYxRUNEMEIxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkVEMzUxQkYzNUNDQzExRUVBNEM2QTgxMTYxRUNEMEIxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RUQzNTFCRjA1Q0NDMTFFRUE0QzZBODExNjFFQ0QwQjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RUQzNTFCRjE1Q0NDMTFFRUE0QzZBODExNjFFQ0QwQjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4I43SmAAAIDUlEQVR42uxbaXATZRj+sg29NqWQlnZSjiJQWm4EyiUjFMotVIcZQA5RkEGUQ0UFf4ACKjiIF+CIMiACIoz8EUGghSKWUg6Ruy1ngR6WpoG2SUnSNvF5262ThlybbNvUyTvzzJfufvvt8+x37Pu+31ZmNpuZJzbmoNbyTw6IBxKAfkBnoDXAC+d1QB5wHTgHpAJnD41TmJgEJvNUzOgaMW2AN4DpQFuRTdwHdgGbDo9T5DaamNG/a8NQrAJeBfw9fLBGYAuw4vBYRXGDihl1SDuZniYQzqQ1NbDgyBjFnnoXM/KQVo5iA/Aaq1/7FliYPEZRWS9iRh7WBqOgJ/Ycaxj7DZiSPFpRLqmYxCPVPbIPmMga1n4FJqWMct5DnKstmmVsIzARYA0MuudGyXpmeLJ2CoqfbZ3zww0Ht5KzPko/pgqqeTYFj03svKaKpRdVsiqzZD007dhIxW6PxCSkVC+/WbZWrdBmMja3kz9rHWy7g/PKTez7m0ZWUiGJIg0Ql5qoKHJ7mKGLPwLCrbufw5VzY+wLIaNzVMePk2S4KYHVbs+Zoce07dDAHFuN09BqHeR8ylGdQagr0fyZTZzcEmOSsflAM4BZg+aIqySorq023ABxmS9azJDjWg5EZtgj2DbY5YWQtUFdCVe3GcRNlBhcFA+0sduoiJlLK5qEYohTvFgxwx01eh/LLwlyBfl6k9TvngRbnOUOxPR19LTPllSx9rxrQ43qEgkJrZ+onsFEi3U0GU9oKlmu3nlMlYc6VFeiBaAWsWKHmcpRV1egzsa7RnZfb3+4kdgNqFPBJHdxVOKGGcdCnD31h5jZa+4Y2FClnA0IhTsTILgzBhM7jaH1h0ZwZzgmtYWInTMuGbmyR0GaYNthajj3Wm5/zsjKUIQx77QysT1T4MViCsSKyUbR3UvFZIscZuwvivC8VMw5sT2TyrzXUsWKOUOvCiHB501GnM6Kemle6cObIGhnI8T8zrCTuImOZ3DhJsDoRUKIyya3grNrvflcLARbJParPMFW4uR2QiP2ki5MWAob+51D+efY7J58sdsJDboYXbvAC4bYIkdCRGU0Y67oKPc7r5F65bsb3Xmn95aLyGguQqFqpPTsQskT5x2v6Shx/gswtoGEHAAm3+rKu5Q4FxVpUKOQngRsdjX+9wB0jxdcFSK6ZyytQ6ZuKqvZp6mPzaZFt7vwu8Ve6NE24FNZOhJCKdPZTJptwK3A8jtxvNqdBjzeoG2fpWOC/7YAmMFqdpfFGO0+76SUQk4c33gbtNVisnXWc5ASdMOBvnEB3KSCSjPTmWruwXMyppLLWJbBRJtWFGIcI6cxJ5b3jq3z6Lpi6tjdWN5s5xqZRR3JJpvHYpy9nlgDpjk49j8ynxifGJ8YnxifGJ8YnxifGJ8YnxifGJ8YEUb552FMmi9phzEP89nVkeaQYyqXKqcNL6DERSIwAhgIdKo9hzZkVnUdRprW90T92ro3gQzgKJCCerkucnOenkWlVqzms3jKk/W3DHkNJr26SJ+fWWjIpxsOZjXf/FPWMwAkOEHQE4Zz9IG3AaAEHyURSnLLb//ZKjCqSwAX2El4SJTpMaMN2sHbC+zAdUWOuModiOiC4n2AbhxAx8qrtLnXy66kn3+YduP4gwOFt3VZBotLxOxMt7A+MDXjGUo3sQ58XMCwiPGRfVoOiYlRdBvEy0MG4DDhE3AiUWsgKtOlYYYLKLH3KfAyzSk8fc2FRxkH9uVuvZyuTi4RM4bR1mY7PePybsLgsMTmk9rO6dm7xcDx6DUlDlFa6gdgKdpR2x1mODAexXaaiPqqx0WpD/bv/frGiitllSWmxlqh0otTSoG0EHlo+qKYVd0SIiZMCfQLogxqEvjOgqADT6xmOLEYxX6T2RR6Un1k2/Mne6/4OHPxJU+EVJiMOleOuWLEA3wuEy/iRzyJL3i/WUcMDsxF8WWFqaJ0/fVlK5dempWhrSz1uDcySy9kWB+7XHI2zZM2iRfxI57EF4e+EPhXz5lolFlQKl+b9fYHBwv2qKUaIpi88s967ZoUF9KLlnGWVXYx452L0/fpKssqpWh/nGpK+LK4z1dyMo7a60JiaCv69dPFqTuWXJyWxpqYre/105ABYQkz8fMbGmbV/z7y492v/m6KLowF73Ekpp0wlnVNUQzee4+Fn1Ek5h796hEazzdFMZ1DugcJP/NJDP33EHspevHTTVGMBe+DJGYdoI9XDn2RVoemJIT4Em/iTzpITA6wGMub/N3Yde8ltZ4Z0RSEEE/iS7yJP+n4zzfDi+ctWunwvqk6VZyyY/W1hWekeHFKbQp5c2551w39B4UlzoQQPxxaAv704qzraOLABBTbLHyzPfDNrjamb1Zr8M24BTEfdhsRkUS+GYUl9B3NK+C+v9bRtOU1U8W11l7z3nubL57WHC9raBEDlMNCJreb18vKa94ueM1Fll6z3UjTVjwDN+T+De3VU+c0J66j1wrvlt80Sk0+OriTPzzjyH7KZzsjnhkIl6j2P5kMQpBmM55xKMaqp2YKoupEmvqq8kK14Z9sijRzy+88yHucU1qgv6cr1OcbNcYHFehV00Ojuqq2fkv/cD88XU7pH9EsMjDKXxXYjo8Kig5pG9whMjIgqk14gCoOQ8hyAaJQmr7H3OMs0nRJjI0cwEghBzCIAsN6GFm3gVNCDiBZTA7A061zyqb0ALoCHQXXiL7QUApoZhUiP2I1/+ChEZAneCC3gGvkVQkT2y37V4ABAEkB+U9EUz7pAAAAAElFTkSuQmCC";function j(t,e){var n=t.getCtx().api;return{data:Object.assign({},e,{draw:n,mode:n.getMode(),state:t.getState()})}}function G(t,e){t.map.fire(_.REDO_UNDO,j(t,e))}function B(t,e){t.map.fire(_.CLICK_ON_VERTEX,j(t,e))}function V(t,e){t.map.fire(_.CLICK_OR_TAB,j(t,e))}function J(t,e){t.map.fire(_.ADD_POINT,j(t,e))}function Y(t,e,n,o,i,r){return{type:v.FEATURE,properties:{meta:i?E.LAST_POINT:E.SECOND_TO_LAST_POINT,parent:t,coord_path:n,active:o?O.ACTIVE:O.INACTIVE,mode:r},geometry:{type:v.POINT,coordinates:e}}}function z(t){return t.options.disabledClickOnVertex}function W(t){return t.options.ignoreClickOnVertex}function Z(t){return t.options.clickOnMissAndDoNothing}function Q(t,e){try{if(t.options.disableSelect)return!0;var n=t.options.stopPropagationClickActiveFeatureHandlerClassName;return e.originalEvent.target&&"string"==typeof e.originalEvent.target.className&&n&&e.originalEvent.target.className.includes(n)}catch(t){return!1}}function H(t){return t.options.clickNotthingNoChangeMode}function X(t){return t.options.disabledDragVertexWithSimpleSelectMode}function K(t,e){return new Promise((function(n,o){var i=[];e.forEach((function(e){i.push(function(t,e){return new Promise((function(n,o){t.loadImage(e.url,(function(i,r){i?o(i):t.hasImage(e.id)||n(Object.assign({},e,{image:r}))}))}))}(t,e))})),Promise.all(i).then((function(e){e.forEach((function(e){t.addImage(e.id,e.image)})),n(e)})).catch((function(t){o(t)}))}))}var q=function(t){this._modeInstance=t.modeInstance,this._ctx=t.ctx,this._api=t.ctx.api,this.undoStack=[],this.redoStack=[],this._addPointEvent=this._drawAddPointEvent.bind(this),this._bindEvent()};q.prototype._bindEvent=function(){this._unbindEvent(),this._ctx.map.on(_.ADD_POINT,this._addPointEvent)},q.prototype._unbindEvent=function(){this._ctx.map.off(_.ADD_POINT,this._addPointEvent)},q.prototype._drawAddPointEvent=function(){this.undoStack=[],this.redoStack=[],this.fireChange({type:"add"})},q.prototype._fireChangeAndRender=function(t){var e=this;this._modeInstance.afterRender((function(){return e.fireChange(t)}),!0)},q.prototype.fireChange=function(t){var e=t.cb,n=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&-1===e.indexOf(o)&&(n[o]=t[o]);return n}(t,["cb"]),o=this.undoStack,i=this._api.getMode(),r=m;i===r.DRAW_LINE_STRING?(o=this._modeInstance.feature.getCoordinates()).pop():i===r.DRAW_POLYGON&&(o=this._modeInstance.feature.getCoordinates()[0]||[]).length<3&&(o=[]);var a=JSON.parse(JSON.stringify(Object.assign({},n,{undoStack:o,redoStack:this.redoStack})));this._ctx.ui.setDisableButtons((function(t){return t.undo={disabled:0===a.undoStack.length},t.redo={disabled:0===a.redoStack.length},t})),G(this._modeInstance,JSON.parse(JSON.stringify(a))),"function"==typeof e&&e()},q.prototype.undo=function(t){void 0===t&&(t=function(){});var e=null,n=this._modeInstance.getState(),o=n.currentVertexPosition-1,i=Math.max(0,o);if(n.line?e=n.line.removeCoordinate(""+i)[0]:n.polygon&&(e=n.polygon.removeCoordinate("0."+i,!0)[0]),e){if(n.currentVertexPosition--,n.currentVertexPosition<0)return;this.redoStack.push(e),console.log(this.redoStack),this._fireChangeAndRender({type:"undo",cb:t})}},q.prototype.redo=function(t){void 0===t&&(t=function(){});var e=this._modeInstance.getState(),n=this.redoStack.pop();n&&(e.line?e.line.addCoordinate(e.currentVertexPosition++,n[0],n[1]):e.polygon&&e.polygon.addCoordinate("0."+e.currentVertexPosition++,n[0],n[1]),this._fireChangeAndRender({type:"redo",cb:t}))},q.prototype.destroy=function(){this._unbindEvent(),this.reset()},q.prototype.reset=function(){this.undoStack=[],this.redoStack=[]};var $=function(t){this._modeInstance=t.modeInstance,this._ctx=t.ctx,this._api=t.ctx.api,this.undoStack=[],this.redoStack=[],this._addPointEvent=this._drawAddPointEvent.bind(this),this._bindEvent()};$.prototype._bindEvent=function(){this._unbindEvent(),this._ctx.map.on(_.ADD_POINT,this._addPointEvent)},$.prototype._unbindEvent=function(){this._ctx.map.off(_.ADD_POINT,this._addPointEvent)},$.prototype._drawAddPointEvent=function(t){this.redoStack=[];var e=t.data.e.lngLat.toArray();this.undoStack.push(e),1===this.undoStack.length&&this.undoStack.push(e),this._fireChange({type:"add"})},$.prototype._fireChangeAndRender=function(t){var e=this;this._modeInstance.afterRender((function(){return e._fireChange(t)}),!0)},$.prototype._genStacks=function(t){return t.map((function(t){return{type:Array.isArray(t)?"draw":"cut",stack:t}}))},$.prototype._fireChange=function(t){var e=t.cb,n=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&-1===e.indexOf(o)&&(n[o]=t[o]);return n}(t,["cb"]),o=JSON.parse(JSON.stringify(Object.assign({},n,{undoStack:this._genStacks(this.undoStack),redoStack:this._genStacks(this.redoStack)})));this._ctx.ui.setDisableButtons((function(t){return t.undo={disabled:0===o.undoStack.length},t.redo={disabled:0===o.redoStack.length},t})),G(this._modeInstance,JSON.parse(JSON.stringify(o))),"function"==typeof e&&e()},$.prototype.setRedoUndoStack=function(t){var e=t({undoStack:this.undoStack,redoStack:this.redoStack}),n=e.undoStack,o=e.redoStack;Array.isArray(n)&&(this.undoStack=JSON.parse(JSON.stringify(n))),Array.isArray(o)&&(this.redoStack=JSON.parse(JSON.stringify(o))),this._fireChangeAndRender({type:"cut"})},$.prototype.undo=function(t){void 0===t&&(t=function(){});var e=null,n=this._modeInstance.getState(),o=n.currentVertexPosition-1,i=Math.max(0,o),r=this.undoStack.pop();if(Array.isArray(r)&&(n.line?e=n.line.removeCoordinate(""+i)[0]:n.polygon&&(e=n.polygon.removeCoordinate("0."+i,!0)[0]),e)){if(0===n.currentVertexPosition)return;n.currentVertexPosition--,this.redoStack.push(e),this._fireChangeAndRender({type:"undo",cb:t})}return this._genStacks([r])[0]},$.prototype.redo=function(t){void 0===t&&(t=function(){});var e=this._modeInstance.getState(),n=this.redoStack.pop();return Array.isArray(n)&&(e.line?e.line.addCoordinate(e.currentVertexPosition++,n[0],n[1]):e.polygon&&(0===e.polygon.coordinates[0].length&&e.polygon.updateCoordinate("0."+e.currentVertexPosition,n[0],n[1]),e.polygon.addCoordinate("0."+e.currentVertexPosition++,n[0],n[1]),0===this.undoStack.length&&this.undoStack.push(n),this.undoStack.push(n)),this._fireChangeAndRender({type:"redo",cb:t})),this._genStacks([n])[0]},$.prototype.destroy=function(){this._unbindEvent(),this.reset()},$.prototype.reset=function(){this.undoStack=[],this.redoStack=[]};var tt=function(t){return t.ctx.events.getMode().includes("cut")?new $(t):new q(t)},et=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o=t[n];for(var i in o)nt.call(o,i)&&(e[i]=o[i])}return e},nt=Object.prototype.hasOwnProperty;var ot=r(et),it=function(t){this.ctx=t.ctx,this.markers=[],this.enabled=!1};function rt(t,e){var n=R.click(t,null,e),o={mouse:g.NONE};n[0]&&(o.mouse=n[0].properties.active===O.ACTIVE?g.MOVE:g.POINTER,o.feature=n[0].properties.meta,function(t,e,n){var o=t.api.getMode()===m.SIMPLE_SELECT,i=e.geometry.type===v.POINT,r=X(t),a=e.properties.active===O.ACTIVE;r&&o&&i&&(n.mouse=a?g.NONE:g.POINTER)}(e,n[0],o));var i=e.events.currentModeName();return(i.includes("draw")||i.includes("cut"))&&(o.mouse=g.ADD),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}function at(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}it.prototype.setOptions=function(t){this.options=ot({unit:{line:"meters",area:"meters"},precision:2},t),this[t.enable?"enable":"cancel"]()},it.prototype.enable=function(){this.enabled=!0},it.prototype.cancel=function(){this.markers.forEach((function(t){return t.remove()})),this.markers=[],this.enabled=!1},it.prototype.destroy=function(){this.cancel()},it.prototype.delete=function(){this.cancel()};var st=4,ct=12,ut=500;function lt(t,e,n){void 0===n&&(n={});var o=null!=n.fineTolerance?n.fineTolerance:st,i=null!=n.grossTolerance?n.grossTolerance:ct,r=null!=n.interval?n.interval:ut;t.point=t.point||e.point,t.time=t.time||e.time;var a=at(t.point,e.point);return a<o||a<i&&e.time-t.time<r}var dt=25,pt=250;function ft(t,e,n){void 0===n&&(n={});var o=null!=n.tolerance?n.tolerance:dt,i=null!=n.interval?n.interval:pt;return t.point=t.point||e.point,t.time=t.time||e.time,at(t.point,e.point)<o&&e.time-t.time<i}var ht={exports:{}},gt=ht.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,t/o))/Math.log(e)*o;var i=n-Math.floor(n),r="";for(o=0;o<Math.floor(n);o++){r=Math.floor(Math.random()*e).toString(e)+r}if(i){var a=Math.pow(e,i);r=Math.floor(Math.random()*a).toString(e)+r}var s=parseInt(r,e);return s!==1/0&&s>=Math.pow(2,t)?gt(t,e):r};gt.rack=function(t,e,n){var o=function(o){var r=0;do{if(r++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var a=gt(t,e)}while(Object.hasOwnProperty.call(i,a));return i[a]=o,a},i=o.hats={};return o.get=function(t){return o.hats[t]},o.set=function(t,e){return o.hats[t]=e,o},o.bits=t||128,o.base=e||16,o};var yt=r(ht.exports),vt=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||yt(),this.type=e.geometry.type,this.measure=new it({ctx:t})};vt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},vt.prototype.incomingCoords=function(t){this.setCoordinates(t)},vt.prototype.setCoordinates=function(t){return this.coordinates=t,this.changed(),this},vt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},vt.prototype.setProperty=function(t,e){this.properties[t]=e,void 0===e&&delete this.properties[t]},vt.prototype.getProperty=function(t){return this.properties[t]},vt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:v.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},vt.prototype.internal=function(t){var e={id:this.id,meta:E.FEATURE,"meta:type":this.type,active:O.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:v.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}},vt.prototype.delete=function(){return this.measure.delete(),this},vt.prototype.move=function(){return this.execMeasure(),this},vt.prototype.execMeasure=function(){throw new Error("execMeasure method must be implemented")};var mt=function(t,e){vt.call(this,t,e)};(mt.prototype=Object.create(vt.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},mt.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},mt.prototype.getCoordinate=function(){return this.getCoordinates()},mt.prototype.execMeasure=function(){};var _t=function(t,e){vt.call(this,t,e)};(_t.prototype=Object.create(vt.prototype)).isValid=function(){return this.coordinates.length>1},_t.prototype.addCoordinate=function(t,e,n){this.changed();var o=parseInt(t,10);this.coordinates.splice(o,0,[e,n]),this.execMeasure()},_t.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},_t.prototype.removeCoordinate=function(t,e){return void 0===e&&(e=1),this.changed(),this.execMeasure(),this.coordinates.splice(parseInt(t,10),e)},_t.prototype.updateCoordinate=function(t,e,n){var o=parseInt(t,10);this.coordinates[o]=[e,n],this.changed(),this.execMeasure()},_t.prototype.execMeasure=function(){var e=this;this.measure.enabled&&this.isValid()&&this.ctx.store.afterRender((function(){var n=e.measure.options,i=n.unit,r=n.precision,a=e.measure.markers;e.getCoordinates().forEach((function(n,s){if(0!==s){var c=a[s]||new t.Marker;a[s]=c,c.setLngLat(n).addTo(e.ctx.map);var u=c.getElement(),l=e.getCoordinates().slice(0,s+1),d=o.length(o.lineString(l),{units:i.line});c.setLngLat(n),u.innerHTML=d?""+d.toFixed(r):"",u.classList.add(f.MEASURE_MARKER)}})),a.splice(e.coordinates.length,a.length-e.coordinates.length).forEach((function(t){t.remove()}))}))};var bt=function(t,e){vt.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(bt.prototype=Object.create(vt.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},bt.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},bt.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},bt.prototype.addCoordinate=function(t,e,n){this.changed();var o=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[o[0]].splice(o[1],0,[e,n]),this.execMeasure()},bt.prototype.removeCoordinate=function(t,e){this.changed();var n=t.split(".").map((function(t){return parseInt(t,10)})),o=this.coordinates[n[0]];if(o){this.execMeasure();var i=o.splice(n[1],1);return!e&&o.length<3&&this.coordinates.splice(n[0],1),i}},bt.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},bt.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},bt.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),i=parseInt(o[0],10),r=parseInt(o[1],10);void 0===this.coordinates[i]&&(this.coordinates[i]=[]),this.coordinates[i][r]=[e,n],this.execMeasure()},bt.prototype.execMeasure=function(){var e=this;if(this.measure.enabled&&this.isValid()){var n=this.measure.markers;this.ctx.store.afterRender((function(){var i=e.measure.options,r=i.unit,a=i.precision,s=e.toGeoJSON(),c=o.area(s,{units:r.area}),u=n[0]||new t.Marker;n[0]=u;var l=o.center(s).geometry.coordinates;u.setLngLat(l).addTo(e.ctx.map);var d=u.getElement();d.innerHTML=c?""+c.toFixed(a):"",d.classList.add(f.MEASURE_MARKER)}))}};var Et={MultiPoint:mt,MultiLineString:_t,MultiPolygon:bt},Ot=function(t,e,n,o,i){var r=n.split("."),a=parseInt(r[0],10),s=r[1]?r.slice(1).join("."):null;return t[a][e](s,o,i)},Ct=function(t,e){if(vt.call(this,t,e),delete this.coordinates,this.model=Et[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function Tt(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t,this._state={},this.feature=null,this.redoUndo=tt({ctx:t,modeInstance:this})}(Ct.prototype=Object.create(vt.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:yt(),type:v.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},Ct.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},Ct.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},Ct.prototype.getCoordinate=function(t){return Ot(this.features,"getCoordinate",t)},Ct.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===v.POLYGON?t.getCoordinates():t.coordinates}))))},Ct.prototype.updateCoordinate=function(t,e,n){Ot(this.features,"updateCoordinate",t,e,n),this.changed()},Ct.prototype.addCoordinate=function(t,e,n){Ot(this.features,"addCoordinate",t,e,n),this.changed()},Ct.prototype.removeCoordinate=function(t){Ot(this.features,"removeCoordinate",t),this.changed()},Ct.prototype.getFeatures=function(){return this.features},Ct.prototype.execMeasure=function(){},Tt.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},Tt.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},Tt.prototype.getSelected=function(){return this._ctx.store.getSelected()},Tt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Tt.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},Tt.prototype.getFeature=function(t){return this._ctx.store.get(t)},Tt.prototype.select=function(t){return this._ctx.store.select(t)},Tt.prototype.deselect=function(t){return this._ctx.store.deselect(t)},Tt.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},Tt.prototype.addFeature=function(t){return this._ctx.store.add(t)},Tt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Tt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Tt.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},Tt.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},Tt.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},Tt.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},Tt.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return R[n](t,e,this._ctx)},Tt.prototype.newFeature=function(t,e){void 0===e&&(e={});var n,o=t.geometry.type;return n=o===v.POINT?new mt(this._ctx,t):o===v.LINE_STRING?new _t(this._ctx,t):o===v.POLYGON?new bt(this._ctx,t):new Ct(this._ctx,t),e.declareFeature&&(this.feature=n),n},Tt.prototype.isInstanceOf=function(t,e){if(t===v.POINT)return e instanceof mt;if(t===v.LINE_STRING)return e instanceof _t;if(t===v.POLYGON)return e instanceof bt;if("MultiFeature"===t)return e instanceof Ct;throw new Error("Unknown feature class: "+t)},Tt.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},Tt.prototype.getCtx=function(){return this._ctx},Tt.prototype.getState=function(){return this._state},Tt.prototype.setState=function(t){return this._state=t,this._state},Tt.prototype.undo=function(){this.redoUndo.undo()},Tt.prototype.redo=function(){this.redoUndo.redo()},Tt.prototype.finish=function(t){void 0===t&&(t=m.SIMPLE_SELECT),this.isDrawing()&&this._ctx.api.changeMode(t)},Tt.prototype.cancel=function(t){if(void 0===t&&(t=m.SIMPLE_SELECT),this.isDrawing()){var e=this._ctx.store.getAllIds();e.length&&this._ctx.api.delete(e[e.length-1]),this._ctx.api.changeMode(t)}},Tt.prototype.isDrawing=function(){return this._ctx.api.getMode().startsWith("draw")},Tt.prototype.afterRender=function(t,e){this._ctx.store.afterRender(t,e)},Tt.prototype.beforeRender=function(t){this._ctx.store.beforeRender(t)},Tt.prototype.setMeasureOptions=function(t){this.feature&&this.feature.measure.setOptions(t)},Tt.prototype.destroy=function(){this.redoUndo.destroy()},Tt.prototype.onSetup=function(){},Tt.prototype.onDrag=function(){},Tt.prototype.onClick=function(){},Tt.prototype.onMouseMove=function(){},Tt.prototype.onMouseDown=function(){},Tt.prototype.onMouseUp=function(){},Tt.prototype.onMouseOut=function(){},Tt.prototype.onKeyUp=function(){},Tt.prototype.onKeyDown=function(){},Tt.prototype.onTouchStart=function(){},Tt.prototype.onTouchMove=function(){},Tt.prototype.onTouchEnd=function(){},Tt.prototype.onTap=function(){},Tt.prototype.onStop=function(){},Tt.prototype.onTrash=function(){},Tt.prototype.onCombineFeature=function(){},Tt.prototype.onUncombineFeature=function(){},Tt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var St={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},It=Object.keys(St);function At(t){var e=Object.keys(t);return function(n,o){void 0===o&&(o={});var i={},r=e.reduce((function(e,n){return e[n]=t[n],e}),new Tt(n));return{start:function(){var e=this;if(i=r.onSetup(o),n.options.measureOptions){var a=n.api.getMode();a!==m.CUT_LINE&&a!==m.CUT_POLYGON&&r.setMeasureOptions(n.options.measureOptions)}It.forEach((function(n){var o,a=St[n],s=function(){return!1};t[a]&&(s=function(){return!0}),e.on(n,s,(o=a,function(t){return r[o](i,t)}))}))},stop:function(){r.onStop(i)},trash:function(){r.onTrash(i)},combineFeatures:function(){r.onCombineFeatures(i)},uncombineFeatures:function(){r.onUncombineFeatures(i)},render:function(t,e){r.toDisplayFeatures(i,t,e)},undo:function(){r.undo()},redo:function(){r.redo()},finish:function(t){r.finish(t)},cancel:function(t){r.cancel(t)},drawByCoordinate:function(t){r.drawByCoordinate(t)},getModeInstance:function(){return r},setMeasureOptions:function(t){r.setMeasureOptions(t)}}}}function xt(t){return[].concat(t).filter((function(t){return void 0!==t}))}function Mt(t){var e=this;if(!(e.ctx.map&&void 0!==e.ctx.map.getSource(h.HOT)))return p();var n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});var o=[],i=[];e.isDirty?i=e.getAllIds():(o=e.getChangedIds().filter((function(t){return void 0!==e.get(t)})),i=e.sources.hot.filter((function(t){return t.properties.id&&-1===o.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)})).map((function(t){return t.properties.id}))),e.sources.hot=[];var r=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===o.indexOf(e)}));var a=r!==e.sources.cold.length||i.length>0;function s(t,o){var i=e.get(t).internal(n);e.ctx.events.currentModeRender(i,(function(t){e.sources[o].push(t)}))}if(o.forEach((function(t){return s(t,"hot")})),i.forEach((function(t){return s(t,"cold")})),a&&e.ctx.map.getSource(h.COLD).setData({type:v.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(h.HOT).setData({type:v.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange||!t||"mousemove"!==t.type){var c=n===m.SIMPLE_SELECT,u=n.includes("cut"),l=c?!e.getSelected().length:!u||e.ctx.events.getModeInstance().getWaitCutFeatures().length;e.ctx.ui.setDisableButtons((function(t){return t.cut_polygon={disabled:l},t.cut_line={disabled:l},t}))}if(e._emitSelectionChange&&(e.ctx.map.fire(_.SELECTION_CHANGE,{features:e.getSelected().map((function(t){return t.toGeoJSON()})),points:e.getSelectedCoordinates().map((function(t){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:t.coordinates}}}))}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var d=e._deletedFeaturesToEmit.map((function(t){return t.delete().toGeoJSON()}));e._deletedFeaturesToEmit=[],e.ctx.map.fire(_.DELETE,{features:d})}function p(){e.isDirty=!1,e.clearChangedIds()}p(),e.ctx.map.fire(_.RENDER,{}),e.emitCallbacks()}function Nt(t){var e,n=this;this._features={},this._featureIds=new w,this._selectedFeatureIds=new w,this._selectedCoordinates=[],this._changedFeatureIds=new w,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this._emitCallbacks=[],this.sources={hot:[],cold:[]},this.render=function(t){e||(e=requestAnimationFrame((function(){e=null,Mt.call(n,t)})))},this.isDirty=!1}function Lt(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}Nt.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},Nt.prototype.setDirty=function(){return this.isDirty=!0,this},Nt.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},Nt.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Nt.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Nt.prototype.getAllIds=function(){return this._featureIds.values()},Nt.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},Nt.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),xt(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent?n._features[t].delete():-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),Lt(this,e),this},Nt.prototype.get=function(t){return this._features[t]},Nt.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},Nt.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),xt(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},Nt.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),xt(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),Lt(this,e),this},Nt.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},Nt.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=xt(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},Nt.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},Nt.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this.ctx.events.getModeInstance().map.fire(_.CLEAR_SELECTED_COORDINATES),this},Nt.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Nt.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},Nt.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},Nt.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},Nt.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},Nt.prototype.storeMapConfig=function(){var t=this;C.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},Nt.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},Nt.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]},Nt.prototype.emitCallbacks=function(t){for(;this._emitCallbacks.length>0;)this._emitCallbacks.shift()(t)},Nt.prototype.afterRender=function(t,e){"function"==typeof t&&this._emitCallbacks.push(t),e&&this.render()},Nt.prototype.beforeRender=function(t){"function"==typeof t&&t(),this.render()};var wt=["mode","feature","mouse"];function Pt(t){var e=null,n=null,o={onRemove:function(){return t.map.off("load",o.connect),clearInterval(n),o.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect:function(){var i,r,a,s;t.map.off("load",o.connect),clearInterval(n),o.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners(),i=t.map,r={url:F,id:"gl-draw-icon1"},a={url:U,id:"gl-draw-icon2"},s={url:D,id:"gl-draw-icon3"},K(i,[Object.assign({},a),Object.assign({},r),Object.assign({},s)]);var c=t.events.getModeInstance();c.afterRender((function(){return function(t,e){t.map.fire(_.ADD,j(t,e))}(c,{controlContainer:e})}))},onAdd:function(r){var a=r.fire;return r.fire=function(t,e){var n=arguments;return 1===a.length&&1!==arguments.length&&(n=[ot({},{type:t},e)]),a.apply(r,n)},t.map=r,t.events=function(t){var e=Object.keys(t.options.modes).reduce((function(e,n){return e[n]=At(t.options.modes[n]),e}),{}),n={},o={},r={},a=null,s=null;r.drag=function(e,n){n({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:g.DRAG}),s.drag(e)):e.originalEvent.stopPropagation()},r.mousedrag=function(t){r.drag(t,(function(t){return!lt(n,t)}))},r.touchdrag=function(t){r.drag(t,(function(t){return!ft(o,t)}))},r.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return r.mousedrag(e);var n=rt(e,t);e.featureTarget=n,s.mousemove(e)},r.mousedown=function(e){n={time:(new Date).getTime(),point:e.point};var o=rt(e,t);e.featureTarget=o,s.mousedown(e)},r.mouseup=function(e){var o=rt(e,t);e._defaultPrevented||!o&&Z(t)||(e.featureTarget=o,lt(n,{point:e.point,time:(new Date).getTime()})?s.click(e):s.mouseup(e))},r.mouseout=function(t){s.mouseout(t)},r.touchstart=function(e){try{e.originalEvent.preventDefault()}catch(t){console.log(t)}if(t.options.touchEnabled){o={time:(new Date).getTime(),point:e.point};var n=R.touch(e,null,t)[0];e.featureTarget=n,s.touchstart(e)}},r.touchmove=function(e){try{e.originalEvent.preventDefault()}catch(t){console.log(t)}if(t.options.touchEnabled)return s.touchmove(e),r.touchdrag(e)},r.touchend=function(e){try{e.originalEvent.preventDefault()}catch(t){console.log(t)}if(t.options.touchEnabled){var n=R.touch(e,null,t)[0];e._defaultPrevented||!n&&Z(t)||(e.featureTarget=n,ft(o,{time:(new Date).getTime(),point:e.point})?s.tap(e):s.touchend(e))}};var c=function(t){return!(8===t||46===t||t>=48&&t<=57)};function u(n,o,r){void 0===r&&(r={}),s.stop();var c=e[n];if(void 0===c)throw new Error(n+" is not valid");a=n;var u=c(t,o);s=i(u,t),r.silent||t.map.fire(_.MODE_CHANGE,{mode:n}),t.store.setDirty(),t.store.render()}r.keydown=function(e){(e.srcElement||e.target).classList.contains("mapboxgl-canvas")&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?c(e.keyCode)?s.keydown(e):49===e.keyCode&&t.options.controls.point?u(m.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?u(m.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&u(m.DRAW_POLYGON):(e.preventDefault(),s.trash()))},r.keyup=function(t){c(t.keyCode)&&s.keyup(t)},r.zoomend=function(){t.store.changeZoom()},r.data=function(e){if("style"===e.dataType){var n=t.setup,o=t.map,i=t.options,r=t.store;i.styles.some((function(t){return o.getLayer(t.id)}))||(n.addLayers(),r.setDirty(),r.render())}};var l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){a=t.options.defaultMode,s=i(e[a](t),t)},changeMode:u,actionable:function(e){var n=!1;Object.keys(e).forEach((function(t){if(void 0===l[t])throw new Error("Invalid action type");l[t]!==e[t]&&(n=!0),l[t]=e[t]})),n&&t.map.fire(_.ACTIONABLE,{actions:l})},currentModeName:function(){return a},currentModeRender:function(t,e){return s.render(t,e)},fire:function(t,e){r[t]&&r[t](e)},addEventListeners:function(){t.map.on("mousemove",r.mousemove),t.map.on("mousedown",r.mousedown),t.map.on("mouseup",r.mouseup),t.map.on("data",r.data),t.map.on("touchmove",r.touchmove),t.map.on("touchstart",r.touchstart),t.map.on("touchend",r.touchend),t.container.addEventListener("mouseout",r.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",r.keydown),t.container.addEventListener("keyup",r.keyup))},removeEventListeners:function(){t.map.off("mousemove",r.mousemove),t.map.off("mousedown",r.mousedown),t.map.off("mouseup",r.mouseup),t.map.off("data",r.data),t.map.off("touchmove",r.touchmove),t.map.off("touchstart",r.touchstart),t.map.off("touchend",r.touchend),t.container.removeEventListener("mouseout",r.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",r.keydown),t.container.removeEventListener("keyup",r.keyup))},trash:function(t){s.trash(t)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return a},undo:function(){s.undo()},redo:function(){s.redo()},finish:function(t){s.finish(t)},cancel:function(t){s.cancel(t)},drawByCoordinate:function(t){s.drawByCoordinate(t)},getModeInstance:function(){return s.getModeInstance()},setMeasureOptions:function(t){s.setMeasureOptions(t)}}}(t),t.ui=function(t){var e={},n=null,o={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function r(t){i=ot(i,t)}function a(){var e,n;if(t.container){var r=[],a=[];wt.forEach((function(t){i[t]!==o[t]&&(r.push(t+"-"+o[t]),null!==i[t]&&a.push(t+"-"+i[t]))})),r.length>0&&(e=t.container.classList).remove.apply(e,r),a.length>0&&(n=t.container.classList).add.apply(n,a),o=ot(o,i)}}function s(t,e){void 0===e&&(e={});var o=document.createElement("button");return o.className=f.CONTROL_BUTTON+" "+e.className,o.setAttribute("title",e.title),o.disabled=!!e.disabled,e.container.appendChild(o),o.addEventListener("click",(function(o){if(o.preventDefault(),o.stopPropagation(),"function"!=typeof e.onClick){if(o.target===n)return c(),void e.onDeactivate();u(t),e.onActivate()}else e.onClick()}),!0),o}function c(){n&&(n.classList.remove(f.ACTIVE_BUTTON),n=null)}function u(t){c();var o=e[t];o&&o&&"trash"!==t&&(o.classList.add(f.ACTIVE_BUTTON),n=o)}return{setActiveButton:u,queueMapClasses:r,updateMapClasses:a,clearMapClasses:function(){r({mode:null,feature:null,mouse:null}),a()},addButtons:function(){var n=t.options.controls,o=document.createElement("div");return o.className=f.CONTROL_GROUP+" "+f.CONTROL_BASE,n?(n[y.LINE]&&(e[y.LINE]=s(y.LINE,{container:o,className:f.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(m.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[y.POLYGON]&&(e[y.POLYGON]=s(y.POLYGON,{container:o,className:f.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(m.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[y.POINT]&&(e[y.POINT]=s(y.POINT,{container:o,className:f.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(m.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=s("trash",{container:o,className:f.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=s("combineFeatures",{container:o,className:f.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=s("uncombineFeatures",{container:o,className:f.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),n.undo&&(e.undo=s("undo",{container:o,className:f.CONTROL_BUTTON_UNDO,title:"Undo",disabled:!0,onClick:function(){return t.events.undo()}})),n.redo&&(e.redo=s("redo",{container:o,className:f.CONTROL_BUTTON_REDO,title:"Redo",disabled:!0,onClick:function(){return t.events.redo()}})),n.finish&&(e.finish=s("finish",{container:o,className:f.CONTROL_BUTTON_FINISH,title:"Finsih",disabled:!0,onClick:function(){return t.events.finish()}})),n.cancel&&(e.cancel=s("cancel",{container:o,className:f.CONTROL_BUTTON_CANCEL,title:"Cancel",disabled:!0,onClick:function(){return t.events.cancel()}})),n.draw_center&&(e.draw_center=s("draw_center",{container:o,className:f.CONTROL_BUTTON_DRAW_CENTER,title:"Draw By Center",disabled:!0,onClick:function(){return t.api.drawByCenter()}})),n.cut_line&&(e.cut_line=s("cut_line",{container:o,className:f.CONTROL_BUTTON_CUT_LINE,title:"cut line",disabled:!0,onActivate:function(){return t.api.changeMode(m.CUT_LINE)},onDeactivate:function(){return t.events.trash()}})),n.cut_polygon&&(e.cut_polygon=s("cut_polygon",{container:o,className:f.CONTROL_BUTTON_CUT_POLYGON,title:"cut polygon",disabled:!0,onDeactivate:function(){return t.events.trash()},onActivate:function(){return t.api.changeMode(m.CUT_POLYGON)}})),o):o},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))},setDisableButtons:function(t){if(e){var n=Object.entries(e).reduce((function(t,e){var n=e[0],o=e[1];return t[n]={disabled:!!o.disabled},t}),{}),o=t(JSON.parse(JSON.stringify(n)));Object.entries(e).forEach((function(t){var e=t[0],n=t[1],i=o[e].disabled;"boolean"==typeof i&&i!==n.disabled&&(n.disabled=o[e].disabled)}))}}}}(t),t.container=r.getContainer(),t.store=new Nt(t),e=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable(),r.dragPan.disable(),r.dragPan.enable()),r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval((function(){r.loaded()&&o.connect()}),16)),t.events.start(),e},addLayers:function(){t.map.addSource(h.COLD,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(h.HOT,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach((function(e){t.map.addLayer(e)})),t.store.setDirty(),t.store.render()},removeLayers:function(){t.options.styles.forEach((function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)})),t.map.getSource(h.COLD)&&t.map.removeSource(h.COLD),t.map.getSource(h.HOT)&&t.map.removeSource(h.HOT)}};return t.setup=o,o}var Rt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["coalesce",["get","user_inactive-fill-color"],"#3bb2d0"],"fill-outline-color":["coalesce",["get","user_inactive-fill-outline-color"],"#3bb2d0"],"fill-opacity":["coalesce",["get","user_inactive-fill-opacity"],.1]}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#3bb2d0"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#3bb2d0"],"line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function kt(t){return function(e){var n=e.featureTarget;return!!n&&(!!n.properties&&n.properties.meta===t)}}function Ft(t){return!!t.originalEvent&&(!!t.originalEvent.shiftKey&&0===t.originalEvent.button)}function Ut(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===O.ACTIVE&&t.featureTarget.properties.meta===E.FEATURE))}function Dt(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===O.INACTIVE&&t.featureTarget.properties.meta===E.FEATURE))}function jt(t){return void 0===t.featureTarget}function Gt(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&t.featureTarget.properties.meta===E.FEATURE)}function Bt(t){var e=t.featureTarget;return!!e&&(!!e.properties&&e.properties.meta===E.VERTEX)}function Vt(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function Jt(t){return 27===t.keyCode}function Yt(t){return 13===t.keyCode}var zt=Object.freeze({__proto__:null,isOfMetaType:kt,isShiftMousedown:Ft,isActiveFeature:Ut,isInactiveFeature:Dt,noTarget:jt,isFeature:Gt,isVertex:Bt,isShiftDown:Vt,isEscapeKey:Jt,isEnterKey:Yt,isTrue:function(){return!0}}),Wt=Zt;function Zt(t,e){this.x=t,this.y=e}Zt.prototype={clone:function(){return new Zt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=o,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),i=e.x+n*(this.x-e.x)-o*(this.y-e.y),r=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zt.convert=function(t){return t instanceof Zt?t:Array.isArray(t)?new Zt(t[0],t[1]):t};var Qt=r(Wt);function Ht(t,e){var n=e.getBoundingClientRect();return new Qt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function Xt(t,e,n,o,i,r){return{type:v.FEATURE,properties:{meta:E.VERTEX,parent:t,coord_path:n,active:o?O.ACTIVE:O.INACTIVE,isLast:!!i,mode:r},geometry:{type:v.POINT,coordinates:e}}}function Kt(t,e,n){var o=e.geometry.coordinates,i=n.geometry.coordinates;if(o[1]>S||o[1]<T||i[1]>S||i[1]<T)return null;var r={lng:(o[0]+i[0])/2,lat:(o[1]+i[1])/2};return{type:v.FEATURE,properties:{meta:E.MIDPOINT,parent:t,lng:r.lng,lat:r.lat,coord_path:n.properties.coord_path},geometry:{type:v.POINT,coordinates:[r.lng,r.lat]}}}function qt(t,e,n,o){void 0===e&&(e={}),void 0===n&&(n=null);var i,r=t.geometry,a=r.type,s=r.coordinates,c=t.properties&&t.properties.id,u=[];function l(t,n){var i="",r=null;t.forEach((function(t,a){var s=null!=n?n+"."+a:String(a),l=Xt(c,t,s,d(s),void 0,o);if(e.midpoints&&r){var p=Kt(c,r,l);p&&u.push(p)}r=l;var f=JSON.stringify(t);i!==f&&u.push(l),0===a&&(i=f)}))}function d(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return a===v.POINT?u.push(Xt(c,s,n,d(n),void 0,o)):a===v.POLYGON?s.forEach((function(t,e){l(t,null!==n?n+"."+e:String(e))})):a===v.LINE_STRING?l(s,n):0===a.indexOf(v.MULTI_PREFIX)&&(i=a.replace(v.MULTI_PREFIX,""),s.forEach((function(n,r){var a={type:v.FEATURE,properties:t.properties,geometry:{type:i,coordinates:n}};u=u.concat(qt(a,e,r,o))}))),u}var $t={enable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}},te={exports:{}},ee=function(t){if(!t||!t.type)return null;var e=ne[t.type];if(!e)return null;if("geometry"===e)return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if("feature"===e)return{type:"FeatureCollection",features:[t]};if("featurecollection"===e)return t},ne={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};var oe=r(ee);var ie=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,n){return e.concat(t(n))}),[]),e;case"Feature":return e.geometry?t(e.geometry).map((function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(n.id=e.id),n})):[e];case"MultiPoint":return e.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return e.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return e.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return e.geometries.map(t).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}}),re=ee,ae=a(ie),se=function(t){return function t(e){if(Array.isArray(e)&&e.length&&"number"==typeof e[0])return[e];return e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t)};ae instanceof Function||(ae=ae.default);function ce(t){return Object.prototype.toString.call(t)}var ue=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function le(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)}var de=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e},pe=Object.prototype.propertyIsEnumerable,fe=Object.getOwnPropertySymbols;function he(t){var e=de(t);if(fe)for(var n=fe(t),o=0;o<n.length;o++)pe.call(t,n[o])&&e.push(n[o]);return e}var ge=Object.prototype.hasOwnProperty||function(t,e){return e in t};function ye(t){if("object"==typeof t&&null!==t){var e;if(ue(t))e=[];else if("[object Date]"===ce(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===ce(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===ce(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===ce(t)}(t)||function(t){return"[object Number]"===ce(t)}(t)||function(t){return"[object String]"===ce(t)}(t))e=Object(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},o=function(){};o.prototype=n,e=new o}return le(he(t),(function(n){e[n]=t[n]})),e}return t}function ve(t,e,n){var o=[],i=[],r=!0;return function t(a){var s=n?ye(a):a,c={},u=!0,l={node:s,node_:a,path:[].concat(o),parent:i[i.length-1],parents:i,key:o[o.length-1],isRoot:0===o.length,level:o.length,circular:null,update:function(t,e){l.isRoot||(l.parent.node[l.key]=t),l.node=t,e&&(u=!1)},delete:function(t){delete l.parent.node[l.key],t&&(u=!1)},remove:function(t){ue(l.parent.node)?l.parent.node.splice(l.key,1):delete l.parent.node[l.key],t&&(u=!1)},keys:null,before:function(t){c.before=t},after:function(t){c.after=t},pre:function(t){c.pre=t},post:function(t){c.post=t},stop:function(){r=!1},block:function(){u=!1}};if(!r)return l;function d(){if("object"==typeof l.node&&null!==l.node){l.keys&&l.node_===l.node||(l.keys=he(l.node)),l.isLeaf=0===l.keys.length;for(var t=0;t<i.length;t++)if(i[t].node_===a){l.circular=i[t];break}}else l.isLeaf=!0,l.keys=null;l.notLeaf=!l.isLeaf,l.notRoot=!l.isRoot}d();var p=e.call(l,l.node);return void 0!==p&&l.update&&l.update(p),c.before&&c.before.call(l,l.node),u?("object"!=typeof l.node||null===l.node||l.circular||(i.push(l),d(),le(l.keys,(function(e,i){o.push(e),c.pre&&c.pre.call(l,l.node[e],e);var r=t(l.node[e]);n&&ge.call(l.node,e)&&(l.node[e]=r.node),r.isLast=i===l.keys.length-1,r.isFirst=0===i,c.post&&c.post.call(l,r),o.pop()})),i.pop()),c.after&&c.after.call(l,l.node),l):l}(t).node}function me(t){this.value=t}function _e(t){return new me(t)}me.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!ge.call(e,o))return;e=e[o]}return e},me.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!ge.call(e,o))return!1;e=e[o]}return!0},me.prototype.set=function(t,e){for(var n=this.value,o=0;o<t.length-1;o++){var i=t[o];ge.call(n,i)||(n[i]={}),n=n[i]}return n[t[o]]=e,e},me.prototype.map=function(t){return ve(this.value,t,!0)},me.prototype.forEach=function(t){return this.value=ve(this.value,t,!1),this.value},me.prototype.reduce=function(t,e){var n=1===arguments.length,o=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(o=t.call(this,o,e))})),o},me.prototype.paths=function(){var t=[];return this.forEach((function(){t.push(this.path)})),t},me.prototype.nodes=function(){var t=[];return this.forEach((function(){t.push(this.node)})),t},me.prototype.clone=function(){var t=[],e=[];return function n(o){for(var i=0;i<t.length;i++)if(t[i]===o)return e[i];if("object"==typeof o&&null!==o){var r=ye(o);return t.push(o),e.push(r),le(he(o),(function(t){r[t]=n(o[t])})),t.pop(),e.pop(),r}return o}(this.value)},le(he(me.prototype),(function(t){_e[t]=function(e){var n=[].slice.call(arguments,1),o=new me(e);return o[t].apply(o,n)}}));var be=_e,Ee=Oe;function Oe(t){if(!(this instanceof Oe))return new Oe(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Oe.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Oe.prototype.equals=function(t){var e;return e=t instanceof Oe?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Oe.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Oe.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Oe?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Oe.prototype.bbox=function(){return this._valid?this._bbox:null},Oe.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Oe.prototype.intersect=function(t){return this._valid?(e=t instanceof Oe?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Oe.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Oe.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ce=function(t){if(!t)return[];var e=ae(re(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(se(t.geometry.coordinates)))})),n},Te=be,Se=Ee,Ie={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ae=Object.keys(Ie);function xe(t){for(var e=Se(),n=Ce(t),o=0;o<n.length;o++)e.include(n[o]);return e}te.exports=function(t){return xe(t).bbox()},te.exports.polygon=function(t){return xe(t).polygon()},te.exports.bboxify=function(t){return Te(t).map((function(t){t&&(Ae.some((function(e){return!!t[e]&&-1!==Ie[e].indexOf(t.type)}))&&(t.bbox=xe(t).bbox(),this.update(t)))}))};var Me=r(te.exports),Ne=-90,Le=90,we=T,Pe=S,Re=-270,ke=270;function Fe(t,e){var n=Ne,o=Le,i=Ne,r=Le,a=ke,s=Re;t.forEach((function(t){var e=Me(t),c=e[1],u=e[3],l=e[0],d=e[2];c>n&&(n=c),u<o&&(o=u),u>i&&(i=u),c<r&&(r=c),l<a&&(a=l),d>s&&(s=d)}));var c=e;return n+c.lat>Pe&&(c.lat=Pe-n),i+c.lat>Le&&(c.lat=Le-i),o+c.lat<we&&(c.lat=we-o),r+c.lat<Ne&&(c.lat=Ne-r),a+c.lng<=Re&&(c.lng+=360*Math.ceil(Math.abs(c.lng)/360)),s+c.lng>=ke&&(c.lng-=360*Math.ceil(Math.abs(c.lng)/360)),c}function Ue(t,e,n){var o=Fe(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,i=t.getCoordinates(),r=function(t){var e={lng:t[0]+o.lng,lat:t[1]+o.lat};return[e.lng,e.lat]},a=function(t){return t.map((function(t){return r(t)}))};t.type===v.POINT?e=r(i):t.type===v.LINE_STRING||t.type===v.MULTI_POINT?e=i.map(r):t.type===v.POLYGON||t.type===v.MULTI_LINE_STRING?e=i.map(a):t.type===v.MULTI_POLYGON&&(e=i.map((function(t){return t.map((function(t){return a(t)}))}))),t.incomingCoords(e),n.afterRender((function(e){return t.move(e)}))}))}var De={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),this.setState(n)},fireUpdate:function(){this.map.fire(_.UPDATE,{action:b.MOVE,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),o=!1;if(e.length>1){o=!0;var i=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==i&&(o=!1)}))}var r=n.length>0,a=e.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:r,trash:a})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new w).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){$t.enable(this),this.destroy()},onMouseMove:function(t,e){return Gt(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};De.onTap=De.onClick=function(t,e){if(!Q(this._ctx,e)){if(jt(e)){if(V(this,{e:e,type:"clickNoTarget"}),H(this._ctx))return;return this.clickAnywhere(t,e)}return kt(E.VERTEX)(e)?this.clickOnVertex(t,e):Gt(e)?this.clickOnFeature(t,e):void 0}},De.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),$t.enable(this),this.stopExtendedInteractions(t)},De.clickOnVertex=function(t,e){var n=this;this.changeMode(m.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.afterRender((function(){return B(n,{e:e})})),this.updateUIClasses({mouse:g.MOVE})},De.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},De.clickOnFeature=function(t,e){var n=this;$t.disable(this),this.stopExtendedInteractions(t);var o=Vt(e),i=this.getSelectedIds(),r=e.featureTarget.properties.id,a=this.isSelected(r);if(!o&&a&&this.getFeature(r).type!==v.POINT)return this.changeMode(m.DIRECT_SELECT,{featureId:r});a&&o?(this.deselect(r),this.updateUIClasses({mouse:g.POINTER}),1===i.length&&$t.enable(this)):!a&&o?(this.select(r),this.updateUIClasses({mouse:g.MOVE})):a||o||(i.forEach((function(t){return n.doRender(t)})),this.setSelected(r),this.updateUIClasses({mouse:g.MOVE})),this.doRender(r)},De.onMouseDown=function(t,e){return Ut(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&Ft(e)?this.startBoxSelect(t,e):void 0},De.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=Ht(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},De.onTouchStart=function(t,e){if(Ut(e))return this.startOnActiveFeature(t,e)},De.onDrag=function(t,e){if(!X(this._ctx))return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},De.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:g.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(f.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=Ht(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),i=Math.max(t.boxSelectStartLocation.x,n.x),r=Math.min(t.boxSelectStartLocation.y,n.y),a=Math.max(t.boxSelectStartLocation.y,n.y),s="translate("+o+"px, "+r+"px)";t.boxSelectElement.style.transform=s,t.boxSelectElement.style.WebkitTransform=s,t.boxSelectElement.style.width=i-o+"px",t.boxSelectElement.style.height=a-r+"px"},De.dragMove=function(t,e){!1===t.dragMoving&&this._reodUndoAdd({dragMoveLocation:t.dragMoveLocation}),t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Ue(this.getSelected(),n,this),t.dragMoveLocation=e.lngLat},De.onTouchEnd=De.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var o=[t.boxSelectStartLocation,Ht(e.originalEvent,this.map.getContainer())],i=this.featuresAt(null,o,"click"),r=this.getUniqueIds(i).filter((function(t){return!n.isSelected(t)}));r.length&&(this.select(r),r.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:g.MOVE}))}this.stopExtendedInteractions(t)},De.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?O.ACTIVE:O.INACTIVE,n(e),this.fireActionable(),e.properties.active===O.ACTIVE&&e.geometry.type!==v.POINT&&qt(e,void 0,void 0,m.SIMPLE_SELECT).forEach(n)},De.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},De.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],o=t[0].type.replace("Multi",""),i=0;i<t.length;i++){var r=t[i];if(r.type.replace("Multi","")!==o)return;r.type.includes("Multi")?r.getCoordinates().forEach((function(t){e.push(t)})):e.push(r.getCoordinates()),n.push(r.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:v.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:e}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(_.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},De.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],o=[],i=function(i){var r=e[i];t.isInstanceOf("MultiFeature",r)&&(r.getFeatures().forEach((function(e){t.addFeature(e),e.properties=r.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(r.id,{silent:!0}),o.push(r.toGeoJSON()))},r=0;r<e.length;r++)i(r);n.length>1&&this.map.fire(_.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}},De._reodUndoAdd=function(t){var e=this;this.redoUndo.undoStack.push(JSON.parse(JSON.stringify(t))),this.afterRender((function(){return e.redoUndo.fireChange({type:"add"})}))},De._redoOrUndo=function(t){var e=this;if(t){var n=this.redoUndo[t+"Stack"].pop();if(n){var o=this.getState(),i=JSON.parse(JSON.stringify({dragMoveLocation:o.dragMoveLocation}));this.redoUndo["undo"===t?"redoStack":"undoStack"].push(i);var r={lng:n.dragMoveLocation.lng-o.dragMoveLocation.lng,lat:n.dragMoveLocation.lat-o.dragMoveLocation.lat};o.dragMoveLocation=n.dragMoveLocation;var a=this.getSelected();Ue(a,r,this),a.forEach((function(t){return t.execMeasure()})),this.afterRender((function(){return e.redoUndo.fireChange({type:t})})),this._ctx.store.render()}}},De.undo=function(){this._redoOrUndo("undo")},De.redo=function(){this._redoOrUndo("redo")};var je=kt(E.VERTEX),Ge=kt(E.MIDPOINT),Be={fireUpdate:function(){this.map.fire(_.UPDATE,{action:b.CHANGE_COORDINATES,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),this.map.dragRotate.disable(),this.map.touchPitch.disable(),this.map.touchZoomRotate.disable(),function(t,e){return t.options.disabledMovePolgon&&0===e.selectedCoordPaths.length}(this._ctx,t)||(t.canDragMove=!0),t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),this.map.dragRotate.enable(),this.map.touchPitch.enable(),this.map.touchZoomRotate.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){var n=this;this.startDragging(t,e);var o=e.featureTarget.properties,i=t.selectedCoordPaths.indexOf(o.coord_path);Vt(e)||-1!==i?Vt(e)&&-1===i&&t.selectedCoordPaths.push(o.coord_path):t.selectedCoordPaths=[o.coord_path];var r=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(r),this.afterRender((function(){return B(n,{e:e})}))}};Be.onMidpoint=function(t,e){var n=this;this.startDragging(t,e);var o=e.featureTarget.properties;this.afterRender((function(){return o={e:e},void(t=n).map.fire(_.ON_MIDPOINT,j(t,o));var t,o})),this._reodUndoAdd({selectedCoordPaths:t.selectedCoordPaths}),t.feature.addCoordinate(o.coord_path,o.lng,o.lat),this.fireUpdate(),t.selectedCoordPaths=[o.coord_path]},Be.pathsToCoordinates=function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},Be.onFeature=function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},Be.dragFeature=function(t,e,n){Ue(this.getSelected(),n,this),t.dragMoveLocation=e.lngLat},Be.dragVertex=function(t,e,n){var o=this;if(!function(t,e){return!(!e.originalEvent.changedTouches||2!==e.originalEvent.changedTouches.length)&&t.options.disabledDragVertexWithTwoFingersZoom}(this._ctx,e)){for(var i=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),r=Fe(i.map((function(t){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:t}}})),n),a=0;a<i.length;a++){var s=i[a];t.feature.updateCoordinate(t.selectedCoordPaths[a],s[0]+r.lng,s[1]+r.lat)}e.state=t,this.afterRender((function(){return n={e:e},void(t=o).map.fire(_.DRAG_VERTEX,j(t,n));var t,n}))}},Be.clickNoTarget=function(){this.changeMode(m.SIMPLE_SELECT)},Be.clickInactive=function(){this.changeMode(m.SIMPLE_SELECT)},Be.clickActiveFeature=function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},Be.onSetup=function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===v.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,o.selectedCoordPaths)),this.setSelected(e),$t.disable(this),this.setActionableState({trash:!0}),this.setState(o)},Be.onStop=function(){$t.enable(this),this.clearSelectedCoordinates(),this.destroy()},Be.toDisplayFeatures=function(t,e,n){t.featureId===e.properties.id?(e.properties.active=O.ACTIVE,n(e),qt(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths},void 0,m.DIRECT_SELECT).forEach(n)):(e.properties.active=O.INACTIVE,n(e)),this.fireActionable(t)},Be.onTrash=function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(m.SIMPLE_SELECT,{}))},Be.onMouseMove=function(t,e){var n=Ut(e),o=je(e),i=Ge(e),r=0===t.selectedCoordPaths.length;return n&&r||o&&!r?this.updateUIClasses({mouse:g.MOVE}):this.updateUIClasses({mouse:g.NONE}),(o||n||i)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},Be.onMouseOut=function(t){return t.dragMoving&&this.fireUpdate(),!0},Be.onTouchStart=Be.onMouseDown=function(t,e){return je(e)?this.onVertex(t,e):Ut(e)?this.onFeature(t,e):Ge(e)?this.onMidpoint(t,e):void 0},Be.onDrag=function(t,e){var n=this;if(!0===t.canDragMove){!1===t.dragMoving&&this._reodUndoAdd({selectedCoordPaths:t.selectedCoordPaths}),t.dragMoving=!0,e.originalEvent.stopPropagation();var o="null",i={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?(this.dragVertex(t,e,i),o="dragVertex"):(this.dragFeature(t,e,i),o="dragFeature"),t.dragMoveLocation=e.lngLat,this.afterRender((function(){return i={e:e,type:o},void(t=n).map.fire(_.DRAG,j(t,i));var t,i}))}},Be.onClick=function(t,e){var n=this;if(!Q(this._ctx,e)){if(jt(e)){if(this.afterRender((function(){return V(n,{e:e,type:"clickNoTarget"})})),H(this._ctx))return;return this.clickNoTarget(t,e)}if(Ut(e))return this.afterRender((function(){return V(n,{e:e,type:"clickActiveFeature"})})),this.clickActiveFeature(t,e);if(Dt(e))return this.afterRender((function(){return V(n,{e:e,type:"clickInactiveFeature"})})),this.clickInactive(t,e);this.stopDragging(t),this.afterRender((function(){return V(n,{e:e,type:"null"})}))}},Be.onTap=function(t,e){var n=this;if(!Q(this._ctx,e)){if(jt(e)){if(this.afterRender((function(){return V(n,{e:e,type:"clickNoTarget"})})),H(this._ctx))return;return this.clickNoTarget(t,e)}return Ut(e)?(this.afterRender((function(){return V(n,{e:e,type:"clickActiveFeature"})})),this.clickActiveFeature(t,e)):Dt(e)?(this.afterRender((function(){return V(n,{e:e,type:"clickInactiveFeature"})})),this.clickInactive(t,e)):void this.afterRender((function(){return V(n,{e:e,type:"null"})}))}},Be.onTouchEnd=Be.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)},Be._reodUndoAdd=function(t){var e=JSON.parse(JSON.stringify(Object.assign({},t,{coordinates:this.getState().feature.getCoordinates()})));this.redoUndo.undoStack.push(e),this.redoUndo.fireChange({type:"add"})},Be._redoOrUndo=function(t){var e=this;if(t){var n=this.redoUndo[t+"Stack"].pop();if(n){var o=this.getState();this.redoUndo["undo"===t?"redoStack":"undoStack"].push({coordinates:o.feature.getCoordinates(),selectedCoordPaths:o.selectedCoordPaths}),o.selectedCoordPaths&&(o.selectedCoordPaths=n.selectedCoordPaths),o.feature.setCoordinates(n.coordinates),o.feature.execMeasure(),this._ctx.store.render(),this.afterRender((function(){return e.redoUndo.fireChange({type:t})}))}}},Be.undo=function(){this._redoOrUndo("undo")},Be.redo=function(){this._redoOrUndo("redo")};var Ve={};function Je(t,e){return!!t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])}Ve.onSetup=function(){var t=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:[]}},{declareFeature:!0});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(y.POINT),this.setActionableState({trash:!0}),this.setState({point:t})},Ve.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Ve.onTap=Ve.onClick=function(t,e){var n=this;this.updateUIClasses({mouse:g.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.afterRender((function(){return J(n,{e:e})})),this.map.fire(_.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.point.id]})},Ve.onStop=function(t){this.activateUIButton(),this.destroy(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},Ve.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.point.id;if(e.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(e)},Ve.onTrash=Ve.stopDrawingAndRemove,Ve.onKeyUp=function(t,e){if(Jt(e)||Yt(e))return this.stopDrawingAndRemove(t,e)},Ve.drawByCoordinate=function(t){this.onClick(this.getState(),{lngLat:{lng:t[0],lat:t[1]}})};var Ye={onSetup:function(t){void 0===t&&(t={});var e=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POLYGON,coordinates:[[]]}},{declareFeature:!0});return this.addFeature(e),this.clearSelectedFeatures(),$t.disable(this),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(t.button||y.POLYGON),this.setActionableState({trash:!0}),this.setState({polygon:e,currentVertexPosition:0})},clickAnywhere:function(t,e){var n=this;if(t.currentVertexPosition>0&&Je(e,t.polygon.coordinates[0][t.currentVertexPosition-1])){if(W(this._ctx))return;return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]})}this.updateUIClasses({mouse:g.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),this.afterRender((function(){return J(n,{e:e})}))},clickOnVertex:function(t,e){if(!z(this._ctx))return"function"==typeof e?e(t):this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Bt(e)&&this.updateUIClasses({mouse:g.POINTER})}};Ye.onTap=Ye.onClick=function(t,e){return W(this._ctx)?this.clickAnywhere(t,e):Bt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},Ye.onKeyUp=function(t,e){Jt(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)):Yt(e)&&this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},Ye.onStop=function(t,e){if(this.updateUIClasses({mouse:g.NONE}),$t.enable(this),this.activateUIButton(),this.destroy(),void 0!==this.getFeature(t.polygon.id)){if(t.polygon.removeCoordinate("0."+t.currentVertexPosition),"function"==typeof e)return e(t);t.polygon.isValid()?this.map.fire(_.CREATE,{features:[t.polygon.toGeoJSON()]}):this.deleteFeature([t.polygon.id],{silent:!0})}},Ye.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(e);if(0!==e.geometry.coordinates.length){var i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=E.FEATURE,n(Xt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1,void 0,m.DRAW_POLYGON)),i>3){var r=e.geometry.coordinates[0].length-3;r>0&&e.geometry.coordinates[0].slice(1,r).forEach((function(e,o){n(Xt(t.polygon.id,e,"0."+(o+1),!1,!1,m.DRAW_POLYGON))})),n(Xt(t.polygon.id,e.geometry.coordinates[0][r],"0."+r,!1,!0,m.DRAW_POLYGON)),n(Y(t.polygon.id,e.geometry.coordinates[0][r],"0."+r,!1,!1,m.DRAW_POLYGON)),n(Y(t.polygon.id,e.geometry.coordinates[0][r],"0."+(r+1),!1,!0,m.DRAW_POLYGON))}if(i<=4){var a=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:v.FEATURE,properties:e.properties,geometry:{coordinates:a,type:v.LINE_STRING}}),3===i)return}return n(e)}}},Ye.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Ye.drawByCoordinate=function(t){var e=this,n=this.getState();n.polygon.addCoordinate("0."+n.currentVertexPosition++,t[0],t[1]),this.afterRender((function(){return J(e)}),!0)};var ze={};ze.onSetup=function(t){var e,n,o=(t=t||{}).featureId,i="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var r=t.from;if(r&&"Feature"===r.type&&r.geometry&&"Point"===r.geometry.type&&(r=r.geometry),r&&"Point"===r.type&&r.coordinates&&2===r.coordinates.length&&(r=r.coordinates),!r||!Array.isArray(r))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=e.coordinates.length-1;if(e.coordinates[a][0]===r[0]&&e.coordinates[a][1]===r[1])n=a+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[a]));else{if(e.coordinates[0][0]!==r[0]||e.coordinates[0][1]!==r[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.LINE_STRING,coordinates:[]}},{declareFeature:!0}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),$t.disable(this),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(y.LINE),this.setActionableState({trash:!0}),this.setState({line:e,currentVertexPosition:n,direction:i})},ze.clickAnywhere=function(t,e){var n=this;if(t.currentVertexPosition>0&&Je(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&Je(e,t.line.coordinates[t.currentVertexPosition+1])){if(W(this._ctx))return;return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]})}this.updateUIClasses({mouse:g.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat),this.afterRender((function(){return J(n,{e:e})}))},ze.clickOnVertex=function(t){if(!z(this._ctx))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]})},ze.onMouseMove=function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Bt(e)&&this.updateUIClasses({mouse:g.POINTER})},ze.onTap=ze.onClick=function(t,e){return W(this._ctx)?this.clickAnywhere(t,e):Bt(e)?this.clickOnVertex(t,e):void this.clickAnywhere(t,e)},ze.onKeyUp=function(t,e){Yt(e)?this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]}):Jt(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT))},ze.onStop=function(t){$t.enable(this),this.activateUIButton(),this.destroy(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(_.CREATE,{features:[t.line.toGeoJSON()]}):this.deleteFeature([t.line.id],{silent:!0}))},ze.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},ze.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=E.FEATURE,e.geometry.coordinates.forEach((function(o,i){var r=""+(i+1);if(i===e.geometry.coordinates.length-1)n(Y(t.line.id,o,r,!1,!0,m.DRAW_LINE_STRING));else{var a=i===e.geometry.coordinates.length-2;a&&n(Y(t.line.id,o,r,!1,!1,m.DRAW_LINE_STRING)),n(Xt(t.line.id,o,r,!1,a,m.DRAW_LINE_STRING))}})),n(e))},ze.drawByCoordinate=function(t){var e=this,n=this.getState();n.line.addCoordinate(n.currentVertexPosition++,t[0],t[1]),this.afterRender((function(){return J(e)}),!0)};var We=["inactive-fill-color","inactive-fill-outline-color","inactive-line-color"],Ze="wait-cut",Qe=Ye.onSetup,He=Ye.onMouseMove,Xe=Ye.clickOnVertex,Ke=Ye.onStop,qe=Ye.onTrash,$e=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&-1===e.indexOf(o)&&(n[o]=t[o]);return n}(Ye,["onSetup","onMouseMove","clickOnVertex","onStop","onTrash"]),tn=Object.assign({},{originOnSetup:Qe,originOnMouseMove:He,originClickOnVertex:Xe,originOnStop:Ke,originOnTrash:qe},$e);tn.onSetup=function(t){var e=this,n=ot({featureIds:[],highlightColor:"#73d13d",continuous:!0,lineWidth:.001,lineWidthUnit:"kilometers"},t),o=n.highlightColor,i=n.featureIds,r=[];if((r=(r=i.length?i.map((function(t){return e.getFeature(t).toGeoJSON()})):this.getSelected().map((function(t){return t.toGeoJSON()}))).filter((function(t){return t.geometry.type===v.POLYGON||t.geometry.type===v.MULTI_POLYGON}))).length<1)throw new Error("Please select a feature/features (Polygon or MultiPolygon) to split!");this._features=r,this._options=n,this._undoStack=[],this._redoStack=[],this._redoType="",this._undoType="",this._batchHighlight(r,o);var a=this.originOnSetup({button:m.CUT_POLYGON});return window.state=a,window.p=this,this.setState(a)},tn.onMouseMove=function(t,e){this.updateUIClasses({mouse:g.ADD}),this.originOnMouseMove(t,e)},tn.onStop=function(t){var e=this;this.originOnStop(t,(function(){e._cancelCut(),e.deleteFeature([t.polygon.id],{silent:!0})}))},tn.clickOnVertex=function(t){var e=this;this.originClickOnVertex(t,(function(){var n=t.polygon.toGeoJSON();n.geometry.coordinates[0].splice(t.currentVertexPosition,1),e._cut(n),e._options.continuous?e._resetState():e.deleteFeature([t.polygon.id],{silent:!0})}))},tn.onTrash=function(t){this.originOnTrash(t),this._cancelCut()},tn.fireUpdate=function(t){this.map.fire(_.UPDATE,{action:b.CHANGE_COORDINATES,features:t.toGeoJSON()})},tn.getWaitCutFeatures=function(){return JSON.parse(JSON.stringify(this._features))},tn.undo=function(){var t=this,e=this.redoUndo.undo()||{},n=e.type,i=e.stack;"cut"===n&&this.beforeRender((function(){var e=t.getState(),n={geoJson:i.geoJson};i.collection.forEach((function(e){var n=o.combine(e.difference),i=o.union(e.intersect,n.features[0]),r=t.newFeature(i),a=e.difference.features,s=a[0],c=a.slice(1);r.id=s.id,e.difference.features.forEach((function(e){return t._ctx.store.get(e.id).measure.delete()})),c.forEach((function(e){return t.deleteFeature(e.id)})),t.addFeature(r),t._execMeasure(r),t._setHighlight(r.id,t._options.highlightColor)})),e.currentVertexPosition=i.geoJson.geometry.coordinates[0].length-1,e.polygon.setCoordinates(i.geoJson.geometry.coordinates),t.redoUndo.setRedoUndoStack((function(t){return{redoStack:t.redoStack.concat([n])}})),t._updateFeatures()}))},tn.redo=function(){var t=this,e=this.redoUndo.redo()||{},n=e.type,o=e.stack;"cut"===n&&this.beforeRender((function(){t._cut(o.geoJson),t._resetState()}))},tn._setButtonStatus=function(t){var e=Object.assign({},{undo:!this._undoStack.length,redo:!this._redoStack.length},t);this._ctx.ui.setDisableButtons((function(t){return t.undo={disabled:e.undo},t.redo={disabled:e.redo},t}))},tn._execMeasure=function(t){var e=this._ctx.api;t&&e.options.measureOptions&&(t.measure.setOptions(e.options.measureOptions),t.execMeasure())},tn._setHighlight=function(t,e){var n=this._ctx.api;We.forEach((function(o){return n.setFeatureProperty(t,o,e)})),n.setFeatureProperty(t,Ze,!!e||void 0)},tn._cut=function(t){var e=this,n=this._ctx,i=n.store,r=n.api,a=this._options.highlightColor,s={geoJson:t,collection:[]};this._features.forEach((function(n){if(n.geometry.type===v.POLYGON||n.geometry.type===v.MULTI_POLYGON){var c=o.difference(n,t);if(!c)return;var u=e.newFeature(c);i.get(n.id).measure.delete();var l={intersect:o.intersect(n,t)};if(u.features){var d=u.features.sort((function(t,e){return o.area(t)-o.area(e)})),p=d[0],f=d.slice(1);p.id=n.id,e.addFeature(p),r.add(o.featureCollection(f.map((function(t){return t.toGeoJSON()})))),e._execMeasure(p),e._continuous((function(){return e._batchHighlight(u.features,a)})),l.intersect&&(l.difference=o.featureCollection(u.features.map((function(t){return t.toGeoJSON()}))))}else u.id=n.id,e.addFeature(u),e._execMeasure(u),e._continuous((function(){return e._setHighlight(u.id,a)})),l.intersect&&(l.difference=o.featureCollection([u.toGeoJSON()]));l.intersect&&l.difference&&s.collection.push(l)}else console.info("The feature is not Polygon/MultiPolygon!")})),this.redoUndo.setRedoUndoStack((function(t){return{undoStack:t.undoStack.concat([s])}})),i.setDirty()},tn._continuous=function(t){this._options.continuous&&(t(),this._updateFeatures())},tn._updateFeatures=function(){this._features=this._ctx.store.getAll().filter((function(t){return t.getProperty(Ze)})).map((function(t){return t.toGeoJSON()}))},tn._cancelCut=function(){this._features.length&&(this._batchHighlight(this._features),this._features=[])},tn._batchHighlight=function(t,e){var n=this;t.length&&t.forEach((function(t){return n._setHighlight(t.id,e)}))},tn._resetState=function(t){var e=this.getState();e.currentVertexPosition=0,e.polygon.setCoordinates([[]])};var en=function(t){var e;return Object.assign({},t,((e={})[m.CUT_POLYGON]=tn,e))}({simple_select:De,direct_select:Be,draw_point:Ve,draw_polygon:Ye,draw_line_string:ze}),nn={defaultMode:m.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Rt,modes:en,controls:{},userProperties:!1,measureOptions:{enable:!0}},on={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0,undo:!0,redo:!0,finish:!0,cancel:!0,draw_center:!0,cut_line:!0,cut_polygon:!0},rn={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1,undo:!1,redo:!1,cancel:!0,draw_center:!0,cut_line:!0,cut_polygon:!0};function an(t,e){return t.map((function(t){return t.source?t:ot(t,{id:t.id+"."+e,source:"hot"===e?h.HOT:h.COLD})}))}function sn(t){return an(t,"cold").concat(an(t,"hot"))}var cn={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",o=1,i=2,r=9007199254740991,a="[object Arguments]",s="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",l="[object Date]",d="[object Error]",p="[object Function]",f="[object GeneratorFunction]",h="[object Map]",g="[object Number]",y="[object Null]",v="[object Object]",m="[object Promise]",_="[object Proxy]",b="[object RegExp]",E="[object Set]",O="[object String]",C="[object Symbol]",T="[object Undefined]",S="[object WeakMap]",I="[object ArrayBuffer]",A="[object DataView]",x=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[a]=N[s]=N[I]=N[u]=N[A]=N[l]=N[d]=N[p]=N[h]=N[g]=N[v]=N[b]=N[E]=N[O]=N[S]=!1;var L="object"==typeof global&&global&&global.Object===Object&&global,w="object"==typeof self&&self&&self.Object===Object&&self,P=L||w||Function("return this")(),R=e&&!e.nodeType&&e,k=R&&t&&!t.nodeType&&t,F=k&&k.exports===R,U=F&&L.process,D=function(){try{return U&&U.binding&&U.binding("util")}catch(t){}}(),j=D&&D.isTypedArray;function G(t,e){for(var n=-1,o=null==t?0:t.length;++n<o;)if(e(t[n],n,t))return!0;return!1}function B(t){var e=-1,n=Array(t.size);return t.forEach((function(t,o){n[++e]=[o,t]})),n}function V(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var J,Y,z,W=Array.prototype,Z=Function.prototype,Q=Object.prototype,H=P["__core-js_shared__"],X=Z.toString,K=Q.hasOwnProperty,q=(J=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",$=Q.toString,tt=RegExp("^"+X.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=F?P.Buffer:void 0,nt=P.Symbol,ot=P.Uint8Array,it=Q.propertyIsEnumerable,rt=W.splice,at=nt?nt.toStringTag:void 0,st=Object.getOwnPropertySymbols,ct=et?et.isBuffer:void 0,ut=(Y=Object.keys,z=Object,function(t){return Y(z(t))}),lt=Dt(P,"DataView"),dt=Dt(P,"Map"),pt=Dt(P,"Promise"),ft=Dt(P,"Set"),ht=Dt(P,"WeakMap"),gt=Dt(Object,"create"),yt=Vt(lt),vt=Vt(dt),mt=Vt(pt),_t=Vt(ft),bt=Vt(ht),Et=nt?nt.prototype:void 0,Ot=Et?Et.valueOf:void 0;function Ct(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Tt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function St(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function It(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new St;++e<n;)this.add(t[e])}function At(t){var e=this.__data__=new Tt(t);this.size=e.size}function xt(t,e){var n=zt(t),o=!n&&Yt(t),i=!n&&!o&&Wt(t),r=!n&&!o&&!i&&Kt(t),a=n||o||i||r,s=a?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],c=s.length;for(var u in t)!e&&!K.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||r&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Bt(u,c))||s.push(u);return s}function Mt(t,e){for(var n=t.length;n--;)if(Jt(t[n][0],e))return n;return-1}function Nt(t){return null==t?void 0===t?T:y:at&&at in Object(t)?function(t){var e=K.call(t,at),n=t[at];try{t[at]=void 0;var o=!0}catch(t){}var i=$.call(t);o&&(e?t[at]=n:delete t[at]);return i}(t):function(t){return $.call(t)}(t)}function Lt(t){return Xt(t)&&Nt(t)==a}function wt(t,e,n,r,c){return t===e||(null==t||null==e||!Xt(t)&&!Xt(e)?t!=t&&e!=e:function(t,e,n,r,c,p){var f=zt(t),y=zt(e),m=f?s:Gt(t),_=y?s:Gt(e),T=(m=m==a?v:m)==v,S=(_=_==a?v:_)==v,x=m==_;if(x&&Wt(t)){if(!Wt(e))return!1;f=!0,T=!1}if(x&&!T)return p||(p=new At),f||Kt(t)?kt(t,e,n,r,c,p):function(t,e,n,r,a,s,c){switch(n){case A:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case I:return!(t.byteLength!=e.byteLength||!s(new ot(t),new ot(e)));case u:case l:case g:return Jt(+t,+e);case d:return t.name==e.name&&t.message==e.message;case b:case O:return t==e+"";case h:var p=B;case E:var f=r&o;if(p||(p=V),t.size!=e.size&&!f)return!1;var y=c.get(t);if(y)return y==e;r|=i,c.set(t,e);var v=kt(p(t),p(e),r,a,s,c);return c.delete(t),v;case C:if(Ot)return Ot.call(t)==Ot.call(e)}return!1}(t,e,m,n,r,c,p);if(!(n&o)){var M=T&&K.call(t,"__wrapped__"),N=S&&K.call(e,"__wrapped__");if(M||N){var L=M?t.value():t,w=N?e.value():e;return p||(p=new At),c(L,w,n,r,p)}}if(!x)return!1;return p||(p=new At),function(t,e,n,i,r,a){var s=n&o,c=Ft(t),u=c.length,l=Ft(e),d=l.length;if(u!=d&&!s)return!1;var p=u;for(;p--;){var f=c[p];if(!(s?f in e:K.call(e,f)))return!1}var h=a.get(t);if(h&&a.get(e))return h==e;var g=!0;a.set(t,e),a.set(e,t);var y=s;for(;++p<u;){var v=t[f=c[p]],m=e[f];if(i)var _=s?i(m,v,f,e,t,a):i(v,m,f,t,e,a);if(!(void 0===_?v===m||r(v,m,n,i,a):_)){g=!1;break}y||(y="constructor"==f)}if(g&&!y){var b=t.constructor,E=e.constructor;b==E||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof E&&E instanceof E||(g=!1)}return a.delete(t),a.delete(e),g}(t,e,n,r,c,p)}(t,e,n,r,wt,c))}function Pt(t){return!(!Ht(t)||function(t){return!!q&&q in t}(t))&&(Zt(t)?tt:x).test(Vt(t))}function Rt(t){if(n=(e=t)&&e.constructor,o="function"==typeof n&&n.prototype||Q,e!==o)return ut(t);var e,n,o,i=[];for(var r in Object(t))K.call(t,r)&&"constructor"!=r&&i.push(r);return i}function kt(t,e,n,r,a,s){var c=n&o,u=t.length,l=e.length;if(u!=l&&!(c&&l>u))return!1;var d=s.get(t);if(d&&s.get(e))return d==e;var p=-1,f=!0,h=n&i?new It:void 0;for(s.set(t,e),s.set(e,t);++p<u;){var g=t[p],y=e[p];if(r)var v=c?r(y,g,p,e,t,s):r(g,y,p,t,e,s);if(void 0!==v){if(v)continue;f=!1;break}if(h){if(!G(e,(function(t,e){if(o=e,!h.has(o)&&(g===t||a(g,t,n,r,s)))return h.push(e);var o}))){f=!1;break}}else if(g!==y&&!a(g,y,n,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Ft(t){return function(t,e,n){var o=e(t);return zt(t)?o:function(t,e){for(var n=-1,o=e.length,i=t.length;++n<o;)t[i+n]=e[n];return t}(o,n(t))}(t,qt,jt)}function Ut(t,e){var n,o,i=t.__data__;return("string"==(o=typeof(n=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Dt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(n)?n:void 0}Ct.prototype.clear=function(){this.__data__=gt?gt(null):{},this.size=0},Ct.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ct.prototype.get=function(t){var e=this.__data__;if(gt){var o=e[t];return o===n?void 0:o}return K.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:K.call(e,t)},Ct.prototype.set=function(t,e){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=gt&&void 0===e?n:e,this},Tt.prototype.clear=function(){this.__data__=[],this.size=0},Tt.prototype.delete=function(t){var e=this.__data__,n=Mt(e,t);return!(n<0)&&(n==e.length-1?e.pop():rt.call(e,n,1),--this.size,!0)},Tt.prototype.get=function(t){var e=this.__data__,n=Mt(e,t);return n<0?void 0:e[n][1]},Tt.prototype.has=function(t){return Mt(this.__data__,t)>-1},Tt.prototype.set=function(t,e){var n=this.__data__,o=Mt(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this},St.prototype.clear=function(){this.size=0,this.__data__={hash:new Ct,map:new(dt||Tt),string:new Ct}},St.prototype.delete=function(t){var e=Ut(this,t).delete(t);return this.size-=e?1:0,e},St.prototype.get=function(t){return Ut(this,t).get(t)},St.prototype.has=function(t){return Ut(this,t).has(t)},St.prototype.set=function(t,e){var n=Ut(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this},It.prototype.add=It.prototype.push=function(t){return this.__data__.set(t,n),this},It.prototype.has=function(t){return this.__data__.has(t)},At.prototype.clear=function(){this.__data__=new Tt,this.size=0},At.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},At.prototype.get=function(t){return this.__data__.get(t)},At.prototype.has=function(t){return this.__data__.has(t)},At.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Tt){var o=n.__data__;if(!dt||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new St(o)}return n.set(t,e),this.size=n.size,this};var jt=st?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,o=null==t?0:t.length,i=0,r=[];++n<o;){var a=t[n];e(a,n,t)&&(r[i++]=a)}return r}(st(t),(function(e){return it.call(t,e)})))}:function(){return[]},Gt=Nt;function Bt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||M.test(t))&&t>-1&&t%1==0&&t<e}function Vt(t){if(null!=t){try{return X.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Jt(t,e){return t===e||t!=t&&e!=e}(lt&&Gt(new lt(new ArrayBuffer(1)))!=A||dt&&Gt(new dt)!=h||pt&&Gt(pt.resolve())!=m||ft&&Gt(new ft)!=E||ht&&Gt(new ht)!=S)&&(Gt=function(t){var e=Nt(t),n=e==v?t.constructor:void 0,o=n?Vt(n):"";if(o)switch(o){case yt:return A;case vt:return h;case mt:return m;case _t:return E;case bt:return S}return e});var Yt=Lt(function(){return arguments}())?Lt:function(t){return Xt(t)&&K.call(t,"callee")&&!it.call(t,"callee")},zt=Array.isArray;var Wt=ct||function(){return!1};function Zt(t){if(!Ht(t))return!1;var e=Nt(t);return e==p||e==f||e==c||e==_}function Qt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function Ht(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Xt(t){return null!=t&&"object"==typeof t}var Kt=j?function(t){return function(e){return t(e)}}(j):function(t){return Xt(t)&&Qt(t.length)&&!!N[Nt(t)]};function qt(t){return null!=(e=t)&&Qt(e.length)&&!Zt(e)?xt(t):Rt(t);var e}t.exports=function(t,e){return wt(t,e)}}(cn,cn.exports);var un=r(cn.exports);function ln(t,e){return t.length===e.length&&JSON.stringify(t.map((function(t){return t})).sort())===JSON.stringify(e.map((function(t){return t})).sort())}var dn={Polygon:bt,LineString:_t,Point:mt,MultiPolygon:Ct,MultiLineString:Ct,MultiPoint:Ct};var pn=Object.freeze({__proto__:null,CommonSelectors:zt,constrainFeatureMovement:Fe,createMidPoint:Kt,createSupplementaryPoints:qt,createVertex:Xt,doubleClickZoom:$t,euclideanDistance:at,featuresAt:R,getFeatureAtAndSetCursors:rt,isClick:lt,isEventAtCoordinates:Je,isTap:ft,mapEventToBoundingBox:L,ModeHandler:i,moveFeatures:Ue,sortFeatures:N,stringSetsAreEqual:ln,StringSet:w,theme:Rt,theme1:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["coalesce",["get","user_inactive-fill-color"],"#E1361B"],"fill-outline-color":["coalesce",["get","user_inactive-fill-outline-color"],"#E1361B"],"fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#E1361B","fill-outline-color":"#E1361B","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#E1361B","line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#E1361B","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-ringlike-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":8,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":6,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":4,"circle-color":"#E1361B"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#E1361B"}},{id:"gl-draw-point-stroke-ringlike-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"],["!has","user__edit-point"]],paint:{"circle-radius":9,"circle-color":"#E1361B"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"],["!has","user__edit-point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"],["!has","user__edit-point"]],paint:{"circle-radius":5,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-point-active-symbol",type:"symbol",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"],["==","user__edit-point","true"]],layout:{"icon-anchor":["coalesce",["get","user__edit-point-icon-anchor"],"bottom"],"icon-image":["coalesce",["get","user__edit-point-icon-image"],"gl-draw-icon2"],"icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0,"icon-size":["coalesce",["get","user__edit-point-icon-size"],1],"icon-offset":["coalesce",["get","user__edit-point-icon-offset"],[0,4]]}},{id:"gl-draw-line-second-to-last-point-symbol",type:"symbol",filter:["all",["==","meta","second_to_last_point"],["==","$type","Point"],["any",["==","mode","draw_line_string"],["==","mode","draw_polygon"]]],layout:{"icon-anchor":"bottom","icon-image":"gl-draw-icon2","icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0,"icon-size":.7}}],theme2:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["coalesce",["get","user_inactive-fill-color"],"#E1361B"],"fill-outline-color":["coalesce",["get","user_inactive-fill-outline-color"],"#E1361B"],"fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#E1361B","fill-outline-color":"#E1361B","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FFCF56","line-width":2,"line-dasharray":[4,3]}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FFCF56","line-width":2,"line-dasharray":[4,3]}},{id:"gl-draw-polygon-and-line-vertex-stroke-ringlike-symbol-inactive",type:"symbol",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],layout:{"icon-anchor":"bottom","icon-image":"gl-draw-icon3","icon-size":.45,"icon-offset":[0,16],"icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0}},{id:"gl-draw-polygon-and-line-vertex-stroke-symbol-inactive",type:"symbol",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],layout:{"icon-anchor":"bottom","icon-image":"gl-draw-icon3","icon-size":.45,"icon-offset":[0,16],"icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0}},{id:"gl-draw-polygon-and-line-vertex-symbol-inactive",type:"symbol",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],layout:{"icon-anchor":"bottom","icon-image":"gl-draw-icon3","icon-size":.45,"icon-offset":[0,16],"icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#E1361B"}},{id:"gl-draw-point-stroke-ringlike-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"],["!has","user__edit-point"]],paint:{"circle-radius":9,"circle-color":"#E1361B"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"],["!has","user__edit-point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"],["!has","user__edit-point"]],paint:{"circle-radius":5,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-point-symbol-active",type:"symbol",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"],["==","user__edit-point","true"]],layout:{"icon-anchor":["coalesce",["get","user__edit-point-icon-anchor"],"bottom"],"icon-image":["coalesce",["get","user__edit-point-icon-image"],"_edit-point-icon-image"],"icon-allow-overlap":!0,"text-ignore-placement":!0,"icon-ignore-placement":!0,"icon-size":["coalesce",["get","user__edit-point-icon-size"],1],"icon-offset":["coalesce",["get","user__edit-point-icon-offset"],[0,4]]}}],toDenseArray:xt}),fn=function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=ot(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=ot(rn,t.controls):e.controls=ot(on,t.controls),(e=ot(nn,e)).styles=sn(e.styles),e}(t)};e=function(t,e){return e.modes=m,e.getFeatureIdsAt=function(e){return R.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:v.FEATURE_COLLECTION,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:v.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map((function(t){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==v.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var o=t.store.createRenderBatch(),i=t.store.getAllIds().slice(),r=e.add(n),a=new w(r);return(i=i.filter((function(t){return!a.has(t)}))).length&&e.delete(i),o(),r},e.add=function(n){var o=JSON.parse(JSON.stringify(oe(n))).features.map((function(n){if(n.id=n.id||yt(),null===n.geometry)throw new Error("Invalid geometry: null");var o;if(void 0===t.store.get(n.id)||t.store.get(n.id).type!==n.geometry.type){var i=dn[n.geometry.type];if(void 0===i)throw new Error("Invalid geometry type: "+n.geometry.type+".");o=new i(t,n),t.store.add(o)}else(o=t.store.get(n.id)).properties=n.properties,un(o.getCoordinates(),n.geometry.coordinates)||o.incomingCoords(n.geometry.coordinates);return o&&e.options.measureOptions&&(o.measure.setOptions(e.options.measureOptions),o.execMeasure()),n.id}));return t.store.render(),o},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:v.FEATURE_COLLECTION,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==m.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===m.DIRECT_SELECT?t.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,o){return void 0===o&&(o={}),n===m.SIMPLE_SELECT&&e.getMode()===m.SIMPLE_SELECT?(ln(o.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(o.featureIds,{silent:!0}),t.store.render()),e):(n===m.DIRECT_SELECT&&e.getMode()===m.DIRECT_SELECT&&o.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,o,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,o,i){return t.store.setFeatureProperty(n,o,i),e},e.getFeatureTypeById=function(e){return t.store.get(e)},e.undo=function(){return t.events.undo(),e},e.redo=function(){return t.events.redo(),e},e.finish=function(n){return t.events.finish(n),e},e.cancel=function(n){return t.events.cancel(n),e},e.drawByCenter=function(){return t.events.drawByCoordinate(t.map.getCenter().toArray()),e},e.drawByCoordinate=function(n){return t.events.drawByCoordinate(n),e},e.setStyle=function(n){return t.options.styles.forEach((function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)})),t.options.styles=sn(n).map((function(e){return t.map.addLayer(e),e})),e},e.edit=function(t){var n=e.add(t),o=t.type,i=o===v.FEATURE?t:I.includes(o)?{type:v.FEATURE,properties:{},geometry:t}:null;return i?(i.geometry.type===v.POINT?e.changeMode("simple_select",{featureIds:n}):e.changeMode("direct_select",{featureId:n[0]}),e):(console.warn("only support edit feature or geometry"),e)},e.setMeasureOptions=function(n){return t.events.setMeasureOptions(n),e},e}(n,e),n.api=e;var o=Pt(n);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=y,e.options=t,e};function hn(t){fn(t,this)}return hn.modes=en,hn.constants=A,hn.lib=pn,hn}));
//# sourceMappingURL=mapbox-gl-draw.umd.min.js.map
