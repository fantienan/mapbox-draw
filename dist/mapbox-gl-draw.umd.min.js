!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mapbox-gl"),require("@turf/turf")):"function"==typeof define&&define.amd?define(["mapbox-gl","@turf/turf"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).MapboxDraw=t(e.mapboxgl,e.turf)}(this,(function(e,t){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=n(t),r=function(e,t){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(e,t,o){if(void 0===n[e])throw new Error("Invalid event type: "+e);n[e].push({selector:t,fn:o})},render:function(e){t.store.featureChanged(e)}},r=function(e,r){for(var i=n[e],a=i.length;a--;){var s=i[a];if(s.selector(r)){s.fn.call(o,r)||t.store.render(r),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop:function(){if(e.stop)return e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){r("drag",e)},click:function(e){r("click",e)},mousemove:function(e){r("mousemove",e)},mousedown:function(e){r("mousedown",e)},mouseup:function(e){r("mouseup",e)},mouseout:function(e){r("mouseout",e)},keydown:function(e){r("keydown",e)},keyup:function(e){r("keyup",e)},touchstart:function(e){r("touchstart",e)},touchmove:function(e){r("touchmove",e)},touchend:function(e){r("touchend",e)},tap:function(e){r("tap",e)},undo:function(){e.undo()},redo:function(){e.redo()},finish:function(){e.finish()},cancel:function(){e.cancel()},drawByCoordinate:function(t){e.drawByCoordinate(t)},getModeInstance:function(){return e.getModeInstance()},setMeasureOptions:function(t){e.setMeasureOptions(t)}}};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o.get?o:{enumerable:!0,get:function(){return e[t]}})})),n}var s={},u={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142},c=u;function l(e){var t=0;if(e&&e.length>0){t+=Math.abs(d(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(d(e[n]))}return t}function d(e){var t,n,o,r,i,a,s=0,u=e.length;if(u>2){for(a=0;a<u;a++)a===u-2?(o=u-2,r=u-1,i=0):a===u-1?(o=u-1,r=0,i=1):(o=a,r=a+1,i=a+2),t=e[o],n=e[r],s+=(p(e[i][0])-p(t[0]))*Math.sin(p(n[1]));s=s*c.RADIUS*c.RADIUS/2}return s}function p(e){return e*Math.PI/180}s.geometry=function e(t){var n,o=0;switch(t.type){case"Polygon":return l(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)o+=l(t.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)o+=e(t.geometries[n]);return o}},s.ring=d;var f={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect",CONTROL_BUTTON_UNDO:"mapbox-gl-draw_undo",CONTROL_BUTTON_REDO:"mapbox-gl-draw_redo",CONTROL_BUTTON_FINISH:"mapbox-gl-draw_finish",CONTROL_BUTTON_CANCEL:"mapbox-gl-draw_cancel",CONTROL_BUTTON_DRAW_CENTER:"mapbox-gl-draw_draw-center",MEASURE_MARKER:"mapbox-gl-draw-measure",CONTROL_BUTTON_CUT_LINE:"mapbox-gl-draw_cut-line",CONTROL_BUTTON_CUT_POLYGON:"mapbox-gl-draw_cut-polygon",CONTROL_POPOVER:"mapbox-gl-draw-popover",CONTROL:"mapbox-gl-draw-ctrl"},h={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},g={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},y={POLYGON:"polygon",LINE:"line_string",POINT:"point"},v={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},m={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static",CUT_POLYGON:"cut_polygon",CUT_LINE:"cut_line"},_={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine",REDO_UNDO:"draw.redoUndo",CLICK_ON_VERTEX:"draw.clickOnVertex",ON_MIDPOINT:"draw.onMidpoint",DRAG_VERTEX:"draw.dragVertex",CLICK_OR_TAB:"draw.clickOrTab",DRAG:"draw.drag",CLEAR_SELECTED_COORDINATES:"draw.clearSelectedCoordinates",ADD_POINT:"draw.addPoint",ADD:"draw.onAdd",POLYTON_CUT_CREATE:"draw.polygonCutCreate"},b={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},E={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex",LAST_POINT:"last_point",SECOND_TO_LAST_POINT:"second_to_last_point"},O={ACTIVE:"true",INACTIVE:"false"},C=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],S=-85,T=85,x=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"],M=Object.freeze({__proto__:null,classes:f,sources:h,cursors:g,types:y,geojsonTypes:v,modes:m,events:_,updateActions:b,meta:E,activeStates:O,interactions:C,LAT_MIN:-90,LAT_RENDERED_MIN:S,LAT_MAX:90,LAT_RENDERED_MAX:T,LNG_MIN:-270,LNG_MAX:270,GEOMETRYS:x}),I={Point:0,LineString:1,MultiLineString:1,Polygon:2};function A(e,t){var n=I[e.geometry.type]-I[t.geometry.type];return 0===n&&e.geometry.type===v.POLYGON?e.area-t.area:n}function N(e){return e.map((function(e){return e.geometry.type===v.POLYGON&&(e.area=s.geometry({type:v.FEATURE,property:{},geometry:e.geometry})),e})).sort(A).map((function(e){return delete e.area,e}))}function P(e,t){return void 0===t&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function L(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,n=e.length;t<n;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}L.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},L.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},L.prototype.has=function(e){return("string"==typeof e||"number"==typeof e)&&(void 0!==this._items[e]||void 0!==this._nums[e])},L.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach((function(n){t.push({k:n,v:e._items[n]})})),Object.keys(this._nums).forEach((function(n){t.push({k:JSON.parse(n),v:e._nums[n]})})),t.sort((function(e,t){return e.v-t.v})).map((function(e){return e.k}))},L.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var w=[E.FEATURE,E.MIDPOINT,E.VERTEX],R={click:function(e,t,n){return k(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return k(e,t,n,n.options.touchBuffer)}};function k(e,t,n,o){if(null===n.map)return[];var r=e?P(e,o):t,i={};n.options.styles&&(i.layers=n.options.styles.map((function(e){return e.id})));var a=n.map.queryRenderedFeatures(r,i).filter((function(e){return-1!==w.indexOf(e.properties.meta)})),s=new L,u=[];return a.forEach((function(e){var t=e.properties.id;s.has(t)||(s.add(t),u.push(e))})),N(u)}var F="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAApCAYAAAAmukmKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkQ4MDgwMUNENTg0ODExRUVBNjUwODMyMzhEQjFEMDY2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkQ4MDgwMUNFNTg0ODExRUVBNjUwODMyMzhEQjFEMDY2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RDgwODAxQ0I1ODQ4MTFFRUE2NTA4MzIzOERCMUQwNjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RDgwODAxQ0M1ODQ4MTFFRUE2NTA4MzIzOERCMUQwNjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5YUW5BAAAD0UlEQVR42uyXWUwTURRA70xbptQCATW2QllEFlkEoxGi4o+iBkQNJiSIcfnwR+VLY2IixESMS2L8MfEPl2iMGCNLJO5GiUZMRDbZoyCr7KVQW7qM97ZIgtCZAYv+cJOX6bx355zO65t5t4w9LgOEgq0qYPGQhC1VI1duDue8wrxlCm8aG7FZRprMhuYeq+ktnj7GVoY8uxCPcSVEkRwPh1cpvXMO+Abrdvv4QyTnNWNug9kARfpOuD3U2l5vGsnDrnzkWiULURatU6jundVEx6IMZAwDUsLG83BnqA1ye2pr2y3GTGTXigpRtmuHl+b+rcAE5VI5B3OJPqsZDn4vNz8x9GQgv3gK/09Zlm/Qo+KQpDnLKOhaZHD7kUXMGYU4EJPirS24qVvPyiVOoVAQ4wayUpFJ7ClCWiD4m91HGSdzg+x3EOumLoEL9FAVTCzCyTs8cl4bG7XkL6bRVSyWe0CeJnYVORyLhqQxSp+OyohtWhYYmI+wAw/xjc+6a036ALrNLQf8gqXJgrTAZKUAxIY5z2uagb9bCtDWLfzyQDY5TnVVbZXhefY1/7WJdOuCkZwIzPUzAHHhuAx9nS06FJj0LSjsAvjaIbJylXCtv3mADVB4bgrj1MKygGXA5B0D4BTTx7CPOXfUkSMU5PBXeG5kQzzUK8VmksnYhmCBGVByzhyRCPVQh7E+MoVaNDMiGNyRgy99NcsDbxfNtFrBHTnkYges48OiiRX14I4ccrGNZkM9PSeCUfAc4MeA63EaoxyRZ5Fc7JBt/E2FcUhYaBgDPvsSQGfv9DHs47MvOnKEghzkoge/8KG+I3edyk9Y2tQGfPoJgO0bgIle4ZzGL18Bnr4HMI+LTic66FDk2A91dSWVjZEpcSpWNi+vNqPdBhENpVXtUWnxjpd3p+VnztW+JpivIDY5JncLvMuSy731j+tMI26XYY0DyC4lx5QN2GC3Ht7X9uFHP5YH7gpiZSIT2Yem7fj4DfqqTcPJO7+V6fvcICUGsYhJ7BlrGhyo+WgcTExqedVabhyYswwZQAxiEdNlETUhbcDiNm5zy+v8450VPP7YkkWUS9egLJ8YxJJcCE/UOms8WdnpFC/tnjSf5YqNi5ZAsGLRZJ1KdWirZQzejfVDib7LgmVh4ZjdegGZn2ddef8hprcC7rSQoGRkWcbVezXUr6p+2GPibXfxYzm2l8gaFK3mJNUkTtADaiiPpP8Z1I+yTzh2clblIwKkF0Ou/4dIZrDwj2NBuCBcEP5/oXwO14xiUTnqqGudx3kXXklsfrH89+fZXvxLgAEAlgiiMDyIpU8AAAAASUVORK5CYII=",U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAiCAYAAABIiGl0AAAFVklEQVRYhZ1XfWxTVRT/vdfRbiN10cCqMAdqZzL52CKICH84YehIRf/QFcYWh/9IggIKfiQmwkIiCUJQIJCIkpHAlkj0rzHCx5QZI9OB+7CWOcYmllUZlhIt3dqtfdec9t55+/r6gTc5eR/3nN/v3XvOPec8hTGGdENRFEWaViSRB5NEjLTAOakmJEKVk6mSiA+ARKhJIp6R6gOSiCVCQWbievLVpCOOconorpoEnfgBtNVCpJUQsBlAPoACANPLy8tnd3d3v+n3+0+Hw+FhTdPGo9FoMBQKDdI7miMd0uU2+RzDZOSeSR9LKxUrmsIN8wYGBjbYZ81+H1//CJy/BPT9BvhuA1NygML7gIeLgGcWAsufxNXfr+0sKSk5BGAMwDiACWlHJleuJ1b5dhKhpampaUFFRcWrM9ye1Th0Arg+kiok4uNBG7DBiT/mFH/R3t7eWFtb+xOAMP+ACP7zf5yYkyoSae7evXvnvLV5czvbdRT4qi09oX68VAnlvXX4eN++ii1btrgBhCTyWDDKxMKvuQCsHo/no6Ivv3Wy4613Ryp8WOfA8MtPnyguLn4XQEAipy1nqrTFwq95/f39W4v6hp3s2EmKvv8lZFt0+bqTsAiTY5vE8ZSj2EKRWFZWVtjTefGX6PMbgb9uJy+l+AGom9ZCWTwv9sh+cEHb3wx4/kzWnX4vTCcPoHzRE3N7e3tvAhjlPo+qXEWs2Hzw4MEX2NkOsBE/mMYShEhNxz+EsnwRMDUvJnRP72hOrx/DONsBwpSOlgpdVooFlt1uX6F905lwvoUoG2sA69TklVmnxuaMbAiLMDlxjuDM0WWoKVar1a5d8cAoh6uL56cMJnVJGSIGNpp7EAUFBaV6H4uUKfxsslgs0yI3fQDTkkAy5H0wAxt28xbMZvM0XapVVF3FUXkWTfaXxhDt+DklafT7HkObWGzER0LqVPUAoVDoFkWjkb8mPjkOFggmryoQjM8Z2BBWOBz26W1UfVnz+/2DyqOzwDQtSbSrHoSr30aUoj44FhO6p3c0Z2SjzLXD5/P9KhKH8Jfwsailka6urvOOZ5+qiJz6znhLh4YRfWNnGk8nDtOKxeju7m6XCkU8ZfJVixJ4j81mu//G8HDHaOV6aN4MRSHDUGfakH/uUxQ9NHuJ1+ulDPMPTyLjqrTNlMAnRkZG7lzo7Dxs/uC1uJ8Mti8rYQyEceFi52Gv1xvg5XGyQong0vg2UDobW7p06ZG+wvxT5o1rDQMmGyFbwiAsXpvDclcitzCKnMmGhoaurTuwaw0LhRG55L6rLbasr0bu1ldQX1//zuDg4A0Ad3TVCSqLpyjRN01wheCZM2eu1dbV1fU99/g5y+trUp5RvZAu2ZAtYRAWx5yQg0tu9oSfx3kAmJqbm/sCgUBjQ0ODUgpUhqgKpRm5m9bi8rL5bQ3btze2tLT08zo8qutAYiNGTKvmLZdY9WQ2a2lpuaJp2pEdO3aglKFybH+TIXPe5jr0LZvXtm3btiOtra0DAP6WtnhCf46NOswcXputAGwA7AAWOhyONV1dXWdHdzeyWzOXJ8jonqOM5lauXLmadLmNjWNYOGZip5mivTUiX+BwOKp7enpOB3c3Mt+MZTGhe3pXVVVVTTpZkeqJM5A/AqB81apVL7rd7pNEGNxzlNE9vaM5rpOZ1Ig4DXkhAGrYH6upqVnhcrk+d7lcnzmdzkoApXyuMCtSua9Omkhu8M0c0Cy1MSIgx7mEpbOa0MBnTWxArvIuIkfunaSsF+HRq2UizUisI9f/LcrE+r/FtKRZEevIY48pflOz/jfOmjjNR8gjeyAA/wLyQavmRr/R2AAAAABJRU5ErkJggg==",D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAABRCAYAAAB/nZ57AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkVEMzUxQkYyNUNDQzExRUVBNEM2QTgxMTYxRUNEMEIxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkVEMzUxQkYzNUNDQzExRUVBNEM2QTgxMTYxRUNEMEIxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RUQzNTFCRjA1Q0NDMTFFRUE0QzZBODExNjFFQ0QwQjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RUQzNTFCRjE1Q0NDMTFFRUE0QzZBODExNjFFQ0QwQjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4I43SmAAAIDUlEQVR42uxbaXATZRj+sg29NqWQlnZSjiJQWm4EyiUjFMotVIcZQA5RkEGUQ0UFf4ACKjiIF+CIMiACIoz8EUGghSKWUg6Ruy1ngR6WpoG2SUnSNvF5262ThlybbNvUyTvzzJfufvvt8+x37Pu+31ZmNpuZJzbmoNbyTw6IBxKAfkBnoDXAC+d1QB5wHTgHpAJnD41TmJgEJvNUzOgaMW2AN4DpQFuRTdwHdgGbDo9T5DaamNG/a8NQrAJeBfw9fLBGYAuw4vBYRXGDihl1SDuZniYQzqQ1NbDgyBjFnnoXM/KQVo5iA/Aaq1/7FliYPEZRWS9iRh7WBqOgJ/Ycaxj7DZiSPFpRLqmYxCPVPbIPmMga1n4FJqWMct5DnKstmmVsIzARYA0MuudGyXpmeLJ2CoqfbZ3zww0Ht5KzPko/pgqqeTYFj03svKaKpRdVsiqzZD007dhIxW6PxCSkVC+/WbZWrdBmMja3kz9rHWy7g/PKTez7m0ZWUiGJIg0Ql5qoKHJ7mKGLPwLCrbufw5VzY+wLIaNzVMePk2S4KYHVbs+Zoce07dDAHFuN09BqHeR8ylGdQagr0fyZTZzcEmOSsflAM4BZg+aIqySorq023ABxmS9azJDjWg5EZtgj2DbY5YWQtUFdCVe3GcRNlBhcFA+0sduoiJlLK5qEYohTvFgxwx01eh/LLwlyBfl6k9TvngRbnOUOxPR19LTPllSx9rxrQ43qEgkJrZ+onsFEi3U0GU9oKlmu3nlMlYc6VFeiBaAWsWKHmcpRV1egzsa7RnZfb3+4kdgNqFPBJHdxVOKGGcdCnD31h5jZa+4Y2FClnA0IhTsTILgzBhM7jaH1h0ZwZzgmtYWInTMuGbmyR0GaYNthajj3Wm5/zsjKUIQx77QysT1T4MViCsSKyUbR3UvFZIscZuwvivC8VMw5sT2TyrzXUsWKOUOvCiHB501GnM6Kemle6cObIGhnI8T8zrCTuImOZ3DhJsDoRUKIyya3grNrvflcLARbJParPMFW4uR2QiP2ki5MWAob+51D+efY7J58sdsJDboYXbvAC4bYIkdCRGU0Y67oKPc7r5F65bsb3Xmn95aLyGguQqFqpPTsQskT5x2v6Shx/gswtoGEHAAm3+rKu5Q4FxVpUKOQngRsdjX+9wB0jxdcFSK6ZyytQ6ZuKqvZp6mPzaZFt7vwu8Ve6NE24FNZOhJCKdPZTJptwK3A8jtxvNqdBjzeoG2fpWOC/7YAmMFqdpfFGO0+76SUQk4c33gbtNVisnXWc5ASdMOBvnEB3KSCSjPTmWruwXMyppLLWJbBRJtWFGIcI6cxJ5b3jq3z6Lpi6tjdWN5s5xqZRR3JJpvHYpy9nlgDpjk49j8ynxifGJ8YnxifGJ8YnxifGJ8YnxifGJ8YEUb552FMmi9phzEP89nVkeaQYyqXKqcNL6DERSIwAhgIdKo9hzZkVnUdRprW90T92ro3gQzgKJCCerkucnOenkWlVqzms3jKk/W3DHkNJr26SJ+fWWjIpxsOZjXf/FPWMwAkOEHQE4Zz9IG3AaAEHyURSnLLb//ZKjCqSwAX2El4SJTpMaMN2sHbC+zAdUWOuModiOiC4n2AbhxAx8qrtLnXy66kn3+YduP4gwOFt3VZBotLxOxMt7A+MDXjGUo3sQ58XMCwiPGRfVoOiYlRdBvEy0MG4DDhE3AiUWsgKtOlYYYLKLH3KfAyzSk8fc2FRxkH9uVuvZyuTi4RM4bR1mY7PePybsLgsMTmk9rO6dm7xcDx6DUlDlFa6gdgKdpR2x1mODAexXaaiPqqx0WpD/bv/frGiitllSWmxlqh0otTSoG0EHlo+qKYVd0SIiZMCfQLogxqEvjOgqADT6xmOLEYxX6T2RR6Un1k2/Mne6/4OHPxJU+EVJiMOleOuWLEA3wuEy/iRzyJL3i/WUcMDsxF8WWFqaJ0/fVlK5dempWhrSz1uDcySy9kWB+7XHI2zZM2iRfxI57EF4e+EPhXz5lolFlQKl+b9fYHBwv2qKUaIpi88s967ZoUF9KLlnGWVXYx452L0/fpKssqpWh/nGpK+LK4z1dyMo7a60JiaCv69dPFqTuWXJyWxpqYre/105ABYQkz8fMbGmbV/z7y492v/m6KLowF73Ekpp0wlnVNUQzee4+Fn1Ek5h796hEazzdFMZ1DugcJP/NJDP33EHspevHTTVGMBe+DJGYdoI9XDn2RVoemJIT4Em/iTzpITA6wGMub/N3Yde8ltZ4Z0RSEEE/iS7yJP+n4zzfDi+ctWunwvqk6VZyyY/W1hWekeHFKbQp5c2551w39B4UlzoQQPxxaAv704qzraOLABBTbLHyzPfDNrjamb1Zr8M24BTEfdhsRkUS+GYUl9B3NK+C+v9bRtOU1U8W11l7z3nubL57WHC9raBEDlMNCJreb18vKa94ueM1Fll6z3UjTVjwDN+T+De3VU+c0J66j1wrvlt80Sk0+OriTPzzjyH7KZzsjnhkIl6j2P5kMQpBmM55xKMaqp2YKoupEmvqq8kK14Z9sijRzy+88yHucU1qgv6cr1OcbNcYHFehV00Ojuqq2fkv/cD88XU7pH9EsMjDKXxXYjo8Kig5pG9whMjIgqk14gCoOQ8hyAaJQmr7H3OMs0nRJjI0cwEghBzCIAsN6GFm3gVNCDiBZTA7A061zyqb0ALoCHQXXiL7QUApoZhUiP2I1/+ChEZAneCC3gGvkVQkT2y37V4ABAEkB+U9EUz7pAAAAAElFTkSuQmCC";function j(e,t){var n=e.getCtx().api;return{data:Object.assign({},t,{draw:n,mode:n.getMode(),state:e.getState()})}}function V(e,t){e.map.fire(_.REDO_UNDO,j(e,t))}function G(e,t){e.map.fire(_.CLICK_ON_VERTEX,j(e,t))}function B(e,t){e.map.fire(_.CLICK_OR_TAB,j(e,t))}function J(e,t){e.map.fire(_.ADD_POINT,j(e,t))}function Y(e,t,n,o,r,i){return{type:v.FEATURE,properties:{meta:r?E.LAST_POINT:E.SECOND_TO_LAST_POINT,parent:e,coord_path:n,active:o?O.ACTIVE:O.INACTIVE,mode:i},geometry:{type:v.POINT,coordinates:t}}}function Z(e){return e.options.disabledClickOnVertex}function W(e){return e.options.ignoreClickOnVertex}function z(e){return e.options.clickOnMissAndDoNothing}function H(e,t){try{if(e.options.disableSelect)return!0;var n=e.options.stopPropagationClickActiveFeatureHandlerClassName;return t.originalEvent.target&&"string"==typeof t.originalEvent.target.className&&n&&t.originalEvent.target.className.includes(n)}catch(e){return!1}}function X(e){return e.options.clickNotthingNoChangeMode}function Q(e){return e.options.disabledDragVertexWithSimpleSelectMode}function K(e,t){return new Promise((function(n,o){var r=[];t.forEach((function(t){r.push(function(e,t){return new Promise((function(n,o){e.loadImage(t.url,(function(r,i){r?o(r):e.hasImage(t.id)||n(Object.assign({},t,{image:i}))}))}))}(e,t))})),Promise.all(r).then((function(t){t.forEach((function(t){e.addImage(t.id,t.image)})),n(t)})).catch((function(e){o(e)}))}))}var q=function(e){this._modeInstance=e.modeInstance,this._ctx=e.ctx,this._api=e.ctx.api,this.undoStack=[],this.redoStack=[],this._addPointEvent=this._drawAddPointEvent.bind(this),this._bindEvent()};q.prototype._bindEvent=function(){this._unbindEvent(),this._ctx.map.on(_.ADD_POINT,this._addPointEvent)},q.prototype._unbindEvent=function(){this._ctx.map.off(_.ADD_POINT,this._addPointEvent)},q.prototype._drawAddPointEvent=function(){this.undoStack=[],this.redoStack=[],this.fireChange({type:"add"})},q.prototype._fireChangeAndRender=function(e){var t=this;this._modeInstance.afterRender((function(){return t.fireChange(e)}),!0)},q.prototype.fireChange=function(e){var t=e.cb,n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&-1===t.indexOf(o)&&(n[o]=e[o]);return n}(e,["cb"]),o=this.undoStack,r=this._api.getMode(),i=m;r===i.DRAW_LINE_STRING?(o=this._modeInstance.feature.getCoordinates()).pop():r===i.DRAW_POLYGON&&(o=this._modeInstance.feature.getCoordinates()[0]||[]).length<3&&(o=[]),this.undoStack=o;var a=JSON.parse(JSON.stringify(Object.assign({},n,{undoStack:o,redoStack:this.redoStack})));V(this._modeInstance,a),"function"==typeof t&&t()},q.prototype.undo=function(e){void 0===e&&(e=function(){});var t=null,n=this._modeInstance.getState(),o=n.currentVertexPosition-1,r=Math.max(0,o);if(n.line?t=n.line.removeCoordinate(""+r)[0]:n.polygon&&(t=n.polygon.removeCoordinate("0."+r,!0)[0]),t){if(n.currentVertexPosition--,n.currentVertexPosition<0)return;this.redoStack.push(t),this._fireChangeAndRender({type:"undo",cb:e})}},q.prototype.redo=function(e){void 0===e&&(e=function(){});var t=this._modeInstance.getState(),n=this.redoStack.pop();n&&(t.line?t.line.addCoordinate(t.currentVertexPosition++,n[0],n[1]):t.polygon&&t.polygon.addCoordinate("0."+t.currentVertexPosition++,n[0],n[1]),this._fireChangeAndRender({type:"redo",cb:e}))},q.prototype.destroy=function(){this._unbindEvent(),this.reset()},q.prototype.reset=function(){this.undoStack=[],this.redoStack=[]};var $=function(e){this._modeInstance=e.modeInstance,this._ctx=e.ctx,this._api=e.ctx.api,this.undoStack=[],this.redoStack=[],this._addPointEvent=this._drawAddPointEvent.bind(this),this._bindEvent()};$.prototype._bindEvent=function(){this._unbindEvent(),this._ctx.map.on(_.ADD_POINT,this._addPointEvent)},$.prototype._unbindEvent=function(){this._ctx.map.off(_.ADD_POINT,this._addPointEvent)},$.prototype._drawAddPointEvent=function(e){this.redoStack=[];var t=e.data.e.lngLat.toArray();this.undoStack.push(t),this._fireChange({type:"add"})},$.prototype._fireChangeAndRender=function(e){var t=this;this._modeInstance.afterRender((function(){return t._fireChange(e)}),!0)},$.prototype._genStacks=function(e){return e.map((function(e){return{type:Array.isArray(e)?"draw":"cut",stack:e}}))},$.prototype._fireChange=function(e){var t=e.cb,n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&-1===t.indexOf(o)&&(n[o]=e[o]);return n}(e,["cb"]),o=Object.assign({},n,{undoStack:this._genStacks(this.undoStack),redoStack:this._genStacks(this.redoStack)});V(this._modeInstance,JSON.parse(JSON.stringify(o))),"function"==typeof t&&t()},$.prototype.setRedoUndoStack=function(e){var t=e({undoStack:this.undoStack,redoStack:this.redoStack}),n=t.undoStack,o=t.redoStack;Array.isArray(n)&&(this.undoStack=JSON.parse(JSON.stringify(n))),Array.isArray(o)&&(this.redoStack=JSON.parse(JSON.stringify(o))),this._fireChangeAndRender({type:"cut"})},$.prototype.undo=function(e){void 0===e&&(e=function(){});var t=null,n=this._modeInstance.getState(),o=n.currentVertexPosition-1,r=Math.max(0,o),i=this.undoStack.pop();return Array.isArray(i)&&(n.line?t=n.line.removeCoordinate(""+r)[0]:n.polygon&&(t=n.polygon.removeCoordinate("0."+r,!0)[0]),t&&(0!==n.currentVertexPosition&&n.currentVertexPosition--,this.redoStack.push(t),this._fireChangeAndRender({type:"undo",cb:e}))),this._genStacks([i])[0]},$.prototype.redo=function(e){void 0===e&&(e=function(){});var t=this._modeInstance.getState(),n=this.redoStack.pop();return Array.isArray(n)&&(t.line?t.line.addCoordinate(t.currentVertexPosition++,n[0],n[1]):t.polygon&&(0===t.polygon.coordinates[0].length&&t.polygon.updateCoordinate("0."+t.currentVertexPosition,n[0],n[1]),t.polygon.addCoordinate("0."+t.currentVertexPosition++,n[0],n[1])),this.undoStack.push(n),this._fireChangeAndRender({type:"redo",cb:e})),this._genStacks([n])[0]},$.prototype.destroy=function(){this._unbindEvent(),this.reset()},$.prototype.reset=function(){this.undoStack=[],this.redoStack=[]};var ee=function(e){return e.ctx.events.getMode().includes("cut")?new $(e):new q(e)},te=function(){for(var e=arguments,t={},n=0;n<arguments.length;n++){var o=e[n];for(var r in o)ne.call(o,r)&&(t[r]=o[r])}return t},ne=Object.prototype.hasOwnProperty;var oe=i(te),re=function(e){this.ctx=e.ctx,this.markers=[],this.enabled=!1};function ie(e,t){var n=R.click(e,null,t),o={mouse:g.NONE};n[0]&&(o.mouse=n[0].properties.active===O.ACTIVE?g.MOVE:g.POINTER,o.feature=n[0].properties.meta,function(e,t,n){var o=e.api.getMode()===m.SIMPLE_SELECT,r=t.geometry.type===v.POINT,i=Q(e),a=t.properties.active===O.ACTIVE;i&&o&&r&&(n.mouse=a?g.NONE:g.POINTER)}(t,n[0],o));var r=t.events.currentModeName();return(r.includes("draw")||r.includes("cut"))&&(o.mouse=g.ADD),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function ae(e,t){var n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}re.prototype.setOptions=function(e){this.options=oe({unit:{line:"meters",area:"meters"},precision:2},e),this[e.enable?"enable":"cancel"]()},re.prototype.enable=function(){this.enabled=!0},re.prototype.cancel=function(){this.markers.forEach((function(e){return e.remove()})),this.markers=[],this.enabled=!1},re.prototype.destroy=function(){this.cancel()},re.prototype.delete=function(){this.cancel()};var se=4,ue=12,ce=500;function le(e,t,n){void 0===n&&(n={});var o=null!=n.fineTolerance?n.fineTolerance:se,r=null!=n.grossTolerance?n.grossTolerance:ue,i=null!=n.interval?n.interval:ce;e.point=e.point||t.point,e.time=e.time||t.time;var a=ae(e.point,t.point);return a<o||a<r&&t.time-e.time<i}var de=25,pe=250;function fe(e,t,n){void 0===n&&(n={});var o=null!=n.tolerance?n.tolerance:de,r=null!=n.interval?n.interval:pe;return e.point=e.point||t.point,e.time=e.time||t.time,ae(e.point,t.point)<o&&t.time-e.time<r}var he={exports:{}},ge=he.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(t),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,e/o))/Math.log(t)*o;var r=n-Math.floor(n),i="";for(o=0;o<Math.floor(n);o++){i=Math.floor(Math.random()*t).toString(t)+i}if(r){var a=Math.pow(t,r);i=Math.floor(Math.random()*a).toString(t)+i}var s=parseInt(i,t);return s!==1/0&&s>=Math.pow(2,e)?ge(e,t):i};ge.rack=function(e,t,n){var o=function(o){var i=0;do{if(i++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var a=ge(e,t)}while(Object.hasOwnProperty.call(r,a));return r[a]=o,a},r=o.hats={};return o.get=function(e){return o.hats[e]},o.set=function(e,t){return o.hats[e]=t,o},o.bits=e||128,o.base=t||16,o};var ye=i(he.exports),ve=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||ye(),this.type=t.geometry.type,this.measure=new re({ctx:e})};ve.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ve.prototype.incomingCoords=function(e){this.setCoordinates(e)},ve.prototype.setCoordinates=function(e){return this.coordinates=e,this.changed(),this},ve.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ve.prototype.setProperty=function(e,t){this.properties[e]=t,void 0===t&&delete this.properties[e]},ve.prototype.getProperty=function(e){return this.properties[e]},ve.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:v.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ve.prototype.internal=function(e){var t={id:this.id,meta:E.FEATURE,"meta:type":this.type,active:O.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var n in this.properties)t["user_"+n]=this.properties[n];return{type:v.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}},ve.prototype.delete=function(){return this.measure.delete(),this},ve.prototype.move=function(){return this.execMeasure(),this},ve.prototype.execMeasure=function(){throw new Error("execMeasure method must be implemented")};var me=function(e,t){ve.call(this,e,t)};(me.prototype=Object.create(ve.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},me.prototype.updateCoordinate=function(e,t,n){this.coordinates=3===arguments.length?[t,n]:[e,t],this.changed()},me.prototype.getCoordinate=function(){return this.getCoordinates()},me.prototype.execMeasure=function(){};var _e=function(e,t){ve.call(this,e,t)};(_e.prototype=Object.create(ve.prototype)).isValid=function(){return this.coordinates.length>1},_e.prototype.addCoordinate=function(e,t,n){this.changed();var o=parseInt(e,10);this.coordinates.splice(o,0,[t,n]),this.execMeasure()},_e.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},_e.prototype.removeCoordinate=function(e,t){return void 0===t&&(t=1),this.changed(),this.execMeasure(),this.coordinates.splice(parseInt(e,10),t)},_e.prototype.updateCoordinate=function(e,t,n){var o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed(),this.execMeasure()},_e.prototype.execMeasure=function(){var t=this;this.measure.enabled&&this.isValid()&&this.ctx.store.afterRender((function(){var n=t.measure.options,r=n.unit,i=n.precision,a=t.measure.markers;t.getCoordinates().forEach((function(n,s){if(0!==s){var u=a[s]||new e.Marker;a[s]=u,u.setLngLat(n).addTo(t.ctx.map);var c=u.getElement(),l=t.getCoordinates().slice(0,s+1),d=o.length(o.lineString(l),{units:r.line});u.setLngLat(n),c.innerHTML=d?""+d.toFixed(i):"",c.classList.add(f.MEASURE_MARKER)}})),a.splice(t.coordinates.length,a.length-t.coordinates.length).forEach((function(e){e.remove()}))}))};var be=function(e,t){ve.call(this,e,t),this.coordinates=this.coordinates.map((function(e){return e.slice(0,-1)}))};(be.prototype=Object.create(ve.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(e){return e.length>2}))},be.prototype.incomingCoords=function(e){this.coordinates=e.map((function(e){return e.slice(0,-1)})),this.changed()},be.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},be.prototype.addCoordinate=function(e,t,n){this.changed();var o=e.split(".").map((function(e){return parseInt(e,10)}));this.coordinates[o[0]].splice(o[1],0,[t,n]),this.execMeasure()},be.prototype.removeCoordinate=function(e,t){this.changed();var n=e.split(".").map((function(e){return parseInt(e,10)})),o=this.coordinates[n[0]];if(o){this.execMeasure();var r=o.splice(n[1],1);return!t&&o.length<3&&this.coordinates.splice(n[0],1),r}},be.prototype.getCoordinate=function(e){var t=e.split(".").map((function(e){return parseInt(e,10)})),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},be.prototype.getCoordinates=function(){return this.coordinates.map((function(e){return e.concat([e[0]])}))},be.prototype.updateCoordinate=function(e,t,n){this.changed();var o=e.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);void 0===this.coordinates[r]&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,n],this.execMeasure()},be.prototype.execMeasure=function(){var t=this;if(this.measure.enabled&&this.isValid()){var n=this.measure.markers;this.ctx.store.afterRender((function(){var r=t.measure.options,i=r.unit,a=r.precision,s=t.toGeoJSON(),u=o.area(s,{units:i.area}),c=n[0]||new e.Marker;n[0]=c;var l=o.center(s).geometry.coordinates;c.setLngLat(l).addTo(t.ctx.map);var d=c.getElement();d.innerHTML=u?""+u.toFixed(a):"",d.classList.add(f.MEASURE_MARKER)}))}};var Ee={MultiPoint:me,MultiLineString:_e,MultiPolygon:be},Oe=function(e,t,n,o,r){var i=n.split("."),a=parseInt(i[0],10),s=i[1]?i.slice(1).join("."):null;return e[a][t](s,o,r)},Ce=function(e,t){if(ve.call(this,e,t),delete this.coordinates,this.model=Ee[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function Se(e){this.map=e.map,delete e.options.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e,this._state={},this.feature=null,this.redoUndo=ee({ctx:e,modeInstance:this})}(Ce.prototype=Object.create(ve.prototype))._coordinatesToFeatures=function(e){var t=this,n=this.model.bind(this);return e.map((function(e){return new n(t.ctx,{id:ye(),type:v.FEATURE,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})}))},Ce.prototype.isValid=function(){return this.features.every((function(e){return e.isValid()}))},Ce.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},Ce.prototype.getCoordinate=function(e){return Oe(this.features,"getCoordinate",e)},Ce.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(e){return e.type===v.POLYGON?e.getCoordinates():e.coordinates}))))},Ce.prototype.updateCoordinate=function(e,t,n){Oe(this.features,"updateCoordinate",e,t,n),this.changed()},Ce.prototype.addCoordinate=function(e,t,n){Oe(this.features,"addCoordinate",e,t,n),this.changed()},Ce.prototype.removeCoordinate=function(e){Oe(this.features,"removeCoordinate",e),this.changed()},Ce.prototype.getFeatures=function(){return this.features},Ce.prototype.execMeasure=function(){},Se.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},Se.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce((function(e,n){return void 0===e[n.feature_id]&&(e[n.feature_id]=!0,t._ctx.store.get(n.feature_id).changed()),e}),{})},Se.prototype.getSelected=function(){return this._ctx.store.getSelected()},Se.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Se.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},Se.prototype.getFeature=function(e){return this._ctx.store.get(e)},Se.prototype.select=function(e){return this._ctx.store.select(e)},Se.prototype.deselect=function(e){return this._ctx.store.deselect(e)},Se.prototype.deleteFeature=function(e,t){return void 0===t&&(t={}),this._ctx.store.delete(e,t)},Se.prototype.addFeature=function(e){return this._ctx.store.add(e)},Se.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Se.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Se.prototype.setActionableState=function(e){void 0===e&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},Se.prototype.changeMode=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),this._ctx.events.changeMode(e,t,n)},Se.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},Se.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},Se.prototype.featuresAt=function(e,t,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return R[n](e,t,this._ctx)},Se.prototype.newFeature=function(e,t){void 0===t&&(t={});var n,o=e.geometry.type;return n=o===v.POINT?new me(this._ctx,e):o===v.LINE_STRING?new _e(this._ctx,e):o===v.POLYGON?new be(this._ctx,e):new Ce(this._ctx,e),t.declareFeature&&(this.feature=n),n},Se.prototype.isInstanceOf=function(e,t){if(e===v.POINT)return t instanceof me;if(e===v.LINE_STRING)return t instanceof _e;if(e===v.POLYGON)return t instanceof be;if("MultiFeature"===e)return t instanceof Ce;throw new Error("Unknown feature class: "+e)},Se.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},Se.prototype.getCtx=function(){return this._ctx},Se.prototype.getState=function(){return this._state},Se.prototype.setState=function(e){return this._state=e,this._state},Se.prototype.undo=function(){this.redoUndo.undo()},Se.prototype.redo=function(){this.redoUndo.redo()},Se.prototype.finish=function(e){void 0===e&&(e=m.SIMPLE_SELECT),this.isDrawing()&&this._ctx.api.changeMode(e)},Se.prototype.cancel=function(e){if(void 0===e&&(e=m.SIMPLE_SELECT),this.isDrawing()){var t=this._ctx.store.getAllIds();t.length&&this._ctx.api.delete(t[t.length-1]),this._ctx.api.changeMode(e)}},Se.prototype.isDrawing=function(){var e=this._ctx.api.getMode();return e.startsWith("draw")||e===m.DIRECT_SELECT},Se.prototype.afterRender=function(e,t){this._ctx.store.afterRender(e,t)},Se.prototype.beforeRender=function(e){this._ctx.store.beforeRender(e)},Se.prototype.setMeasureOptions=function(e){this.feature&&this.feature.measure.setOptions(e)},Se.prototype.destroy=function(){this.redoUndo.destroy()},Se.prototype.render=function(){this._ctx.store.render()},Se.prototype.onSetup=function(){},Se.prototype.onDrag=function(){},Se.prototype.onClick=function(){},Se.prototype.onMouseMove=function(){},Se.prototype.onMouseDown=function(){},Se.prototype.onMouseUp=function(){},Se.prototype.onMouseOut=function(){},Se.prototype.onKeyUp=function(){},Se.prototype.onKeyDown=function(){},Se.prototype.onTouchStart=function(){},Se.prototype.onTouchMove=function(){},Se.prototype.onTouchEnd=function(){},Se.prototype.onTap=function(){},Se.prototype.onStop=function(){},Se.prototype.onTrash=function(){},Se.prototype.onCombineFeature=function(){},Se.prototype.onUncombineFeature=function(){},Se.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Te={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xe=Object.keys(Te);function Me(e){var t=Object.keys(e);return function(n,o){void 0===o&&(o={});var r={},i=t.reduce((function(t,n){return t[n]=e[n],t}),new Se(n));return{start:function(){var t=this;if(r=i.onSetup(o),n.options.measureOptions){var a=n.api.getMode();a!==m.CUT_LINE&&a!==m.CUT_POLYGON&&i.setMeasureOptions(n.options.measureOptions)}xe.forEach((function(n){var o,a=Te[n],s=function(){return!1};e[a]&&(s=function(){return!0}),t.on(n,s,(o=a,function(e){return i[o](r,e)}))}))},stop:function(){return i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(e,t){i.toDisplayFeatures(r,e,t)},undo:function(){i.undo()},redo:function(){i.redo()},finish:function(e){i.finish(e)},cancel:function(e){i.cancel(e)},drawByCoordinate:function(e){i.drawByCoordinate(e)},getModeInstance:function(){return i},setMeasureOptions:function(e){i.setMeasureOptions(e)}}}}function Ie(e){return[].concat(e).filter((function(e){return void 0!==e}))}function Ae(e){var t=this;if(!(t.ctx.map&&void 0!==t.ctx.map.getSource(h.HOT)))return g();var n=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:n});var o=[],r=[];t.isDirty?r=t.getAllIds():(o=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),r=t.sources.hot.filter((function(e){return e.properties.id&&-1===o.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(e){return e.properties.id}))),t.sources.hot=[];var i=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(e){var t=e.properties.id||e.properties.parent;return-1===o.indexOf(t)}));var a=i!==t.sources.cold.length||r.length>0;function s(e,o){var r=t.get(e).internal(n);t.ctx.events.currentModeRender(r,(function(e){t.sources[o].push(e)}))}if(o.forEach((function(e){return s(e,"hot")})),r.forEach((function(e){return s(e,"cold")})),a&&t.ctx.map.getSource(h.COLD).setData({type:v.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(h.HOT).setData({type:v.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange||!e||"mousemove"!==e.type){var u=t.ctx.events.getModeInstance(),c=n===m.SIMPLE_SELECT;m.DIRECT_SELECT;var l=n.includes("cut"),d=c?!t.getSelected().length:!l||u.getWaitCutFeatures().length,p=c||!u.feature.isValid();t.ctx.ui.setDisableButtons((function(e){return e.cut_polygon={disabled:d},e.cut_line={disabled:d},e.draw_center={disabled:c},e.finish={disabled:p},e.cancel={disabled:c},e.undo={disabled:0===u.redoUndo.undoStack.length},e.redo={disabled:0===u.redoUndo.redoStack.length},e}))}if(t._emitSelectionChange&&(t.ctx.map.fire(_.SELECTION_CHANGE,{features:t.getSelected().map((function(e){return e.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(e){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var f=t._deletedFeaturesToEmit.map((function(e){return e.delete().toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(_.DELETE,{features:f})}function g(){t.isDirty=!1,t.clearChangedIds()}g(),t.ctx.map.fire(_.RENDER,{}),t.emitCallbacks()}function Ne(e){var t,n=this;this._features={},this._featureIds=new L,this._selectedFeatureIds=new L,this._selectedCoordinates=[],this._changedFeatureIds=new L,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this._emitCallbacks=[],this.sources={hot:[],cold:[]},this.render=function(e){t||(t=requestAnimationFrame((function(){t=null,Ae.call(n,e)})))},this.isDirty=!1}function Pe(e,t){var n=e._selectedCoordinates.filter((function(t){return e._selectedFeatureIds.has(t.feature_id)}));e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}Ne.prototype.createRenderBatch=function(){var e=this,t=this.render,n=0;return this.render=function(){n++},function(){e.render=t,n>0&&e.render()}},Ne.prototype.setDirty=function(){return this.isDirty=!0,this},Ne.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},Ne.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Ne.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Ne.prototype.getAllIds=function(){return this._featureIds.values()},Ne.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},Ne.prototype.delete=function(e,t){var n=this;return void 0===t&&(t={}),Ie(e).forEach((function(e){n._featureIds.has(e)&&(n._featureIds.delete(e),n._selectedFeatureIds.delete(e),t.silent?n._features[e].delete():-1===n._deletedFeaturesToEmit.indexOf(n._features[e])&&n._deletedFeaturesToEmit.push(n._features[e]),delete n._features[e],n.isDirty=!0)})),Pe(this,t),this},Ne.prototype.get=function(e){return this._features[e]},Ne.prototype.getAll=function(){var e=this;return Object.keys(this._features).map((function(t){return e._features[t]}))},Ne.prototype.select=function(e,t){var n=this;return void 0===t&&(t={}),Ie(e).forEach((function(e){n._selectedFeatureIds.has(e)||(n._selectedFeatureIds.add(e),n._changedFeatureIds.add(e),t.silent||(n._emitSelectionChange=!0))})),this},Ne.prototype.deselect=function(e,t){var n=this;return void 0===t&&(t={}),Ie(e).forEach((function(e){n._selectedFeatureIds.has(e)&&(n._selectedFeatureIds.delete(e),n._changedFeatureIds.add(e),t.silent||(n._emitSelectionChange=!0))})),Pe(this,t),this},Ne.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},Ne.prototype.setSelected=function(e,t){var n=this;return void 0===t&&(t={}),e=Ie(e),this.deselect(this._selectedFeatureIds.values().filter((function(t){return-1===e.indexOf(t)})),{silent:t.silent}),this.select(e.filter((function(e){return!n._selectedFeatureIds.has(e)})),{silent:t.silent}),this},Ne.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},Ne.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this.ctx.events.getModeInstance().map.fire(_.CLEAR_SELECTED_COORDINATES),this},Ne.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Ne.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map((function(t){return e.get(t)}))},Ne.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map((function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}}))},Ne.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},Ne.prototype.setFeatureProperty=function(e,t,n){this.get(e).setProperty(t,n),this.featureChanged(e)},Ne.prototype.storeMapConfig=function(){var e=this;C.forEach((function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())}))},Ne.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach((function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()}))},Ne.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]},Ne.prototype.emitCallbacks=function(e){for(;this._emitCallbacks.length>0;)this._emitCallbacks.shift()(e)},Ne.prototype.afterRender=function(e,t){"function"==typeof e&&this._emitCallbacks.push(e),t&&this.render()},Ne.prototype.beforeRender=function(e){"function"==typeof e&&e(),this.render()};var Le=["mode","feature","mouse"];function we(e){var t=null,n=null,o={onRemove:function(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){var r,i,a,s;e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners(),r=e.map,i={url:F,id:"gl-draw-icon1"},a={url:U,id:"gl-draw-icon2"},s={url:D,id:"gl-draw-icon3"},K(r,[Object.assign({},a),Object.assign({},i),Object.assign({},s)]);var u=e.events.getModeInstance();u.afterRender((function(){return function(e,t){e.map.fire(_.ADD,j(e,t))}(u,{controlContainer:t})}))},onAdd:function(i){var a=i.fire;return i.fire=function(e,t){var n=arguments;return 1===a.length&&1!==arguments.length&&(n=[oe({},{type:e},t)]),a.apply(i,n)},e.map=i,e.events=function(e){var t=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=Me(e.options.modes[n]),t}),{}),n={},o={},i={},a=null,s=null;i.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:g.DRAG}),s.drag(t)):t.originalEvent.stopPropagation()},i.mousedrag=function(e){i.drag(e,(function(e){return!le(n,e)}))},i.touchdrag=function(e){i.drag(e,(function(e){return!fe(o,e)}))},i.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return i.mousedrag(t);var n=ie(t,e);t.featureTarget=n,s.mousemove(t)},i.mousedown=function(t){n={time:(new Date).getTime(),point:t.point};var o=ie(t,e);t.featureTarget=o,s.mousedown(t)},i.mouseup=function(t){var o=ie(t,e);t._defaultPrevented||!o&&z(e)||(t.featureTarget=o,le(n,{point:t.point,time:(new Date).getTime()})?s.click(t):s.mouseup(t))},i.mouseout=function(e){s.mouseout(e)},i.touchstart=function(t){try{t.originalEvent.preventDefault()}catch(e){console.log(e)}if(e.options.touchEnabled){o={time:(new Date).getTime(),point:t.point};var n=R.touch(t,null,e)[0];t.featureTarget=n,s.touchstart(t)}},i.touchmove=function(t){try{t.originalEvent.preventDefault()}catch(e){console.log(e)}if(e.options.touchEnabled)return s.touchmove(t),i.touchdrag(t)},i.touchend=function(t){try{t.originalEvent.preventDefault()}catch(e){console.log(e)}if(e.options.touchEnabled){var n=R.touch(t,null,e)[0];t._defaultPrevented||!n&&z(e)||(t.featureTarget=n,fe(o,{time:(new Date).getTime(),point:t.point})?s.tap(t):s.touchend(t))}};var u=function(e){return!(8===e||46===e||e>=48&&e<=57)};function c(n,o,i){void 0===i&&(i={});var u=s.stop(),c=t[n];if(void 0===c)throw new Error(n+" is not valid");a=n;var l=c(e,u&&u.featureIds?Object.assign({},{featureIds:u.featureIds},o):o);s=r(l,e),i.silent||e.map.fire(_.MODE_CHANGE,{mode:n}),e.store.setDirty(),e.store.render()}i.keydown=function(t){(t.srcElement||t.target).classList.contains("mapboxgl-canvas")&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?u(t.keyCode)?s.keydown(t):49===t.keyCode&&e.options.controls.point?c(m.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?c(m.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&c(m.DRAW_POLYGON):(t.preventDefault(),s.trash()))},i.keyup=function(e){u(e.keyCode)&&s.keyup(e)},i.zoomend=function(){e.store.changeZoom()},i.data=function(t){if("style"===t.dataType){var n=e.setup,o=e.map,r=e.options,i=e.store;r.styles.some((function(e){return o.getLayer(e.id)}))||(n.addLayers(),i.setDirty(),i.render())}};var l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){a=e.options.defaultMode,s=r(t[a](e),e)},changeMode:c,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===l[e])throw new Error("Invalid action type");l[e]!==t[e]&&(n=!0),l[e]=t[e]})),n&&e.map.fire(_.ACTIONABLE,{actions:l})},currentModeName:function(){return a},currentModeRender:function(e,t){return s.render(e,t)},fire:function(e,t){i[e]&&i[e](t)},addEventListeners:function(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash:function(e){s.trash(e)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return a},undo:function(){s.undo()},redo:function(){s.redo()},finish:function(e){s.finish(e)},cancel:function(e){s.cancel(e)},drawByCoordinate:function(e){s.drawByCoordinate(e)},getModeInstance:function(){return s.getModeInstance()},setMeasureOptions:function(e){s.setMeasureOptions(e)}}}(e),e.ui=function(e){var t,n={},o=null,r={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null},a={meters:"米",kilometers:"公里",miles:"英里",nauticalmiles:"海里",inches:"英寸",yards:"码",centimeters:"厘米",feet:"英尺"};function s(){t&&(t.removeHandle(),t=null)}var u,c={mu:"亩",hectares:"公顷",kilometers:"平方公里",meters:"平方米",centimetres:"平方厘米",millimeters:"平方毫米",acres:"英亩",miles:"平方英里",yards:"平方码",feet:"平方英尺",inches:"平方英寸"};function l(){u&&(u.removeHandle(),u=null)}function d(){l(),s(),document.body.removeEventListener("click",d)}function p(e){i=oe(i,e)}function h(){var t,n;if(e.container){var o=[],a=[];Le.forEach((function(e){i[e]!==r[e]&&(o.push(e+"-"+r[e]),null!==i[e]&&a.push(e+"-"+i[e]))})),o.length>0&&(t=e.container.classList).remove.apply(t,o),a.length>0&&(n=e.container.classList).add.apply(n,a),r=oe(r,i)}}function g(e,t){void 0===t&&(t={});var n=document.createElement("button");return n.className=f.CONTROL_BUTTON+" "+t.className,n.setAttribute("title",t.title),n.disabled=!!t.disabled,t.container.appendChild(n),n.addEventListener("click",(function(r){if(r.preventDefault(),r.stopPropagation(),"cut_line"!==e&&"cut_polygon"!==e&&(s(),l()),"function"!=typeof t.onClick){if(r.target===o)return v(),void t.onDeactivate();t.popover?t.popover({button:n}).then((function(n){_(e),t.onActivate(n)})):(_(e),t.onActivate())}else t.onClick()}),!0),n}function v(){o&&(o.classList.remove(f.ACTIVE_BUTTON),o=null)}function _(e){v();var t=n[e];t&&t&&"trash"!==e&&(t.classList.add(f.ACTIVE_BUTTON),o=t)}return{setActiveButton:_,queueMapClasses:p,updateMapClasses:h,clearMapClasses:function(){p({mode:null,feature:null,mouse:null}),h()},addButtons:function(){var o=e.options.controls,r=document.createElement("div");return r.className=f.CONTROL+" "+f.CONTROL_GROUP+" "+f.CONTROL_BASE,o?(o[y.LINE]&&(n[y.LINE]=g(y.LINE,{container:r,className:f.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:function(){return e.events.changeMode(m.DRAW_LINE_STRING)},onDeactivate:function(){return e.events.trash()}})),o[y.POLYGON]&&(n[y.POLYGON]=g(y.POLYGON,{container:r,className:f.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:function(){return e.events.changeMode(m.DRAW_POLYGON)},onDeactivate:function(){return e.events.trash()}})),o[y.POINT]&&(n[y.POINT]=g(y.POINT,{container:r,className:f.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:function(){return e.events.changeMode(m.DRAW_POINT)},onDeactivate:function(){return e.events.trash()}})),o.trash&&(n.trash=g("trash",{container:r,className:f.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){e.events.trash()}})),o.combine_features&&(n.combine_features=g("combineFeatures",{container:r,className:f.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){e.events.combineFeatures()}})),o.uncombine_features&&(n.uncombine_features=g("uncombineFeatures",{container:r,className:f.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){e.events.uncombineFeatures()}})),o.undo&&(n.undo=g("undo",{container:r,className:f.CONTROL_BUTTON_UNDO,title:"Undo",disabled:!0,onClick:function(){return e.events.undo()}})),o.redo&&(n.redo=g("redo",{container:r,className:f.CONTROL_BUTTON_REDO,title:"Redo",disabled:!0,onClick:function(){return e.events.redo()}})),o.finish&&(n.finish=g("finish",{container:r,className:f.CONTROL_BUTTON_FINISH,title:"Finsih",disabled:!0,onClick:function(){return e.events.finish()}})),o.cancel&&(n.cancel=g("cancel",{container:r,className:f.CONTROL_BUTTON_CANCEL,title:"Cancel",disabled:!0,onClick:function(){return e.events.cancel()}})),o.draw_center&&(n.draw_center=g("draw_center",{container:r,className:f.CONTROL_BUTTON_DRAW_CENTER,title:"Draw By Center",disabled:!0,onClick:function(){return e.api.drawByCenter()}})),o.cut_line&&(n.cut_line=g("cut_line",{container:r,className:f.CONTROL_BUTTON_CUT_LINE,title:"cut line",disabled:!0,popover:function(e){var n=e.button;return new Promise((function(e){if(t)return s(),void e();l();var o=document.createElement("div"),r=document.createTextNode("line width:"),i=document.createTextNode("unit:"),u=document.createElement("input"),c=document.createElement("button"),p=document.createElement("button"),h=document.createElement("select");h.innerHTML=Object.keys(a).reduce((function(e,t){return e+'<option value="'+t+'">'+a[t]+"</option>"}),""),c.addEventListener("click",(function(){e({bufferOptions:{width:+(u.value||0),unit:h.value}}),s()})),p.addEventListener("click",(function(){e(),s()})),c.textContent="ok",p.textContent="cancel",u.value="1",u.type="number",u.min=0,h.value="meters",o.className=f.CONTROL_POPOVER,o.style.top="319px",o.style.left="-308px",o.appendChild(r),o.appendChild(u),o.appendChild(i),o.appendChild(h),o.appendChild(c),o.appendChild(p),o.addEventListener("click",(function(e){return e.stopPropagation()})),o.removeHandle=function(){r.remove(),i.remove(),u.remove(),c.remove(),p.remove(),h.remove(),o.remove()},t=o,n.parentNode.appendChild(o),document.body.addEventListener("click",d)}))},onActivate:function(t){return e.api.changeMode(m.CUT_LINE,t)},onDeactivate:function(){return e.events.trash()}})),o.cut_polygon&&(n.cut_polygon=g("cut_polygon",{container:r,className:f.CONTROL_BUTTON_CUT_POLYGON,title:"cut polygon",disabled:!0,popover:function(e){var t=e.button;return new Promise((function(e){if(u)return l(),void e();s();var n=document.createElement("div"),o=document.createTextNode("buffer width:"),r=document.createTextNode("unit:"),i=document.createElement("input"),a=document.createElement("button"),p=document.createElement("button"),h=document.createElement("select");h.innerHTML=Object.keys(c).reduce((function(e,t){return e+'<option value="'+t+'">'+c[t]+"</option>"}),""),a.addEventListener("click",(function(){var t;t="mu"===h.value?{unit:"meters",width:666.666666667*(i.value||0)}:{width:+(i.value||0),unit:h.value},e({bufferOptions:t}),l()})),p.addEventListener("click",(function(){e(),l()})),a.textContent="ok",p.textContent="cancel",i.value="1",i.type="number",h.value="meters",n.className=f.CONTROL_POPOVER,n.style.top="348px",n.style.left="-347px",n.appendChild(o),n.appendChild(i),n.appendChild(r),n.appendChild(h),n.appendChild(a),n.appendChild(p),n.addEventListener("click",(function(e){return e.stopPropagation()})),n.removeHandle=function(){o.remove(),r.remove(),i.remove(),a.remove(),p.remove(),h.remove(),n.remove()},u=n,t.parentNode.appendChild(n),document.body.addEventListener("click",d)}))},onDeactivate:function(){return e.events.trash()},onActivate:function(t){return e.api.changeMode(m.CUT_POLYGON,t)}})),r):r},removeButtons:function(){Object.keys(n).forEach((function(e){var t=n[e];t.parentNode&&t.parentNode.removeChild(t),delete n[e]}))},setDisableButtons:function(e){if(n){var t=Object.entries(n).reduce((function(e,t){var n=t[0],o=t[1];return e[n]={disabled:!!o.disabled},e}),{}),o=e(JSON.parse(JSON.stringify(t)));Object.entries(n).forEach((function(e){var t=e[0],n=e[1],r=o[t].disabled;"boolean"==typeof r&&r!==n.disabled&&(n.disabled=o[t].disabled)}))}}}}(e),e.container=i.getContainer(),e.store=new Ne(e),t=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?o.connect():(i.on("load",o.connect),n=setInterval((function(){i.loaded()&&o.connect()}),16)),e.events.start(),t},addLayers:function(){e.map.addSource(h.COLD,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(h.HOT,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(h.COLD)&&e.map.removeSource(h.COLD),e.map.getSource(h.HOT)&&e.map.removeSource(h.HOT)}};return e.setup=o,o}var Re=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["coalesce",["get","user_inactive-fill-color"],"#3bb2d0"],"fill-outline-color":["coalesce",["get","user_inactive-fill-outline-color"],"#3bb2d0"],"fill-opacity":["coalesce",["get","user_inactive-fill-opacity"],.1]}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#3bb2d0"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#3bb2d0"],"line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ke(e){return function(t){var n=t.featureTarget;return!!n&&(!!n.properties&&n.properties.meta===e)}}function Fe(e){return!!e.originalEvent&&(!!e.originalEvent.shiftKey&&0===e.originalEvent.button)}function Ue(e){return!!e.featureTarget&&(!!e.featureTarget.properties&&(e.featureTarget.properties.active===O.ACTIVE&&e.featureTarget.properties.meta===E.FEATURE))}function De(e){return!!e.featureTarget&&(!!e.featureTarget.properties&&(e.featureTarget.properties.active===O.INACTIVE&&e.featureTarget.properties.meta===E.FEATURE))}function je(e){return void 0===e.featureTarget}function Ve(e){return!!e.featureTarget&&(!!e.featureTarget.properties&&e.featureTarget.properties.meta===E.FEATURE)}function Ge(e){var t=e.featureTarget;return!!t&&(!!t.properties&&t.properties.meta===E.VERTEX)}function Be(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function Je(e){return 27===e.keyCode}function Ye(e){return 13===e.keyCode}var Ze=Object.freeze({__proto__:null,isOfMetaType:ke,isShiftMousedown:Fe,isActiveFeature:Ue,isInactiveFeature:De,noTarget:je,isFeature:Ve,isVertex:Ge,isShiftDown:Be,isEscapeKey:Je,isEnterKey:Ye,isTrue:function(){return!0}}),We=ze;function ze(e,t){this.x=e,this.y=t}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=o,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),o=Math.sin(e),r=t.x+n*(this.x-t.x)-o*(this.y-t.y),i=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(e){return e instanceof ze?e:Array.isArray(e)?new ze(e[0],e[1]):e};var He=i(We);function Xe(e,t){var n=t.getBoundingClientRect();return new He(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function Qe(e,t,n,o,r,i){return{type:v.FEATURE,properties:{meta:E.VERTEX,parent:e,coord_path:n,active:o?O.ACTIVE:O.INACTIVE,isLast:!!r,mode:i},geometry:{type:v.POINT,coordinates:t}}}function Ke(e,t,n){var o=t.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>T||o[1]<S||r[1]>T||r[1]<S)return null;var i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:v.FEATURE,properties:{meta:E.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:v.POINT,coordinates:[i.lng,i.lat]}}}function qe(e,t,n,o){void 0===t&&(t={}),void 0===n&&(n=null);var r,i=e.geometry,a=i.type,s=i.coordinates,u=e.properties&&e.properties.id,c=[];function l(e,n){var r="",i=null;e.forEach((function(e,a){var s=null!=n?n+"."+a:String(a),l=Qe(u,e,s,d(s),void 0,o);if(t.midpoints&&i){var p=Ke(u,i,l);p&&c.push(p)}i=l;var f=JSON.stringify(e);r!==f&&c.push(l),0===a&&(r=f)}))}function d(e){return!!t.selectedPaths&&-1!==t.selectedPaths.indexOf(e)}return a===v.POINT?c.push(Qe(u,s,n,d(n),void 0,o)):a===v.POLYGON?s.forEach((function(e,t){l(e,null!==n?n+"."+t:String(t))})):a===v.LINE_STRING?l(s,n):0===a.indexOf(v.MULTI_PREFIX)&&(r=a.replace(v.MULTI_PREFIX,""),s.forEach((function(n,i){var a={type:v.FEATURE,properties:e.properties,geometry:{type:r,coordinates:n}};c=c.concat(qe(a,t,i,o))}))),c}var $e={enable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}},et={exports:{}},tt=function(e){if(!e||!e.type)return null;var t=nt[e.type];if(!t)return null;if("geometry"===t)return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if("feature"===t)return{type:"FeatureCollection",features:[e]};if("featurecollection"===t)return e},nt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};var ot=i(tt);var rt=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce((function(t,n){return t.concat(e(n))}),[]),t;case"Feature":return t.geometry?e(t.geometry).map((function(e){var n={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(n.id=t.id),n})):[t];case"MultiPoint":return t.coordinates.map((function(e){return{type:"Point",coordinates:e}}));case"MultiPolygon":return t.coordinates.map((function(e){return{type:"Polygon",coordinates:e}}));case"MultiLineString":return t.coordinates.map((function(e){return{type:"LineString",coordinates:e}}));case"GeometryCollection":return t.geometries.map(e).reduce((function(e,t){return e.concat(t)}),[]);case"Point":case"Polygon":case"LineString":return[t]}}}),it=tt,at=a(rt),st=function(e){return function e(t){if(Array.isArray(t)&&t.length&&"number"==typeof t[0])return[t];return t.reduce((function(t,n){return Array.isArray(n)&&Array.isArray(n[0])?t.concat(e(n)):(t.push(n),t)}),[])}(e)};at instanceof Function||(at=at.default);function ut(e){return Object.prototype.toString.call(e)}var ct=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function lt(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n,e)}var dt=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},pt=Object.prototype.propertyIsEnumerable,ft=Object.getOwnPropertySymbols;function ht(e){var t=dt(e);if(ft)for(var n=ft(e),o=0;o<n.length;o++)pt.call(e,n[o])&&t.push(n[o]);return t}var gt=Object.prototype.hasOwnProperty||function(e,t){return t in e};function yt(e){if("object"==typeof e&&null!==e){var t;if(ct(e))t=[];else if("[object Date]"===ut(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===ut(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===ut(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===ut(e)}(e)||function(e){return"[object Number]"===ut(e)}(e)||function(e){return"[object String]"===ut(e)}(e))t=Object(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var n=e.constructor&&e.constructor.prototype||e.__proto__||{},o=function(){};o.prototype=n,t=new o}return lt(ht(e),(function(n){t[n]=e[n]})),t}return e}function vt(e,t,n){var o=[],r=[],i=!0;return function e(a){var s=n?yt(a):a,u={},c=!0,l={node:s,node_:a,path:[].concat(o),parent:r[r.length-1],parents:r,key:o[o.length-1],isRoot:0===o.length,level:o.length,circular:null,update:function(e,t){l.isRoot||(l.parent.node[l.key]=e),l.node=e,t&&(c=!1)},delete:function(e){delete l.parent.node[l.key],e&&(c=!1)},remove:function(e){ct(l.parent.node)?l.parent.node.splice(l.key,1):delete l.parent.node[l.key],e&&(c=!1)},keys:null,before:function(e){u.before=e},after:function(e){u.after=e},pre:function(e){u.pre=e},post:function(e){u.post=e},stop:function(){i=!1},block:function(){c=!1}};if(!i)return l;function d(){if("object"==typeof l.node&&null!==l.node){l.keys&&l.node_===l.node||(l.keys=ht(l.node)),l.isLeaf=0===l.keys.length;for(var e=0;e<r.length;e++)if(r[e].node_===a){l.circular=r[e];break}}else l.isLeaf=!0,l.keys=null;l.notLeaf=!l.isLeaf,l.notRoot=!l.isRoot}d();var p=t.call(l,l.node);return void 0!==p&&l.update&&l.update(p),u.before&&u.before.call(l,l.node),c?("object"!=typeof l.node||null===l.node||l.circular||(r.push(l),d(),lt(l.keys,(function(t,r){o.push(t),u.pre&&u.pre.call(l,l.node[t],t);var i=e(l.node[t]);n&&gt.call(l.node,t)&&(l.node[t]=i.node),i.isLast=r===l.keys.length-1,i.isFirst=0===r,u.post&&u.post.call(l,i),o.pop()})),r.pop()),u.after&&u.after.call(l,l.node),l):l}(e).node}function mt(e){this.value=e}function _t(e){return new mt(e)}mt.prototype.get=function(e){for(var t=this.value,n=0;n<e.length;n++){var o=e[n];if(!t||!gt.call(t,o))return;t=t[o]}return t},mt.prototype.has=function(e){for(var t=this.value,n=0;n<e.length;n++){var o=e[n];if(!t||!gt.call(t,o))return!1;t=t[o]}return!0},mt.prototype.set=function(e,t){for(var n=this.value,o=0;o<e.length-1;o++){var r=e[o];gt.call(n,r)||(n[r]={}),n=n[r]}return n[e[o]]=t,t},mt.prototype.map=function(e){return vt(this.value,e,!0)},mt.prototype.forEach=function(e){return this.value=vt(this.value,e,!1),this.value},mt.prototype.reduce=function(e,t){var n=1===arguments.length,o=n?this.value:t;return this.forEach((function(t){this.isRoot&&n||(o=e.call(this,o,t))})),o},mt.prototype.paths=function(){var e=[];return this.forEach((function(){e.push(this.path)})),e},mt.prototype.nodes=function(){var e=[];return this.forEach((function(){e.push(this.node)})),e},mt.prototype.clone=function(){var e=[],t=[];return function n(o){for(var r=0;r<e.length;r++)if(e[r]===o)return t[r];if("object"==typeof o&&null!==o){var i=yt(o);return e.push(o),t.push(i),lt(ht(o),(function(e){i[e]=n(o[e])})),e.pop(),t.pop(),i}return o}(this.value)},lt(ht(mt.prototype),(function(e){_t[e]=function(t){var n=[].slice.call(arguments,1),o=new mt(t);return o[e].apply(o,n)}}));var bt=_t,Et=Ot;function Ot(e){if(!(this instanceof Ot))return new Ot(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}Ot.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},Ot.prototype.equals=function(e){var t;return t=e instanceof Ot?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},Ot.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ot.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof Ot?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},Ot.prototype.bbox=function(){return this._valid?this._bbox:null},Ot.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],n=e[1];return this._bbox[0]<=t&&this._bbox[1]<=n&&this._bbox[2]>=t&&this._bbox[3]>=n},Ot.prototype.intersect=function(e){return this._valid?(t=e instanceof Ot?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},Ot.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},Ot.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ct=function(e){if(!e)return[];var t=at(it(e)),n=[];return t.features.forEach((function(e){e.geometry&&(n=n.concat(st(e.geometry.coordinates)))})),n},St=bt,Tt=Et,xt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Mt=Object.keys(xt);function It(e){for(var t=Tt(),n=Ct(e),o=0;o<n.length;o++)t.include(n[o]);return t}et.exports=function(e){return It(e).bbox()},et.exports.polygon=function(e){return It(e).polygon()},et.exports.bboxify=function(e){return St(e).map((function(e){e&&(Mt.some((function(t){return!!e[t]&&-1!==xt[t].indexOf(e.type)}))&&(e.bbox=It(e).bbox(),this.update(e)))}))};var At=i(et.exports),Nt=-90,Pt=90,Lt=S,wt=T,Rt=-270,kt=270;function Ft(e,t){var n=Nt,o=Pt,r=Nt,i=Pt,a=kt,s=Rt;e.forEach((function(e){var t=At(e),u=t[1],c=t[3],l=t[0],d=t[2];u>n&&(n=u),c<o&&(o=c),c>r&&(r=c),u<i&&(i=u),l<a&&(a=l),d>s&&(s=d)}));var u=t;return n+u.lat>wt&&(u.lat=wt-n),r+u.lat>Pt&&(u.lat=Pt-r),o+u.lat<Lt&&(u.lat=Lt-o),i+u.lat<Nt&&(u.lat=Nt-i),a+u.lng<=Rt&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),s+u.lng>=kt&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function Ut(e,t,n){var o=Ft(e.map((function(e){return e.toGeoJSON()})),t);e.forEach((function(e){var t,r=e.getCoordinates(),i=function(e){var t={lng:e[0]+o.lng,lat:e[1]+o.lat};return[t.lng,t.lat]},a=function(e){return e.map((function(e){return i(e)}))};e.type===v.POINT?t=i(r):e.type===v.LINE_STRING||e.type===v.MULTI_POINT?t=r.map(i):e.type===v.POLYGON||e.type===v.MULTI_LINE_STRING?t=r.map(a):e.type===v.MULTI_POLYGON&&(t=r.map((function(e){return e.map((function(e){return a(e)}))}))),e.incomingCoords(t),n.afterRender((function(t){return e.move(t)}))}))}var Dt={onSetup:function(e){var t=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),this.setState(n)},fireUpdate:function(){this.map.fire(_.UPDATE,{action:b.MOVE,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(){var e=this,t=this.getSelected(),n=t.filter((function(t){return e.isInstanceOf("MultiFeature",t)})),o=!1;if(t.length>1){o=!0;var r=t[0].type.replace("Multi","");t.forEach((function(e){e.type.replace("Multi","")!==r&&(o=!1)}))}var i=n.length>0,a=t.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:i,trash:a})},getUniqueIds:function(e){return e.length?e.map((function(e){return e.properties.id})).filter((function(e){return void 0!==e})).reduce((function(e,t){return e.add(t),e}),new L).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){$e.enable(this),this.destroy()},onMouseMove:function(e,t){return Ve(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};Dt.onTap=Dt.onClick=function(e,t){if(!H(this._ctx,t)){var n=this.getSelected();if(je(t)){if(n.length&&this.redoUndo.reset(),B(this,{e:t,type:"clickNoTarget"}),X(this._ctx))return;return this.clickAnywhere(e,t)}return ke(E.VERTEX)(t)?this.clickOnVertex(e,t):Ve(t)?((1===n.length&&n[0].id!==t.featureTarget.properties.id||n.length)&&this.redoUndo.reset(),this.clickOnFeature(e,t)):void 0}},Dt.clickAnywhere=function(e){var t=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(e){return t.doRender(e)}))),$e.enable(this),this.stopExtendedInteractions(e)},Dt.clickOnVertex=function(e,t){var n=this;this.changeMode(m.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.afterRender((function(){return G(n,{e:t})})),this.updateUIClasses({mouse:g.MOVE})},Dt.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},Dt.clickOnFeature=function(e,t){var n=this;$e.disable(this),this.stopExtendedInteractions(e);var o=Be(t),r=this.getSelectedIds(),i=t.featureTarget.properties.id,a=this.isSelected(i);if(!o&&a&&this.getFeature(i).type!==v.POINT)return this.changeMode(m.DIRECT_SELECT,{featureId:i});a&&o?(this.deselect(i),this.updateUIClasses({mouse:g.POINTER}),1===r.length&&$e.enable(this)):!a&&o?(this.select(i),this.updateUIClasses({mouse:g.MOVE})):a||o||(r.forEach((function(e){return n.doRender(e)})),this.setSelected(i),this.updateUIClasses({mouse:g.MOVE})),this.doRender(i)},Dt.onMouseDown=function(e,t){return Ue(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&Fe(t)?this.startBoxSelect(e,t):void 0},Dt.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Xe(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},Dt.onTouchStart=function(e,t){if(Ue(t))return this.startOnActiveFeature(e,t)},Dt.onDrag=function(e,t){if(!Q(this._ctx))return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},Dt.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:g.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(f.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var n=Xe(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),r=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),a=Math.max(e.boxSelectStartLocation.y,n.y),s="translate("+o+"px, "+i+"px)";e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=r-o+"px",e.boxSelectElement.style.height=a-i+"px"},Dt.dragMove=function(e,t){!1===e.dragMoving&&this._reodUndoAdd({dragMoveLocation:e.dragMoveLocation}),e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Ut(this.getSelected(),n,this),e.dragMoveLocation=t.lngLat},Dt.onTouchEnd=Dt.onMouseUp=function(e,t){var n=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var o=[e.boxSelectStartLocation,Xe(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,o,"click"),i=this.getUniqueIds(r).filter((function(e){return!n.isSelected(e)}));i.length&&(this.select(i),i.forEach((function(e){return n.doRender(e)})),this.updateUIClasses({mouse:g.MOVE}))}this.stopExtendedInteractions(e)},Dt.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?O.ACTIVE:O.INACTIVE,n(t),this.fireActionable(),t.properties.active===O.ACTIVE&&t.geometry.type!==v.POINT&&qe(t,void 0,void 0,m.SIMPLE_SELECT).forEach(n)},Dt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Dt.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t=[],n=[],o=e[0].type.replace("Multi",""),r=0;r<e.length;r++){var i=e[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach((function(e){t.push(e)})):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:v.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(_.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},Dt.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(0!==t.length){for(var n=[],o=[],r=function(r){var i=t[r];e.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach((function(t){e.addFeature(t),t.properties=i.properties,n.push(t.toGeoJSON()),e.select([t.id])})),e.deleteFeature(i.id,{silent:!0}),o.push(i.toGeoJSON()))},i=0;i<t.length;i++)r(i);n.length>1&&this.map.fire(_.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}},Dt._reodUndoAdd=function(e){var t=this;this.redoUndo.undoStack.push(JSON.parse(JSON.stringify(e))),this.afterRender((function(){return t.redoUndo.fireChange({type:"add"})}))},Dt._redoOrUndo=function(e){var t=this;if(e){var n=this.redoUndo[e+"Stack"].pop();if(n){var o=this.getState(),r=JSON.parse(JSON.stringify({dragMoveLocation:o.dragMoveLocation}));this.redoUndo["undo"===e?"redoStack":"undoStack"].push(r);var i={lng:n.dragMoveLocation.lng-o.dragMoveLocation.lng,lat:n.dragMoveLocation.lat-o.dragMoveLocation.lat};o.dragMoveLocation=n.dragMoveLocation;var a=this.getSelected();Ut(a,i,this),a.forEach((function(e){return e.execMeasure()})),this.afterRender((function(){return t.redoUndo.fireChange({type:e})})),this._ctx.store.render()}}},Dt.undo=function(){this._redoOrUndo("undo")},Dt.redo=function(){this._redoOrUndo("redo")};var jt=ke(E.VERTEX),Vt=ke(E.MIDPOINT),Gt={fireUpdate:function(){this.map.fire(_.UPDATE,{action:b.CHANGE_COORDINATES,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),this.map.dragRotate.disable(),this.map.touchPitch.disable(),this.map.touchZoomRotate.disable(),function(e,t){return e.options.disabledMovePolgon&&0===t.selectedCoordPaths.length}(this._ctx,e)||(e.canDragMove=!0),e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),this.map.dragRotate.enable(),this.map.touchPitch.enable(),this.map.touchZoomRotate.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){var n=this;this.startDragging(e,t);var o=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(o.coord_path);Be(t)||-1!==r?Be(t)&&-1===r&&e.selectedCoordPaths.push(o.coord_path):e.selectedCoordPaths=[o.coord_path];var i=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(i),this.afterRender((function(){return G(n,{e:t})}))}};Gt.onMidpoint=function(e,t){var n=this;this.startDragging(e,t);var o=t.featureTarget.properties;this.afterRender((function(){return o={e:t},void(e=n).map.fire(_.ON_MIDPOINT,j(e,o));var e,o})),this._reodUndoAdd({selectedCoordPaths:e.selectedCoordPaths}),e.feature.addCoordinate(o.coord_path,o.lng,o.lat),this.fireUpdate(),e.selectedCoordPaths=[o.coord_path]},Gt.pathsToCoordinates=function(e,t){return t.map((function(t){return{feature_id:e,coord_path:t}}))},Gt.onFeature=function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},Gt.dragFeature=function(e,t,n){Ut(this.getSelected(),n,this),e.dragMoveLocation=t.lngLat},Gt.dragVertex=function(e,t,n){var o=this;if(!function(e,t){return!(!t.originalEvent.changedTouches||2!==t.originalEvent.changedTouches.length)&&e.options.disabledDragVertexWithTwoFingersZoom}(this._ctx,t)){for(var r=e.selectedCoordPaths.map((function(t){return e.feature.getCoordinate(t)})),i=Ft(r.map((function(e){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e}}})),n),a=0;a<r.length;a++){var s=r[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],s[0]+i.lng,s[1]+i.lat)}t.state=e,this.afterRender((function(){return n={e:t},void(e=o).map.fire(_.DRAG_VERTEX,j(e,n));var e,n}))}},Gt.clickNoTarget=function(){this.changeMode(m.SIMPLE_SELECT)},Gt.clickInactive=function(){this.changeMode(m.SIMPLE_SELECT)},Gt.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},Gt.onSetup=function(e){var t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===v.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),$e.disable(this),this.setActionableState({trash:!0}),this.feature=n,this.setState(o)},Gt.onStop=function(e){var t=this;if($e.enable(this),e.feature.isValid()){var n=e.feature.toGeoJSON();this.afterRender((function(){return t.map.fire(_.CREATE,{features:[n]})}))}this.clearSelectedCoordinates(),this.destroy()},Gt.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=O.ACTIVE,n(t),qe(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths},void 0,m.DIRECT_SELECT).forEach(n)):(t.properties.active=O.INACTIVE,n(t)),this.fireActionable(e)},Gt.onTrash=function(e){e.selectedCoordPaths.sort((function(e,t){return t.localeCompare(e,"en",{numeric:!0})})).forEach((function(t){return e.feature.removeCoordinate(t)})),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(m.SIMPLE_SELECT,{}))},Gt.onMouseMove=function(e,t){var n=Ue(t),o=jt(t),r=Vt(t),i=0===e.selectedCoordPaths.length;return n&&i||o&&!i?this.updateUIClasses({mouse:g.MOVE}):this.updateUIClasses({mouse:g.NONE}),(o||n||r)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},Gt.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0},Gt.onTouchStart=Gt.onMouseDown=function(e,t){if(!t.originalEvent.touches||2!==t.originalEvent.touches.length)return jt(t)?this.onVertex(e,t):Ue(t)?this.onFeature(e,t):Vt(t)?this.onMidpoint(e,t):void 0;this.stopDragging(e)},Gt.onDrag=function(e,t){var n=this;if(!0===e.canDragMove){!1===e.dragMoving&&this._reodUndoAdd({selectedCoordPaths:e.selectedCoordPaths}),e.dragMoving=!0,t.originalEvent.stopPropagation();var o="null",r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?(this.dragVertex(e,t,r),o="dragVertex"):(this.dragFeature(e,t,r),o="dragFeature"),e.dragMoveLocation=t.lngLat,this.afterRender((function(){return r={e:t,type:o},void(e=n).map.fire(_.DRAG,j(e,r));var e,r}))}},Gt.onClick=function(e,t){var n=this;if(!H(this._ctx,t)){if(je(t)){if(this.redoUndo.reset(),this.afterRender((function(){return B(n,{e:t,type:"clickNoTarget"})})),X(this._ctx))return;return this.clickNoTarget(e,t)}if(Ue(t))return this.afterRender((function(){return B(n,{e:t,type:"clickActiveFeature"})})),this.clickActiveFeature(e,t);if(De(t))return this.redoUndo.reset(),this.afterRender((function(){return B(n,{e:t,type:"clickInactiveFeature"})})),this.clickInactive(e,t);this.stopDragging(e),this.afterRender((function(){return B(n,{e:t,type:"null"})}))}},Gt.onTap=function(e,t){var n=this;if(!H(this._ctx,t)){if(je(t)){if(this.afterRender((function(){return B(n,{e:t,type:"clickNoTarget"})})),X(this._ctx))return;return this.clickNoTarget(e,t)}return Ue(t)?(this.afterRender((function(){return B(n,{e:t,type:"clickActiveFeature"})})),this.clickActiveFeature(e,t)):De(t)?(this.afterRender((function(){return B(n,{e:t,type:"clickInactiveFeature"})})),this.clickInactive(e,t)):void this.afterRender((function(){return B(n,{e:t,type:"null"})}))}},Gt.onTouchEnd=Gt.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)},Gt._reodUndoAdd=function(e){var t=JSON.parse(JSON.stringify(Object.assign({},e,{coordinates:this.getState().feature.getCoordinates()})));this.redoUndo.undoStack.push(t),this.redoUndo.fireChange({type:"add"}),console.log("undoStack",this.redoUndo.undoStack)},Gt._redoOrUndo=function(e){var t=this;if(e){var n=this.redoUndo[e+"Stack"].pop();if(n){var o=this.getState();this.redoUndo["undo"===e?"redoStack":"undoStack"].push({coordinates:o.feature.getCoordinates(),selectedCoordPaths:o.selectedCoordPaths}),o.selectedCoordPaths&&(o.selectedCoordPaths=n.selectedCoordPaths),o.feature.setCoordinates(n.coordinates),o.feature.execMeasure(),this._ctx.store.render(),this.afterRender((function(){return t.redoUndo.fireChange({type:e})}))}}},Gt.undo=function(){this._redoOrUndo("undo")},Gt.redo=function(){this._redoOrUndo("redo")};var Bt={};function Jt(e,t){return!!e.lngLat&&(e.lngLat.lng===t[0]&&e.lngLat.lat===t[1])}Bt.onSetup=function(){var e=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:[]}},{declareFeature:!0});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(y.POINT),this.setActionableState({trash:!0}),this.setState({point:e})},Bt.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Bt.onTap=Bt.onClick=function(e,t){var n=this;this.updateUIClasses({mouse:g.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.afterRender((function(){return J(n,{e:t})})),this.map.fire(_.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.point.id]})},Bt.onStop=function(e){this.activateUIButton(),this.destroy(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Bt.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.point.id;if(t.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(t)},Bt.onTrash=Bt.stopDrawingAndRemove,Bt.onKeyUp=function(e,t){if(Je(t)||Ye(t))return this.stopDrawingAndRemove(e,t)},Bt.drawByCoordinate=function(e){this.onClick(this.getState(),{lngLat:{lng:e[0],lat:e[1]}})};var Yt={onSetup:function(e){void 0===e&&(e={});var t=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POLYGON,coordinates:[[]]}},{declareFeature:!0});return this.addFeature(t),this.clearSelectedFeatures(),$e.disable(this),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(e.button||y.POLYGON),this.setActionableState({trash:!0}),this.setState({polygon:t,currentVertexPosition:0})},clickAnywhere:function(e,t){var n=this;if(e.currentVertexPosition>0&&Jt(t,e.polygon.coordinates[0][e.currentVertexPosition-1])){if(W(this._ctx))return;return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})}this.updateUIClasses({mouse:g.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),this.afterRender((function(){return J(n,{e:t})}))},clickOnVertex:function(e,t){if(!Z(this._ctx))return"function"==typeof t?t():this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ge(t)&&this.updateUIClasses({mouse:g.POINTER})}};Yt.onTap=Yt.onClick=function(e,t){return W(this._ctx)?this.clickAnywhere(e,t):Ge(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},Yt.onKeyUp=function(e,t){Je(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)):Ye(t)&&this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},Yt.onStop=function(e,t){if(this.updateUIClasses({mouse:g.NONE}),$e.enable(this),this.activateUIButton(),this.destroy(),void 0!==this.getFeature(e.polygon.id)){if(e.polygon.removeCoordinate("0."+e.currentVertexPosition),"function"==typeof t)return t(e);e.polygon.isValid()?this.map.fire(_.CREATE,{features:[e.polygon.toGeoJSON()]}):this.deleteFeature([e.polygon.id],{silent:!0})}},Yt.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.polygon.id;if(t.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(t);if(0!==t.geometry.coordinates.length){var r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=E.FEATURE,n(Qe(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1,void 0,m.DRAW_POLYGON)),r>3){var i=t.geometry.coordinates[0].length-3;i>0&&t.geometry.coordinates[0].slice(1,i).forEach((function(t,o){n(Qe(e.polygon.id,t,"0."+(o+1),!1,!1,m.DRAW_POLYGON))})),n(Qe(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1,!0,m.DRAW_POLYGON)),n(Y(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1,!1,m.DRAW_POLYGON)),n(Y(e.polygon.id,t.geometry.coordinates[0][i],"0."+(i+1),!1,!0,m.DRAW_POLYGON))}if(r<=4){var a=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:v.FEATURE,properties:t.properties,geometry:{coordinates:a,type:v.LINE_STRING}}),3===r)return}return n(t)}}},Yt.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Yt.drawByCoordinate=function(e){var t=this,n=this.getState();n.polygon.addCoordinate("0."+n.currentVertexPosition++,e[0],e[1]),this.afterRender((function(){return J(t)}),!0)};var Zt={onSetup:function(e){var t,n,o=(e=e||{}).featureId,r="forward";if(o){if(!(t=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var i=e.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=t.coordinates.length-1;if(t.coordinates[a][0]===i[0]&&t.coordinates[a][1]===i[1])n=a+1,t.addCoordinate.apply(t,[n].concat(t.coordinates[a]));else{if(t.coordinates[0][0]!==i[0]||t.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,t.addCoordinate.apply(t,[n].concat(t.coordinates[0]))}}else t=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.LINE_STRING,coordinates:[]}},{declareFeature:!0}),n=0,this.addFeature(t);return this.clearSelectedFeatures(),$e.disable(this),this.updateUIClasses({mouse:g.ADD}),this.activateUIButton(e.button||y.LINE),this.setActionableState({trash:!0}),this.setState({line:t,currentVertexPosition:n,direction:r})},clickAnywhere:function(e,t){var n=this;if(e.currentVertexPosition>0&&Jt(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Jt(t,e.line.coordinates[e.currentVertexPosition+1])){if(W(this._ctx))return;return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]})}this.updateUIClasses({mouse:g.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat),this.afterRender((function(){return J(n,{e:t})}))},clickOnVertex:function(e,t){if(!Z(this._ctx))return"function"==typeof t?t():this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ge(t)&&this.updateUIClasses({mouse:g.POINTER})}};Zt.onTap=Zt.onClick=function(e,t){return W(this._ctx)?this.clickAnywhere(e,t):Ge(t)?this.clickOnVertex(e,t):void this.clickAnywhere(e,t)},Zt.onKeyUp=function(e,t){Ye(t)?this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]}):Je(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT))},Zt.onStop=function(e,t){if($e.enable(this),this.activateUIButton(),this.destroy(),void 0!==this.getFeature(e.line.id)){if(e.line.removeCoordinate(""+e.currentVertexPosition),"function"==typeof t)return t();e.line.isValid()?this.map.fire(_.CREATE,{features:[e.line.toGeoJSON()]}):this.deleteFeature([e.line.id],{silent:!0})}},Zt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Zt.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.line.id;if(t.properties.active=o?O.ACTIVE:O.INACTIVE,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=E.FEATURE,t.geometry.coordinates.forEach((function(o,r){var i=""+(r+1);if(r===t.geometry.coordinates.length-1)n(Y(e.line.id,o,i,!1,!0,m.DRAW_LINE_STRING));else{var a=r===t.geometry.coordinates.length-2;a&&n(Y(e.line.id,o,i,!1,!1,m.DRAW_LINE_STRING)),n(Qe(e.line.id,o,i,!1,a,m.DRAW_LINE_STRING))}})),n(t))},Zt.drawByCoordinate=function(e){var t=this,n=this.getState();n.line.addCoordinate(n.currentVertexPosition++,e[0],e[1]),this.afterRender((function(){return J(t)}),!0)};var Wt=[v.POLYGON,v.MULTI_POLYGON],zt=[v.LINE_STRING,v.MULTI_LINE_STRING],Ht=Wt.concat(zt),Xt="wait-cut",Qt={_styles:["inactive-fill-color","inactive-fill-outline-color","inactive-line-color"]};Qt._execMeasure=function(e){var t=this._ctx.api;e&&t.options.measureOptions&&(e.measure.setOptions(t.options.measureOptions),e.execMeasure())},Qt._continuous=function(e){this._options.continuous&&(e&&e(),this._updateFeatures())},Qt._updateFeatures=function(){this._features=this._ctx.store.getAll().filter((function(e){return e.getProperty(Xt)})).map((function(e){return e.toGeoJSON()}))},Qt._cancelCut=function(){this._features.length&&(this._batchHighlight(this._features),this._features=[])},Qt._setHighlight=function(e,t){var n=this._ctx.api;this._styles.forEach((function(o){return n.setFeatureProperty(e,o,t)})),n.setFeatureProperty(e,Xt,!!t||void 0)},Qt._batchHighlight=function(e,t){var n=this;e.length&&e.forEach((function(e){return n._setHighlight(e.id,t)}))},Qt._undoByLines=function(e){var t=this;e.lines.forEach((function(e){var n=e.cuted,o=e.line,r=n.features,i=r[0],a=r.slice(1),s=t.newFeature(o);a.forEach((function(e){return t.deleteFeature(e.id)})),t._ctx.store.get(i.id).measure.delete(),s.id=i.id,t.addFeature(s),t._execMeasure(s),t._setHighlight(s.id,t._options.highlightColor)}))},Qt.getWaitCutFeatures=function(){return JSON.parse(JSON.stringify(this._features))},Qt.onTrash=function(e){this.originOnTrash(e),this._cancelCut()},Qt.onKeyUp=function(e,t){this.originOnKeyUp(e,t),Je(t)&&this._cancelCut()};var Kt=Yt.onSetup,qt=Yt.onMouseMove,$t=Yt.clickOnVertex,en=Yt.onStop,tn=Yt.onTrash,nn=Yt.onKeyUp,on=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&-1===t.indexOf(o)&&(n[o]=e[o]);return n}(Yt,["onSetup","onMouseMove","clickOnVertex","onStop","onTrash","onKeyUp"]),rn=Object.assign({},{originOnSetup:Kt,originOnKeyUp:nn,originOnMouseMove:qt,originClickOnVertex:$t,originOnStop:en,originOnTrash:tn},on,Qt),an=Object.assign({},{featureIds:[],highlightColor:"#73d13d",continuous:!0,bufferOptions:{width:0}},{bufferOptions:{width:0}});function sn(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return un(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"features":return;default:t[n]=e[n]}})),t.features=e.features.map((function(e){return un(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ln(e);default:throw new Error("unknown GeoJSON type")}}function un(e){var t={type:"Feature"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}})),t.properties=cn(e.properties),t.geometry=ln(e.geometry),t}function cn(e){var t={};return e?(Object.keys(e).forEach((function(n){var o=e[n];"object"==typeof o?null===o?t[n]=null:Array.isArray(o)?t[n]=o.map((function(e){return e})):t[n]=cn(o):t[n]=o})),t):t}function ln(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return ln(e)})),t):(t.coordinates=dn(e.coordinates),t)}function dn(e){var t=e;return"object"!=typeof t[0]?t.slice():t.map((function(e){return dn(e)}))}function pn(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function fn(e){for(var t,n,o=pn(e),r=0,i=1;i<o.length;)t=n||o[0],r+=((n=o[i])[0]-t[0])*(n[1]+t[1]),i++;return r>0}function hn(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function gn(e,t){var n,o,r,i,a,s,u,c,l,d,p=0,f="FeatureCollection"===e.type,h="Feature"===e.type,g=f?e.features.length:1;for(n=0;n<g;n++){for(s=f?e.features[n].geometry:h?e.geometry:e,c=f?e.features[n].properties:h?e.properties:{},l=f?e.features[n].bbox:h?e.bbox:void 0,d=f?e.features[n].id:h?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(i=u?s.geometries[r]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,c,l,d))return!1;break;case"GeometryCollection":for(o=0;o<i.geometries.length;o++)if(!1===t(i.geometries[o],p,c,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,c,l,d))return!1;p++}}function yn(e,t){if(!(n=t=t||{})||n.constructor!==Object)throw new Error("options is invalid");var n,o=t.reverse||!1,r=t.mutate||!1;if(!e)throw new Error("<geojson> is required");if("boolean"!=typeof o)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(e=sn(e));var i=[];switch(e.type){case"GeometryCollection":return gn(e,(function(e){vn(e,o)})),e;case"FeatureCollection":return hn(e,(function(e){hn(vn(e,o),(function(e){i.push(e)}))})),function(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}(i)}return vn(e,o)}function vn(e,t){switch("Feature"===e.type?e.geometry.type:e.type){case"GeometryCollection":return gn(e,(function(e){vn(e,t)})),e;case"LineString":return mn(pn(e),t),e;case"Polygon":return _n(pn(e),t),e;case"MultiLineString":return pn(e).forEach((function(e){mn(e,t)})),e;case"MultiPolygon":return pn(e).forEach((function(e){_n(e,t)})),e;case"Point":case"MultiPoint":return e}}function mn(e,t){fn(e)===t&&e.reverse()}function _n(e,t){fn(e[0])!==t&&e[0].reverse();for(var n=1;n<e.length;n++)fn(e[n])===t&&e[n].reverse()}function bn(e,t){for(var n=0,o=0,r=0,i=0,a=0,s=0,u=0,c=0,l=null,d=null,p=e[0],f=e[1],h=t.length;n<h;n++){o=0;var g=t[n].length-1,y=t[n];if((l=y[0])[0]!==y[g][0]&&l[1]!==y[g][1])throw new Error("First and last coordinates in a ring must be the same");for(a=l[0]-p,s=l[1]-f;o<g;o++)if(c=(d=y[o+1])[1]-f,s<0&&c<0||s>0&&c>0)s=c,a=(l=d)[0]-p;else{if(u=d[0]-e[0],c>0&&s<=0){if((i=a*c-u*s)>0)r+=1;else if(0===i)return 0}else if(s>0&&c<=0){if((i=a*c-u*s)<0)r+=1;else if(0===i)return 0}else if(0===c&&s<0){if(0===(i=a*c-u*s))return 0}else if(0===s&&c<0){if(0===(i=a*c-u*s))return 0}else if(0===s&&0===c){if(u<=0&&a>=0)return 0;if(a<=0&&u>=0)return 0}l=d,s=c,a=u}}return r%2!=0}rn.onSetup=function(e){var t=this,n=oe(an,e);if(n.bufferOptions.width>0&&!n.bufferOptions.unit)throw new Error("Please provide a valid bufferWidthUnit");var o=n.highlightColor,r=n.featureIds,i=[];if(!(i=(i=r.length?r.map((function(e){return t.getFeature(e).toGeoJSON()})):this.getSelected().map((function(e){return e.toGeoJSON()}))).filter((function(e){return Ht.includes(e.geometry.type)}))).length)throw new Error("Please select a feature/features (Polygon or MultiPolygon or LineString or MultiLineString) to split!");this._features=i,this._options=n,this._undoStack=[],this._redoStack=[],this._redoType="",this._undoType="",this._batchHighlight(i,o);var a=this.originOnSetup({button:m.CUT_POLYGON});return window.state=a,window.p=this,this.setState(a)},rn.onMouseMove=function(e,t){this.updateUIClasses({mouse:g.ADD}),this.originOnMouseMove(e,t)},rn.onStop=function(e){var t=this,n=this._features.map((function(e){return e.id}));return this.originOnStop(e,(function(){t._cancelCut(),t.deleteFeature([e.polygon.id],{silent:!0})})),{featureIds:n}},rn.clickOnVertex=function(e){var t=this;this.originClickOnVertex(e,(function(){var n=e.polygon.toGeoJSON();n.geometry.coordinates[0].splice(e.currentVertexPosition,1),t._cut(n),t._options.continuous?t._resetState():t.deleteFeature([e.polygon.id],{silent:!0})}))},rn.undo=function(){var e=this,t=this.redoUndo.undo()||{},n=t.type,r=t.stack;if("cut"===n){var i=this._ctx.store;this.beforeRender((function(){var t=e.getState(),n={geoJson:r.geoJson};r.polygons.forEach((function(t){var n=o.combine(t.difference),r=o.union(t.intersect,n.features[0]),a=e.newFeature(r),s=t.difference.features,u=s[0],c=s.slice(1);a.id=u.id,t.difference.features.forEach((function(e){return i.get(e.id).measure.delete()})),c.forEach((function(t){return e.deleteFeature(t.id)})),e.addFeature(a),e._execMeasure(a),e._setHighlight(a.id,e._options.highlightColor)})),e._undoByLines(r),t.currentVertexPosition=r.geoJson.geometry.coordinates[0].length-1,t.polygon.setCoordinates(r.geoJson.geometry.coordinates),e.redoUndo.setRedoUndoStack((function(e){return{redoStack:e.redoStack.concat([n])}})),e._updateFeatures()}))}},rn.redo=function(){var e=this,t=this.redoUndo.redo()||{},n=t.type,o=t.stack;"cut"===n&&this.beforeRender((function(){e._cut(o.geoJson),e._resetState()}))},rn._cut=function(e){var t=this,n=this._ctx,r=n.store,i=n.api,a=this._options,s=a.highlightColor,u=a.bufferOptions,c={geoJson:e,polygons:[],lines:[]};u.width&&(e=o.buffer(e,u.width,{units:u.unit})),this._features.forEach((function(n){if(Ht.includes(n.geometry.type)){if(r.get(n.id).measure.delete(),zt.includes(n.geometry.type)){var a=o.polygonToLine(e),u=o.lineSplit(n,a);return c.lines.push({cuted:u,line:n}),u.features.sort((function(e,t){return o.length(e)-o.length(t)})),u.features[0].id=n.id,i.add(u,{silent:!0}).forEach((function(e,t){return u.features[t].id=e})),void t._continuous((function(){return t._batchHighlight(u.features,s)}))}var l=o.difference(n,e);if(!l)return;var d=t.newFeature(l),p={intersect:o.intersect(n,e)};if(d.features){var f=d.features.sort((function(e,t){return o.area(e)-o.area(t)})),h=f[0],g=f.slice(1);h.id=n.id,t.addFeature(h),i.add(o.featureCollection(g.map((function(e){return e.toGeoJSON()}))),{silent:!0}),t._execMeasure(h),t._continuous((function(){return t._batchHighlight(d.features,s)})),p.intersect&&(p.difference=o.featureCollection(d.features.map((function(e){return e.toGeoJSON()}))))}else d.id=n.id,t.addFeature(d),t._execMeasure(d),t._continuous((function(){return t._setHighlight(d.id,s)})),p.intersect&&(p.difference=o.featureCollection([d.toGeoJSON()]));p.intersect&&p.difference&&c.polygons.push(p)}else console.info("The feature is not Polygon/MultiPolygon!")})),this.redoUndo.setRedoUndoStack((function(e){return{undoStack:e.undoStack.concat([c])}})),r.setDirty()},rn._resetState=function(){var e=this.getState();e.currentVertexPosition=0,e.polygon.setCoordinates([[]])};var En=11102230246251565e-32,On=134217729,Cn=(3+8*En)*En;function Sn(e,t,n,o,r){var i,a,s,u,c=t[0],l=o[0],d=0,p=0;l>c==l>-c?(i=c,c=t[++d]):(i=l,l=o[++p]);var f=0;if(d<e&&p<n)for(l>c==l>-c?(s=i-((a=c+i)-c),c=t[++d]):(s=i-((a=l+i)-l),l=o[++p]),i=a,0!==s&&(r[f++]=s);d<e&&p<n;)l>c==l>-c?(s=i-((a=i+c)-(u=a-i))+(c-u),c=t[++d]):(s=i-((a=i+l)-(u=a-i))+(l-u),l=o[++p]),i=a,0!==s&&(r[f++]=s);for(;d<e;)s=i-((a=i+c)-(u=a-i))+(c-u),c=t[++d],i=a,0!==s&&(r[f++]=s);for(;p<n;)s=i-((a=i+l)-(u=a-i))+(l-u),l=o[++p],i=a,0!==s&&(r[f++]=s);return 0===i&&0!==f||(r[f++]=i),f}function Tn(e){return new Float64Array(e)}var xn=33306690738754716e-32,Mn=22204460492503146e-32,In=11093356479670487e-47,An=Tn(4),Nn=Tn(8),Pn=Tn(12),Ln=Tn(16),wn=Tn(4);function Rn(e,t,n,o,r,i){var a=(t-i)*(n-r),s=(e-r)*(o-i),u=a-s;if(0===a||0===s||a>0!=s>0)return u;var c=Math.abs(a+s);return Math.abs(u)>=xn*c?u:-function(e,t,n,o,r,i,a){var s,u,c,l,d,p,f,h,g,y,v,m,_,b,E,O,C,S,T=e-r,x=n-r,M=t-i,I=o-i;d=(E=(h=T-(f=(p=On*T)-(p-T)))*(y=I-(g=(p=On*I)-(p-I)))-((b=T*I)-f*g-h*g-f*y))-(v=E-(C=(h=M-(f=(p=On*M)-(p-M)))*(y=x-(g=(p=On*x)-(p-x)))-((O=M*x)-f*g-h*g-f*y))),An[0]=E-(v+d)+(d-C),d=(_=b-((m=b+v)-(d=m-b))+(v-d))-(v=_-O),An[1]=_-(v+d)+(d-O),d=(S=m+v)-m,An[2]=m-(S-d)+(v-d),An[3]=S;var A=function(e,t){for(var n=t[0],o=1;o<e;o++)n+=t[o];return n}(4,An),N=Mn*a;if(A>=N||-A>=N)return A;if(s=e-(T+(d=e-T))+(d-r),c=n-(x+(d=n-x))+(d-r),u=t-(M+(d=t-M))+(d-i),l=o-(I+(d=o-I))+(d-i),0===s&&0===u&&0===c&&0===l)return A;if(N=In*a+Cn*Math.abs(A),(A+=T*l+I*s-(M*c+x*u))>=N||-A>=N)return A;d=(E=(h=s-(f=(p=On*s)-(p-s)))*(y=I-(g=(p=On*I)-(p-I)))-((b=s*I)-f*g-h*g-f*y))-(v=E-(C=(h=u-(f=(p=On*u)-(p-u)))*(y=x-(g=(p=On*x)-(p-x)))-((O=u*x)-f*g-h*g-f*y))),wn[0]=E-(v+d)+(d-C),d=(_=b-((m=b+v)-(d=m-b))+(v-d))-(v=_-O),wn[1]=_-(v+d)+(d-O),d=(S=m+v)-m,wn[2]=m-(S-d)+(v-d),wn[3]=S;var P=Sn(4,An,4,wn,Nn);d=(E=(h=T-(f=(p=On*T)-(p-T)))*(y=l-(g=(p=On*l)-(p-l)))-((b=T*l)-f*g-h*g-f*y))-(v=E-(C=(h=M-(f=(p=On*M)-(p-M)))*(y=c-(g=(p=On*c)-(p-c)))-((O=M*c)-f*g-h*g-f*y))),wn[0]=E-(v+d)+(d-C),d=(_=b-((m=b+v)-(d=m-b))+(v-d))-(v=_-O),wn[1]=_-(v+d)+(d-O),d=(S=m+v)-m,wn[2]=m-(S-d)+(v-d),wn[3]=S;var L=Sn(P,Nn,4,wn,Pn);d=(E=(h=s-(f=(p=On*s)-(p-s)))*(y=l-(g=(p=On*l)-(p-l)))-((b=s*l)-f*g-h*g-f*y))-(v=E-(C=(h=u-(f=(p=On*u)-(p-u)))*(y=c-(g=(p=On*c)-(p-c)))-((O=u*c)-f*g-h*g-f*y))),wn[0]=E-(v+d)+(d-C),d=(_=b-((m=b+v)-(d=m-b))+(v-d))-(v=_-O),wn[1]=_-(v+d)+(d-O),d=(S=m+v)-m,wn[2]=m-(S-d)+(v-d),wn[3]=S;var w=Sn(L,Pn,4,wn,Ln);return Ln[w-1]}(e,t,n,o,r,i,c)}var kn=function(e,t,n,o,r){this.p1=e,this.p2=t,this.edgeType=n,this.originalIndex=o,this.polygonContourId=r,this.interiorRing=!1,this.minX=Math.min(e.p[0],t.p[0]),this.minY=Math.min(e.p[1],t.p[1]),this.maxX=Math.max(e.p[0],t.p[0]),this.maxY=Math.max(e.p[1],t.p[1]),this.intersectionPoints=[],this.nextEdge=null},Fn=function(e){this.p=e},Un=function(e,t){this.id=e,this.rawCoords=t};function Dn(e,t){return!(e.maxX<t[0])&&(!(e.minX>t[2])&&(!(e.maxY<t[1])&&!(e.minY>t[3])))}var jn=function(e,t,n,o){this.p=e,this.polylineEdge=t,this.polygonEdge=n,this.isHeadingIn=o,this.distanceFromPolylineEdgeStart=Vn(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=Vn(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};function Vn(e,t){var n=t[0]-e[0],o=t[1]-e[1];return n*=n,o*=o,Math.sqrt(n+o)}jn.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};var Gn=1e-9;function Bn(e,t){return e[0]*t[1]-e[1]*t[0]}function Jn(e,t){return e[0]*t[0]+e[1]*t[1]}function Yn(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}function Zn(e,t,n){var o=[e.p2.p[0]-e.p1.p[0],e.p2.p[1]-e.p1.p[1]],r=[t.p2.p[0]-t.p1.p[0],t.p2.p[1]-t.p1.p[1]],i=[t.p1.p[0]-e.p1.p[0],t.p1.p[1]-e.p1.p[1]],a=Bn(o,r),s=a*a,u=Jn(o,o);if(s>0){var c=Bn(i,r)/a;if(c<0||c>1)return null;var l=Bn(i,o)/a;return l<0||l>1?null:0===c||1===c?n?null:[Yn(e.p1.p,c,o)]:0===l||1===l?n?null:[Yn(t.p1.p,l,r)]:[Yn(e.p1.p,c,o)]}var d=Jn(i,i);if((s=(a=Bn(i,o))*a)>Gn*u*d)return null;var p=Jn(o,i)/u,f=p+Jn(o,r)/u,h=Math.min(p,f),g=Math.max(p,f);return h<=1&&g>=0?1===h?n?null:[Yn(e.p1.p,h>0?h:0,o)]:0===g?n?null:[Yn(e.p1.p,g<1?g:1,o)]:n&&0===h&&1===g?null:[Yn(e.p1.p,h>0?h:0,o),Yn(e.p1.p,g<1?g:1,o)]:null}function Wn(e,t){var n=[],o=[],r=[],i=function(e,t,n,o,r){for(var i=0,a=[],s="Feature"===t.type?t.geometry:t,u="LineString"===s.type?[s.coordinates]:s.coordinates,c=0,l=0;l<u.length;l++){for(var d=u[l].length-1,p=new Fn(u[l][0]),f=null,h={nextEdge:null},g=0;g<d;g++){f=new Fn(u[l][g+1]),p.nextPoint=f,f.prevPoint=p;var y=new kn(p,f,"polyline",c,null);o.push(y),h.nextEdge=y,y.prevEdge=h,r[0]=Math.min(r[0],p.p[0]),r[1]=Math.min(r[1],p.p[1]),r[2]=Math.max(r[2],p.p[0]),r[3]=Math.max(r[3],p.p[1]),p=f,c+=1,h=y}r[0]=Math.min(r[0],u[l][d][0]),r[1]=Math.min(r[1],u[l][d][1]),r[2]=Math.max(r[2],u[l][d][0]),r[3]=Math.max(r[3],u[l][d][1])}for(var v="Feature"===e.type?e.geometry:e,m="Polygon"===v.type?[v.coordinates]:v.coordinates,_=m.length,b=0;b<_;b++)for(var E=m[b].length,O=0;O<E;O++){i+=1;var C=m[b][O],S=C.length;a.push(new Un(i,C));for(var T=new Fn(C[0]),x=T,M=void 0,I=null,A={nextEdge:null,prevEdge:null},N=null,P=1;P<S;P++)M=new Fn(C[P]),x.nextPoint=M,M.prevPoint=x,I=new kn(x,M,"polygon",c,i),A.nextEdge=I,I.prevEdge=A,1===P&&(N=I),O>0&&(I.interiorRing=!0),I.intersectPolylineBbox=Dn(I,r),n.push(I),x=M,c+=1,A=I;I.nextEdge=N,N.prevEdge=I,M.nextPoint=T.nextPoint,T.prevPoint=M.prevPoint}return a}(yn(e),t,o,r,[1/0,1/0,1/0,1/0]);if(function(e,t,n){var o,r,i,a=t.length,s=e.length;for(o=0;o<a;o++){var u=t[o];for(r=0;r<s;r++){var c=e[r];if(c.intersectPolylineBbox&&!(c.maxX<u.minX||c.minX>u.maxX||c.maxY<u.minY||c.minY>u.maxY)){var l=Zn(u,c);if(null!==l)for(i=0;i<l.length;i++){var d=Rn(c.p1.p[0],c.p1.p[1],c.p2.p[0],c.p2.p[1],u.p1.p[0],u.p1.p[1]),p=new jn(l[i],u,c,d>0);n.push(p)}}}}t.forEach((function(e){e.intersectionPoints.sort((function(e,t){return e.distanceFromPolylineEdgeStart-t.distanceFromPolylineEdgeStart}))})),e.forEach((function(e){e.intersectionPoints.sort((function(e,t){return e.distanceFromPolygonEdgeStart-t.distanceFromPolygonEdgeStart}))}))}(o,r,n),0===n.length)return e;var a={};i.forEach((function(e){return a[e.id]=0})),n.forEach((function(e){var t=e.polygonEdge.polygonContourId;a[t]=a[t]+1}));for(var s=0,u=[],c=null,l=0;l<r.length;l++){var d=r[l];if(d.intersectionPoints.length>0){c=d.intersectionPoints[0];break}}for(var p=c,f={visitCount:1};c!==f&&!(s>2*n.length);){if(s=s++,f.visitCount>=2){for(var h=!1,g=0;g<n.length;g++){var y=n[g];if(y.visitCount<2){p=y,h=!0;break}}if(!h)break}p.visitCount=p.visitCount+1;var v=[];u.push(v),v.push(p.p),p.visitCount=p.visitCount+1;var m=Qn(p,v),_=!1;if(m===(f=m)&&2===n.length)for(var b=0;b<n.length;b++){n[b].visitCount<2&&(_=!0)}for(;m!==p||_;){(m=(m.isHeadingIn?$n:qn)(m,v))!==p&&(m=Qn(m,v)),_=!1}if(f.visitCount>=2){for(var E=!1,O=0;O<n.length;O++){var C=n[O];if(C.visitCount<2){p=C,E=!0;break}}E&&(f=p)}p=f}for(var S=u.map((function(e){return[e]})),T=Object.keys(a),x=0;x<T.length;x++){var M=T[x];if(0===a[M])Xn(Hn(zn(o,parseInt(M)),i),S)}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:S}}}function zn(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.polygonContourId===t)return o}}function Hn(e,t){return t.find((function(t){return t.id===e.polygonContourId})).rawCoords}function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];if(bn(e[0],[o[0]]))return void o.push(e)}t.push([e])}function Qn(e,t){var n=e.polygonEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==e){var o=Kn(e,n.intersectionPoints),r=n.intersectionPoints[o+1];return t.push(r.p),r.incrementVisitCount(),r}for(var i=!0;i;){if(t.push(n.p2.p),null===(n=n.nextEdge))return e;n.intersectionPoints.length>0&&(i=!1)}return n.intersectionPoints[0].incrementVisitCount(),t.push(n.intersectionPoints[0].p),n.intersectionPoints[0]}function Kn(e,t){for(var n=0;n<t.length;n++){if(t[n]===e)return n}return null}function qn(e,t){var n=e.polylineEdge;if(2===n.intersectionPoints.length){var o=n.intersectionPoints[n.intersectionPoints.length-1];if(o===e){var r=n.intersectionPoints[0];return t.push(r.p),r.incrementVisitCount(),r}return t.push(o.p),o.incrementVisitCount(),o}if(n.intersectionPoints.length>2&&n.intersectionPoints[0]!==e){var i=Kn(e,n.intersectionPoints),a=n.intersectionPoints[i-1];return t.push(a.p),a.incrementVisitCount(),a}for(var s=!0;s;){if(t.push(n.p1.p),void 0===(n=n.prevEdge).originalIndex)return e;n.intersectionPoints.length>0&&(s=!1)}if(void 0===n.originalIndex)return e;var u=n.intersectionPoints[n.intersectionPoints.length-1];return u.incrementVisitCount(),t.push(u.p),u}function $n(e,t){var n=e.polylineEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==e){var o=Kn(e,n.intersectionPoints),r=n.intersectionPoints[o+1];return t.push(r.p),r.incrementVisitCount(),r}for(var i=!0;i;){if(t.push(n.p2.p),null===(n=n.nextEdge))return e;n.intersectionPoints.length>0&&(i=!1)}if(void 0===n)return e;var a=n.intersectionPoints[0];return a.incrementVisitCount(),t.push(a.p),a}var eo=Zt.onSetup,to=Zt.onMouseMove,no=Zt.clickOnVertex,oo=Zt.onStop,ro=Zt.onKeyUp,io=Zt.onTrash,ao=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&-1===t.indexOf(o)&&(n[o]=e[o]);return n}(Zt,["onSetup","onMouseMove","clickOnVertex","onStop","onKeyUp","onTrash"]),so=Object.assign({},{originOnTrash:io,originOnSetup:eo,originOnKeyUp:ro,originOnStop:oo,originOnMouseMove:to,originClickOnVertex:no},ao,Qt);so.onSetup=function(e){var t=this,n=oe({featureIds:[],highlightColor:"#73d13d",continuous:!0,bufferOptions:{width:0}},e),o=n.featureIds,r=n.highlightColor;if(n.bufferOptions.width>0&&!n.bufferOptions.unit)throw new Error("Please provide a valid bufferOptions.unit");var i=[];if(!(i=o.length?o.map((function(e){return t.getFeature(e).toGeoJSON()})):this.getSelected().map((function(e){return e.toGeoJSON()}))).length)throw new Error("Please select a feature/features (Polygon or MultiPolygon or LineString or MultiLineString) to split!");this._options=n,this._features=i;var a=this.originOnSetup({button:m.CUT_LINE});return this._batchHighlight(i,r),this.setState(a)},so.clickOnVertex=function(e){var t=this;this.originClickOnVertex(e,(function(){var n=e.line.toGeoJSON();n.geometry.coordinates[0].splice(e.currentVertexPosition,1),t._cut(n),t._options.continuous?t._resetState():t.deleteFeature([e.line.id],{silent:!0})}))},so._cut=function(e){var t,n,r=this,i=this._options,a=i.bufferOptions,s=i.highlightColor,u=a.width,c=a.unit,l=this._ctx,d=l.store,p=l.api,f=e.geometry.coordinates[e.geometry.coordinates.length-1],h=o.point(e.geometry.coordinates[0]),g=o.point(f),y={geoJson:e,polygons:[],lines:[]};this._features.forEach((function(i){if(o.booleanDisjoint(i,e))console.warn("Line was outside of Polygon "+i.id);else if(o.booleanDisjoint(i,h)&&o.booleanDisjoint(i,g))if(d.get(i.id).measure.delete(),zt.includes(i.geometry.type))if(u){t||(n=o.buffer(e,u,{units:c}),t=o.polygonToLine(n));var a=o.lineSplit(i,t);o.featureCollection([]),a.features.forEach((function(e){return e.id=ye()})),o.lineIntersect(i,e).features.forEach((function(e){var t=o.buffer(e,.1,{units:"meters"});a.features=a.features.filter((function(e){return o.booleanDisjoint(t,e)}))})),a.features.sort((function(e,t){return o.length(e)-o.length(t)})),0!==a.features.length?(a.features[0].id=i.id,p.add(a,{silent:!0}),y.lines.push({cuted:a,line:i}),r._continuous((function(){return r._batchHighlight(a.features,s)}))):(p.delete(i.id,{silent:!0}),y.lines.push({cuted:o.featureCollection([i]),line:i}),r._continuous())}else{var l=o.lineSplit(i,e);l.features.sort((function(e,t){return o.length(e)-o.length(t)})),l.features[0].id=i.id,p.add(l,{silent:!0}).forEach((function(e,t){return l.features[t].id=e})),r._continuous((function(){return r._batchHighlight(l.features,s)})),y.lines.push({cuted:l,line:i})}else{var f,v={};if(u){var m=o.buffer(e,u,{units:c});v.intersect=o.intersect(i,m),f=o.difference(i.geometry,m)}else f=Wn(i.geometry,e.geometry);if(f){var _=r.newFeature(f),b=_.features.sort((function(e,t){return o.area(e)-o.area(t)})),E=b[0],O=b.slice(1);E.id=i.id,p.add(o.featureCollection(O.map((function(e){return e.toGeoJSON()}))),{silent:!0}),r.addFeature(E),r._execMeasure(E),r._continuous((function(){return r._batchHighlight(_.features,s)})),v.cuted=o.featureCollection([E.toGeoJSON()].concat(O.map((function(e){return e.toGeoJSON()}))))}else p.delete(i.id,{silent:!0}),r._continuous(),v.cuted=o.featureCollection([i]);v.cuted&&(v.intersect&&(v.intersect=o.featureCollection([v.intersect])),y.polygons.push(v))}else console.warn("The start and end points of the line must be outside of the poly")})),this.redoUndo.setRedoUndoStack((function(e){return{undoStack:e.undoStack.concat([y])}})),d.setDirty()},so.onMouseMove=function(e,t){this.updateUIClasses({mouse:g.ADD}),this.originOnMouseMove(e,t)},so.onStop=function(e){var t=this,n=this._features.map((function(e){return e.id}));return this.originOnStop(e,(function(){t._cancelCut(),t.deleteFeature([e.line.id],{silent:!0})})),{featureIds:n}},so.undo=function(){var e=this,t=this.redoUndo.undo()||{},n=t.type,r=t.stack;if("cut"===n){var i=this._ctx.store;this.beforeRender((function(){var t=e.getState(),n={geoJson:r.geoJson};r.polygons.forEach((function(t){var n;t.intersect&&(n=t.cuted.features).push.apply(n,t.intersect.features);var r=t.cuted.features.shift();i.get(r.id).measure.delete();var a=o.combine(t.cuted),s=e.newFeature(o.union(r,a.features[0]));s.id=r.id,t.cuted.features.forEach((function(t){return e.deleteFeature(t.id)})),e.addFeature(s),e._execMeasure(s),e._setHighlight(s.id,e._options.highlightColor)})),e._undoByLines(r),t.currentVertexPosition=r.geoJson.geometry.coordinates.length-1,t.line.setCoordinates(r.geoJson.geometry.coordinates),e.redoUndo.setRedoUndoStack((function(e){return{redoStack:e.redoStack.concat([n])}})),e._updateFeatures()}))}},so.redo=function(){var e=this,t=this.redoUndo.redo()||{},n=t.type,o=t.stack;"cut"===n&&this.beforeRender((function(){e._cut(o.geoJson),e._resetState()}))},so._resetState=function(){var e=this.getState();e.currentVertexPosition=0,e.line.setCoordinates([])};var uo={simple_select:Dt,direct_select:Gt,draw_point:Bt,draw_polygon:Yt,draw_line_string:Zt,cut_polygon:rn,cut_line:so},co={defaultMode:m.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Re,modes:uo,controls:{},userProperties:!1,measureOptions:{enable:!0}},lo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0,undo:!0,redo:!0,finish:!0,cancel:!0,draw_center:!0,cut_line:!0,cut_polygon:!0},po={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1,undo:!1,redo:!1,cancel:!1,draw_center:!1,cut_line:!1,cut_polygon:!1};function fo(e,t){return e.map((function(e){return e.source?e:oe(e,{id:e.id+"."+t,source:"hot"===t?h.HOT:h.COLD})}))}function ho(e){return fo(e,"cold").concat(fo(e,"hot"))}var go={exports:{}};!function(e,t){var n="__lodash_hash_undefined__",o=1,r=2,i=9007199254740991,a="[object Arguments]",s="[object Array]",u="[object AsyncFunction]",c="[object Boolean]",l="[object Date]",d="[object Error]",p="[object Function]",f="[object GeneratorFunction]",h="[object Map]",g="[object Number]",y="[object Null]",v="[object Object]",m="[object Promise]",_="[object Proxy]",b="[object RegExp]",E="[object Set]",O="[object String]",C="[object Symbol]",S="[object Undefined]",T="[object WeakMap]",x="[object ArrayBuffer]",M="[object DataView]",I=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[a]=N[s]=N[x]=N[c]=N[M]=N[l]=N[d]=N[p]=N[h]=N[g]=N[v]=N[b]=N[E]=N[O]=N[T]=!1;var P="object"==typeof global&&global&&global.Object===Object&&global,L="object"==typeof self&&self&&self.Object===Object&&self,w=P||L||Function("return this")(),R=t&&!t.nodeType&&t,k=R&&e&&!e.nodeType&&e,F=k&&k.exports===R,U=F&&P.process,D=function(){try{return U&&U.binding&&U.binding("util")}catch(e){}}(),j=D&&D.isTypedArray;function V(e,t){for(var n=-1,o=null==e?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e,o){n[++t]=[o,e]})),n}function B(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var J,Y,Z,W=Array.prototype,z=Function.prototype,H=Object.prototype,X=w["__core-js_shared__"],Q=z.toString,K=H.hasOwnProperty,q=(J=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",$=H.toString,ee=RegExp("^"+Q.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=F?w.Buffer:void 0,ne=w.Symbol,oe=w.Uint8Array,re=H.propertyIsEnumerable,ie=W.splice,ae=ne?ne.toStringTag:void 0,se=Object.getOwnPropertySymbols,ue=te?te.isBuffer:void 0,ce=(Y=Object.keys,Z=Object,function(e){return Y(Z(e))}),le=De(w,"DataView"),de=De(w,"Map"),pe=De(w,"Promise"),fe=De(w,"Set"),he=De(w,"WeakMap"),ge=De(Object,"create"),ye=Be(le),ve=Be(de),me=Be(pe),_e=Be(fe),be=Be(he),Ee=ne?ne.prototype:void 0,Oe=Ee?Ee.valueOf:void 0;function Ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function Se(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function xe(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Te;++t<n;)this.add(e[t])}function Me(e){var t=this.__data__=new Se(e);this.size=t.size}function Ie(e,t){var n=Ze(e),o=!n&&Ye(e),r=!n&&!o&&We(e),i=!n&&!o&&!r&&Ke(e),a=n||o||r||i,s=a?function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}(e.length,String):[],u=s.length;for(var c in e)!t&&!K.call(e,c)||a&&("length"==c||r&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ge(c,u))||s.push(c);return s}function Ae(e,t){for(var n=e.length;n--;)if(Je(e[n][0],t))return n;return-1}function Ne(e){return null==e?void 0===e?S:y:ae&&ae in Object(e)?function(e){var t=K.call(e,ae),n=e[ae];try{e[ae]=void 0;var o=!0}catch(e){}var r=$.call(e);o&&(t?e[ae]=n:delete e[ae]);return r}(e):function(e){return $.call(e)}(e)}function Pe(e){return Qe(e)&&Ne(e)==a}function Le(e,t,n,i,u){return e===t||(null==e||null==t||!Qe(e)&&!Qe(t)?e!=e&&t!=t:function(e,t,n,i,u,p){var f=Ze(e),y=Ze(t),m=f?s:Ve(e),_=y?s:Ve(t),S=(m=m==a?v:m)==v,T=(_=_==a?v:_)==v,I=m==_;if(I&&We(e)){if(!We(t))return!1;f=!0,S=!1}if(I&&!S)return p||(p=new Me),f||Ke(e)?ke(e,t,n,i,u,p):function(e,t,n,i,a,s,u){switch(n){case M:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case x:return!(e.byteLength!=t.byteLength||!s(new oe(e),new oe(t)));case c:case l:case g:return Je(+e,+t);case d:return e.name==t.name&&e.message==t.message;case b:case O:return e==t+"";case h:var p=G;case E:var f=i&o;if(p||(p=B),e.size!=t.size&&!f)return!1;var y=u.get(e);if(y)return y==t;i|=r,u.set(e,t);var v=ke(p(e),p(t),i,a,s,u);return u.delete(e),v;case C:if(Oe)return Oe.call(e)==Oe.call(t)}return!1}(e,t,m,n,i,u,p);if(!(n&o)){var A=S&&K.call(e,"__wrapped__"),N=T&&K.call(t,"__wrapped__");if(A||N){var P=A?e.value():e,L=N?t.value():t;return p||(p=new Me),u(P,L,n,i,p)}}if(!I)return!1;return p||(p=new Me),function(e,t,n,r,i,a){var s=n&o,u=Fe(e),c=u.length,l=Fe(t),d=l.length;if(c!=d&&!s)return!1;var p=c;for(;p--;){var f=u[p];if(!(s?f in t:K.call(t,f)))return!1}var h=a.get(e);if(h&&a.get(t))return h==t;var g=!0;a.set(e,t),a.set(t,e);var y=s;for(;++p<c;){var v=e[f=u[p]],m=t[f];if(r)var _=s?r(m,v,f,t,e,a):r(v,m,f,e,t,a);if(!(void 0===_?v===m||i(v,m,n,r,a):_)){g=!1;break}y||(y="constructor"==f)}if(g&&!y){var b=e.constructor,E=t.constructor;b==E||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof E&&E instanceof E||(g=!1)}return a.delete(e),a.delete(t),g}(e,t,n,i,u,p)}(e,t,n,i,Le,u))}function we(e){return!(!Xe(e)||function(e){return!!q&&q in e}(e))&&(ze(e)?ee:I).test(Be(e))}function Re(e){if(n=(t=e)&&t.constructor,o="function"==typeof n&&n.prototype||H,t!==o)return ce(e);var t,n,o,r=[];for(var i in Object(e))K.call(e,i)&&"constructor"!=i&&r.push(i);return r}function ke(e,t,n,i,a,s){var u=n&o,c=e.length,l=t.length;if(c!=l&&!(u&&l>c))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var p=-1,f=!0,h=n&r?new xe:void 0;for(s.set(e,t),s.set(t,e);++p<c;){var g=e[p],y=t[p];if(i)var v=u?i(y,g,p,t,e,s):i(g,y,p,e,t,s);if(void 0!==v){if(v)continue;f=!1;break}if(h){if(!V(t,(function(e,t){if(o=t,!h.has(o)&&(g===e||a(g,e,n,i,s)))return h.push(t);var o}))){f=!1;break}}else if(g!==y&&!a(g,y,n,i,s)){f=!1;break}}return s.delete(e),s.delete(t),f}function Fe(e){return function(e,t,n){var o=t(e);return Ze(e)?o:function(e,t){for(var n=-1,o=t.length,r=e.length;++n<o;)e[r+n]=t[n];return e}(o,n(e))}(e,qe,je)}function Ue(e,t){var n,o,r=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function De(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return we(n)?n:void 0}Ce.prototype.clear=function(){this.__data__=ge?ge(null):{},this.size=0},Ce.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ce.prototype.get=function(e){var t=this.__data__;if(ge){var o=t[e];return o===n?void 0:o}return K.call(t,e)?t[e]:void 0},Ce.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:K.call(t,e)},Ce.prototype.set=function(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=ge&&void 0===t?n:t,this},Se.prototype.clear=function(){this.__data__=[],this.size=0},Se.prototype.delete=function(e){var t=this.__data__,n=Ae(t,e);return!(n<0)&&(n==t.length-1?t.pop():ie.call(t,n,1),--this.size,!0)},Se.prototype.get=function(e){var t=this.__data__,n=Ae(t,e);return n<0?void 0:t[n][1]},Se.prototype.has=function(e){return Ae(this.__data__,e)>-1},Se.prototype.set=function(e,t){var n=this.__data__,o=Ae(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this},Te.prototype.clear=function(){this.size=0,this.__data__={hash:new Ce,map:new(de||Se),string:new Ce}},Te.prototype.delete=function(e){var t=Ue(this,e).delete(e);return this.size-=t?1:0,t},Te.prototype.get=function(e){return Ue(this,e).get(e)},Te.prototype.has=function(e){return Ue(this,e).has(e)},Te.prototype.set=function(e,t){var n=Ue(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this},xe.prototype.add=xe.prototype.push=function(e){return this.__data__.set(e,n),this},xe.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.clear=function(){this.__data__=new Se,this.size=0},Me.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Me.prototype.get=function(e){return this.__data__.get(e)},Me.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Se){var o=n.__data__;if(!de||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new Te(o)}return n.set(e,t),this.size=n.size,this};var je=se?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,o=null==e?0:e.length,r=0,i=[];++n<o;){var a=e[n];t(a,n,e)&&(i[r++]=a)}return i}(se(e),(function(t){return re.call(e,t)})))}:function(){return[]},Ve=Ne;function Ge(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function Be(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Je(e,t){return e===t||e!=e&&t!=t}(le&&Ve(new le(new ArrayBuffer(1)))!=M||de&&Ve(new de)!=h||pe&&Ve(pe.resolve())!=m||fe&&Ve(new fe)!=E||he&&Ve(new he)!=T)&&(Ve=function(e){var t=Ne(e),n=t==v?e.constructor:void 0,o=n?Be(n):"";if(o)switch(o){case ye:return M;case ve:return h;case me:return m;case _e:return E;case be:return T}return t});var Ye=Pe(function(){return arguments}())?Pe:function(e){return Qe(e)&&K.call(e,"callee")&&!re.call(e,"callee")},Ze=Array.isArray;var We=ue||function(){return!1};function ze(e){if(!Xe(e))return!1;var t=Ne(e);return t==p||t==f||t==u||t==_}function He(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function Xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Qe(e){return null!=e&&"object"==typeof e}var Ke=j?function(e){return function(t){return e(t)}}(j):function(e){return Qe(e)&&He(e.length)&&!!N[Ne(e)]};function qe(e){return null!=(t=e)&&He(t.length)&&!ze(t)?Ie(e):Re(e);var t}e.exports=function(e,t){return Le(e,t)}}(go,go.exports);var yo=i(go.exports);function vo(e,t){return e.length===t.length&&JSON.stringify(e.map((function(e){return e})).sort())===JSON.stringify(t.map((function(e){return e})).sort())}var mo={Polygon:be,LineString:_e,Point:me,MultiPolygon:Ce,MultiLineString:Ce,MultiPoint:Ce};var _o=Object.freeze({__proto__:null,CommonSelectors:Ze,constrainFeatureMovement:Ft,createMidPoint:Ke,createSupplementaryPoints:qe,createVertex:Qe,doubleClickZoom:$e,euclideanDistance:ae,featuresAt:R,getFeatureAtAndSetCursors:ie,isClick:le,isEventAtCoordinates:Jt,isTap:fe,mapEventToBoundingBox:P,ModeHandler:r,moveFeatures:Ut,sortFeatures:N,stringSetsAreEqual:vo,StringSet:L,theme:Re,theme3:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["coalesce",["get","user_inactive-fill-color"],"#E1361B"],"fill-outline-color":["coalesce",["get","user_inactive-fill-outline-color"],"#E1361B"],"fill-opacity":["coalesce",["get","user_inactive-fill-opacity"],.1]}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#E1361B","fill-outline-color":"#E1361B","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#E1361B","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["coalesce",["get","user_inactive-line-color"],"#E1361B"],"line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#E1361B","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#E1361B"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#E1361B"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#E1361B"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],toDenseArray:Ie}),bo=function(e,t){var n={options:e=function(e){void 0===e&&(e={});var t=oe(e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=oe(po,e.controls):t.controls=oe(lo,e.controls),(t=oe(co,t)).styles=ho(t.styles),t}(e)};t=function(e,t){return t.modes=m,t.getFeatureIdsAt=function(t){return R.click({point:t},null,e).map((function(e){return e.properties.id}))},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getSelectedIds().map((function(t){return e.store.get(t)})).map((function(e){return e.toGeoJSON()}))}},t.getSelectedPoints=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map((function(e){return{type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e.coordinates}}}))}},t.set=function(n){if(void 0===n.type||n.type!==v.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var o=e.store.createRenderBatch(),r=e.store.getAllIds().slice(),i=t.add(n),a=new L(i);return(r=r.filter((function(e){return!a.has(e)}))).length&&t.delete(r),o(),i},t.add=function(n,o){void 0===o&&(o={silent:!1});var r=JSON.parse(JSON.stringify(ot(n))).features.map((function(n){if(n.id=n.id||ye(),null===n.geometry)throw new Error("Invalid geometry: null");var o;if(void 0===e.store.get(n.id)||e.store.get(n.id).type!==n.geometry.type){var r=mo[n.geometry.type];if(void 0===r)throw new Error("Invalid geometry type: "+n.geometry.type+".");o=new r(e,n),e.store.add(o)}else(o=e.store.get(n.id)).properties=n.properties,yo(o.getCoordinates(),n.geometry.coordinates)||o.incomingCoords(n.geometry.coordinates);return o&&t.options.measureOptions&&(o.measure.setOptions(t.options.measureOptions),o.execMeasure()),n.id}));return o.silent||e.store.render(),r},t.get=function(t){var n=e.store.get(t);if(n)return n.toGeoJSON()},t.getAll=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getAll().map((function(e){return e.toGeoJSON()}))}},t.delete=function(n){return e.store.delete(n,{silent:!0}),t.getMode()!==m.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===m.DIRECT_SELECT?e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(n,o){return void 0===o&&(o={}),n===m.SIMPLE_SELECT&&t.getMode()===m.SIMPLE_SELECT?(vo(o.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(o.featureIds,{silent:!0}),e.store.render()),t):(n===m.DIRECT_SELECT&&t.getMode()===m.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,o,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(n,o,r){return e.store.setFeatureProperty(n,o,r),t},t.getFeatureTypeById=function(t){return e.store.get(t)},t.undo=function(){return e.events.undo(),t},t.redo=function(){return e.events.redo(),t},t.finish=function(n){return e.events.finish(n),t},t.cancel=function(n){return e.events.cancel(n),t},t.drawByCenter=function(){return e.events.drawByCoordinate(e.map.getCenter().toArray()),t},t.drawByCoordinate=function(n){return e.events.drawByCoordinate(n),t},t.setStyle=function(n){return e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.options.styles=ho(n).map((function(t){return e.map.addLayer(t),t})),t},t.edit=function(e){var n=t.add(e),o=e.type,r=o===v.FEATURE?e:x.includes(o)?{type:v.FEATURE,properties:{},geometry:e}:null;return r?(r.geometry.type===v.POINT?t.changeMode("simple_select",{featureIds:n}):t.changeMode("direct_select",{featureId:n[0]}),t):(console.warn("only support edit feature or geometry"),t)},t.setMeasureOptions=function(n){return e.events.setMeasureOptions(n),t},t.getCtx=function(){return e},t}(n,t),n.api=t;var o=we(n);return t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=y,t.options=e,t};function Eo(e){bo(e,this)}return Eo.modes=uo,Eo.constants=M,Eo.lib=_o,Eo}));
//# sourceMappingURL=mapbox-gl-draw.umd.min.js.map
